import{E as Ir,I as aa,S as vr,F as na,G as Kr,H as Jr,J as Se,K as Be,N as We,O as Ue,R as nr,Q as ia,U as sa,T as oa,V as dr,W as la,r as g,X as Wr,Y as ca,Z as Cr,_ as He,$ as Qr,a0 as ua,a1 as et,a2 as fr,a3 as pr,a4 as da,a5 as ha,a6 as xr,a7 as $e,a8 as fa,a9 as pa,aa as ga,ab as va,ac as ma,ad as Er,ae as hr,af as wa,ag as ya,ah as $r,ai as _a,aj as ba,ak as Ze,al as Ie,am as gr,an as xa,ao as Ea,ap as Ma,aq as Rr,ar as rt,as as tt,at as Sa,au as Xr,av as at,aw as Yr,ax as Ia,ay as Ca,az as Ye,j as _,aA as J,aB as Ra,aC as Ta,aD as Aa,aE as Fa,aF as Na,L as Ua}from"./index-DKXn9bxP.js";var Ae=Uint8Array,je=Uint16Array,Mr=Uint32Array,nt=new Ae([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),it=new Ae([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Oa=new Ae([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),st=function(i,r){for(var n=new je(31),l=0;l<31;++l)n[l]=r+=1<<i[l-1];for(var o=new Mr(n[30]),l=1;l<30;++l)for(var c=n[l];c<n[l+1];++c)o[c]=c-n[l]<<5|l;return[n,o]},ot=st(nt,2),lt=ot[0],La=ot[1];lt[28]=258,La[258]=28;var ka=st(it,0),Ba=ka[0],Sr=new je(32768);for(var ce=0;ce<32768;++ce){var Pe=(ce&43690)>>>1|(ce&21845)<<1;Pe=(Pe&52428)>>>2|(Pe&13107)<<2,Pe=(Pe&61680)>>>4|(Pe&3855)<<4,Sr[ce]=((Pe&65280)>>>8|(Pe&255)<<8)>>>1}var ar=function(i,r,n){for(var l=i.length,o=0,c=new je(r);o<l;++o)++c[i[o]-1];var s=new je(r);for(o=0;o<r;++o)s[o]=s[o-1]+c[o-1]<<1;var f;if(n){f=new je(1<<r);var p=15-r;for(o=0;o<l;++o)if(i[o])for(var v=o<<4|i[o],A=r-i[o],I=s[i[o]-1]++<<A,F=I|(1<<A)-1;I<=F;++I)f[Sr[I]>>>p]=v}else for(f=new je(l),o=0;o<l;++o)i[o]&&(f[o]=Sr[s[i[o]-1]++]>>>15-i[o]);return f},sr=new Ae(288);for(var ce=0;ce<144;++ce)sr[ce]=8;for(var ce=144;ce<256;++ce)sr[ce]=9;for(var ce=256;ce<280;++ce)sr[ce]=7;for(var ce=280;ce<288;++ce)sr[ce]=8;var ct=new Ae(32);for(var ce=0;ce<32;++ce)ct[ce]=5;var Da=ar(sr,9,1),Pa=ar(ct,5,1),_r=function(i){for(var r=i[0],n=1;n<i.length;++n)i[n]>r&&(r=i[n]);return r},Fe=function(i,r,n){var l=r/8|0;return(i[l]|i[l+1]<<8)>>(r&7)&n},br=function(i,r){var n=r/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(r&7)},Ha=function(i){return(i/8|0)+(i&7&&1)},ja=function(i,r,n){(n==null||n>i.length)&&(n=i.length);var l=new(i instanceof je?je:i instanceof Mr?Mr:Ae)(n-r);return l.set(i.subarray(r,n)),l},za=function(i,r,n){var l=i.length;if(!l||n&&!n.l&&l<5)return r||new Ae(0);var o=!r||n,c=!n||n.i;n||(n={}),r||(r=new Ae(l*3));var s=function(te){var Oe=r.length;if(te>Oe){var Le=new Ae(Math.max(Oe*2,te));Le.set(r),r=Le}},f=n.f||0,p=n.p||0,v=n.b||0,A=n.l,I=n.d,F=n.m,U=n.n,B=l*8;do{if(!A){n.f=f=Fe(i,p,1);var Q=Fe(i,p+1,3);if(p+=3,Q)if(Q==1)A=Da,I=Pa,F=9,U=5;else if(Q==2){var Y=Fe(i,p,31)+257,R=Fe(i,p+10,15)+4,m=Y+Fe(i,p+5,31)+1;p+=14;for(var y=new Ae(m),D=new Ae(19),x=0;x<R;++x)D[Oa[x]]=Fe(i,p+x*3,7);p+=R*3;for(var T=_r(D),H=(1<<T)-1,G=ar(D,T,1),x=0;x<m;){var W=G[Fe(i,p,H)];p+=W&15;var P=W>>>4;if(P<16)y[x++]=P;else{var K=0,k=0;for(P==16?(k=3+Fe(i,p,3),p+=2,K=y[x-1]):P==17?(k=3+Fe(i,p,7),p+=3):P==18&&(k=11+Fe(i,p,127),p+=7);k--;)y[x++]=K}}var $=y.subarray(0,Y),j=y.subarray(Y);F=_r($),U=_r(j),A=ar($,F,1),I=ar(j,U,1)}else throw"invalid block type";else{var P=Ha(p)+4,V=i[P-4]|i[P-3]<<8,Z=P+V;if(Z>l){if(c)throw"unexpected EOF";break}o&&s(v+V),r.set(i.subarray(P,Z),v),n.b=v+=V,n.p=p=Z*8;continue}if(p>B){if(c)throw"unexpected EOF";break}}o&&s(v+131072);for(var he=(1<<F)-1,be=(1<<U)-1,ye=p;;ye=p){var K=A[br(i,p)&he],re=K>>>4;if(p+=K&15,p>B){if(c)throw"unexpected EOF";break}if(!K)throw"invalid length/literal";if(re<256)r[v++]=re;else if(re==256){ye=p,A=null;break}else{var ve=re-254;if(re>264){var x=re-257,ie=nt[x];ve=Fe(i,p,(1<<ie)-1)+lt[x],p+=ie}var fe=I[br(i,p)&be],Ee=fe>>>4;if(!fe)throw"invalid distance";p+=fe&15;var j=Ba[Ee];if(Ee>3){var ie=it[Ee];j+=br(i,p)&(1<<ie)-1,p+=ie}if(p>B){if(c)throw"unexpected EOF";break}o&&s(v+131072);for(var Ve=v+ve;v<Ve;v+=4)r[v]=r[v-j],r[v+1]=r[v+1-j],r[v+2]=r[v+2-j],r[v+3]=r[v+3-j];v=Ve}}n.l=A,n.p=ye,n.b=v,A&&(f=1,n.m=F,n.d=I,n.n=U)}while(!f);return v==r.length?r:ja(r,0,v)},Ga=new Ae(0),Za=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function cr(i,r){return za((Za(i),i.subarray(2,-4)),r)}var Wa=typeof TextDecoder<"u"&&new TextDecoder,$a=0;try{Wa.decode(Ga,{stream:!0}),$a=1}catch{}const Xa=i=>i&&i.isCubeTexture;class Ya extends Ir{constructor(r,n){var l,o;const c=Xa(r),f=((o=c?(l=r.image[0])==null?void 0:l.width:r.image.width)!=null?o:1024)/4,p=Math.floor(Math.log2(f)),v=Math.pow(2,p),A=3*Math.max(v,16*7),I=4*v,F=[c?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/A}`,`#define CUBEUV_TEXEL_HEIGHT ${1/I}`,`#define CUBEUV_MAX_MIP ${p}.0`],U=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,B=F.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Kr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,Q={map:{value:r},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},P=new aa(1,16),V=new vr({uniforms:Q,fragmentShader:B,vertexShader:U,side:na});super(P,V)}set radius(r){this.material.uniforms.radius.value=r}get radius(){return this.material.uniforms.radius.value}set height(r){this.material.uniforms.height.value=r}get height(){return this.material.uniforms.height.value}}class Va extends Jr{constructor(r){super(r),this.type=Se}parse(r){const s=function(x,T){switch(x){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(T||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(T||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(T||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(T||""))}},A=`
`,I=function(x,T,H){T=T||1024;let W=x.pos,K=-1,k=0,$="",j=String.fromCharCode.apply(null,new Uint16Array(x.subarray(W,W+128)));for(;0>(K=j.indexOf(A))&&k<T&&W<x.byteLength;)$+=j,k+=j.length,W+=128,j+=String.fromCharCode.apply(null,new Uint16Array(x.subarray(W,W+128)));return-1<K?(x.pos+=k+K+1,$+j.slice(0,K)):!1},F=function(x){const T=/^#\?(\S+)/,H=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,G=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*FORMAT=(\S+)\s*$/,K=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,k={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let $,j;for((x.pos>=x.byteLength||!($=I(x)))&&s(1,"no header found"),(j=$.match(T))||s(3,"bad initial token"),k.valid|=1,k.programtype=j[1],k.string+=$+`
`;$=I(x),$!==!1;){if(k.string+=$+`
`,$.charAt(0)==="#"){k.comments+=$+`
`;continue}if((j=$.match(H))&&(k.gamma=parseFloat(j[1])),(j=$.match(G))&&(k.exposure=parseFloat(j[1])),(j=$.match(W))&&(k.valid|=2,k.format=j[1]),(j=$.match(K))&&(k.valid|=4,k.height=parseInt(j[1],10),k.width=parseInt(j[2],10)),k.valid&2&&k.valid&4)break}return k.valid&2||s(3,"missing format specifier"),k.valid&4||s(3,"missing image size specifier"),k},U=function(x,T,H){const G=T;if(G<8||G>32767||x[0]!==2||x[1]!==2||x[2]&128)return new Uint8Array(x);G!==(x[2]<<8|x[3])&&s(3,"wrong scanline width");const W=new Uint8Array(4*T*H);W.length||s(4,"unable to allocate buffer space");let K=0,k=0;const $=4*G,j=new Uint8Array(4),he=new Uint8Array($);let be=H;for(;be>0&&k<x.byteLength;){k+4>x.byteLength&&s(1),j[0]=x[k++],j[1]=x[k++],j[2]=x[k++],j[3]=x[k++],(j[0]!=2||j[1]!=2||(j[2]<<8|j[3])!=G)&&s(3,"bad rgbe scanline format");let ye=0,re;for(;ye<$&&k<x.byteLength;){re=x[k++];const ie=re>128;if(ie&&(re-=128),(re===0||ye+re>$)&&s(3,"bad scanline data"),ie){const fe=x[k++];for(let Ee=0;Ee<re;Ee++)he[ye++]=fe}else he.set(x.subarray(k,k+re),ye),ye+=re,k+=re}const ve=G;for(let ie=0;ie<ve;ie++){let fe=0;W[K]=he[ie+fe],fe+=G,W[K+1]=he[ie+fe],fe+=G,W[K+2]=he[ie+fe],fe+=G,W[K+3]=he[ie+fe],K+=4}be--}return W},B=function(x,T,H,G){const W=x[T+3],K=Math.pow(2,W-128)/255;H[G+0]=x[T+0]*K,H[G+1]=x[T+1]*K,H[G+2]=x[T+2]*K,H[G+3]=1},Q=function(x,T,H,G){const W=x[T+3],K=Math.pow(2,W-128)/255;H[G+0]=We.toHalfFloat(Math.min(x[T+0]*K,65504)),H[G+1]=We.toHalfFloat(Math.min(x[T+1]*K,65504)),H[G+2]=We.toHalfFloat(Math.min(x[T+2]*K,65504)),H[G+3]=We.toHalfFloat(1)},P=new Uint8Array(r);P.pos=0;const V=F(P),Z=V.width,Y=V.height,R=U(P.subarray(P.pos),Z,Y);let m,y,D;switch(this.type){case Be:D=R.length/4;const x=new Float32Array(D*4);for(let H=0;H<D;H++)B(R,H*4,x,H*4);m=x,y=Be;break;case Se:D=R.length/4;const T=new Uint16Array(D*4);for(let H=0;H<D;H++)Q(R,H*4,T,H*4);m=T,y=Se;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:Z,height:Y,data:m,header:V.string,gamma:V.gamma,exposure:V.exposure,type:y}}setDataType(r){return this.type=r,this}load(r,n,l,o){function c(s,f){switch(s.type){case Be:case Se:"colorSpace"in s?s.colorSpace="srgb-linear":s.encoding=3e3,s.minFilter=Ue,s.magFilter=Ue,s.generateMipmaps=!1,s.flipY=!0;break}n&&n(s,f)}return super.load(r,c,l,o)}}const rr=Kr>=152;class qa extends Jr{constructor(r){super(r),this.type=Se}parse(r){const T=Math.pow(2.7182818,2.2);function H(e,t){for(var a=0,u=0;u<65536;++u)(u==0||e[u>>3]&1<<(u&7))&&(t[a++]=u);for(var d=a-1;a<65536;)t[a++]=0;return d}function G(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const W={l:0,c:0,lc:0};function K(e,t,a,u,d){for(;a<e;)t=t<<8|Gr(u,d),a+=8;a-=e,W.l=t>>a&(1<<e)-1,W.c=t,W.lc=a}const k=new Array(59);function $(e){for(var t=0;t<=58;++t)k[t]=0;for(var t=0;t<65537;++t)k[e[t]]+=1;for(var a=0,t=58;t>0;--t){var u=a+k[t]>>1;k[t]=a,a=u}for(var t=0;t<65537;++t){var d=e[t];d>0&&(e[t]=d|k[d]++<<6)}}function j(e,t,a,u,d,h,b){for(var w=a,S=0,M=0;d<=h;d++){if(w.value-a.value>u)return!1;K(6,S,M,e,w);var C=W.l;if(S=W.c,M=W.lc,b[d]=C,C==63){if(w.value-a.value>u)throw"Something wrong with hufUnpackEncTable";K(8,S,M,e,w);var E=W.l+6;if(S=W.c,M=W.lc,d+E>h+1)throw"Something wrong with hufUnpackEncTable";for(;E--;)b[d++]=0;d--}else if(C>=59){var E=C-59+2;if(d+E>h+1)throw"Something wrong with hufUnpackEncTable";for(;E--;)b[d++]=0;d--}}$(b)}function he(e){return e&63}function be(e){return e>>6}function ye(e,t,a,u){for(;t<=a;t++){var d=be(e[t]),h=he(e[t]);if(d>>h)throw"Invalid table entry";if(h>14){var b=u[d>>h-14];if(b.len)throw"Invalid table entry";if(b.lit++,b.p){var w=b.p;b.p=new Array(b.lit);for(var S=0;S<b.lit-1;++S)b.p[S]=w[S]}else b.p=new Array(1);b.p[b.lit-1]=t}else if(h)for(var M=0,S=1<<14-h;S>0;S--){var b=u[(d<<14-h)+M];if(b.len||b.p)throw"Invalid table entry";b.len=h,b.lit=t,M++}}return!0}const re={c:0,lc:0};function ve(e,t,a,u){e=e<<8|Gr(a,u),t+=8,re.c=e,re.lc=t}const ie={c:0,lc:0};function fe(e,t,a,u,d,h,b,w,S,M){if(e==t){u<8&&(ve(a,u,d,b),a=re.c,u=re.lc),u-=8;var C=a>>u,C=new Uint8Array([C])[0];if(S.value+C>M)return!1;for(var E=w[S.value-1];C-- >0;)w[S.value++]=E}else if(S.value<M)w[S.value++]=e;else return!1;ie.c=a,ie.lc=u}function Ee(e){return e&65535}function Ve(e){var t=Ee(e);return t>32767?t-65536:t}const te={a:0,b:0};function Oe(e,t){var a=Ve(e),u=Ve(t),d=u,h=a+(d&1)+(d>>1),b=h,w=h-d;te.a=b,te.b=w}function Le(e,t){var a=Ee(e),u=Ee(t),d=a-(u>>1)&65535,h=u+d-32768&65535;te.a=h,te.b=d}function Ct(e,t,a,u,d,h,b){for(var w=b<16384,S=a>d?d:a,M=1,C;M<=S;)M<<=1;for(M>>=1,C=M,M>>=1;M>=1;){for(var E=0,de=E+h*(d-C),O=h*M,L=h*C,z=u*M,X=u*C,ae,se,pe,_e;E<=de;E+=L){for(var oe=E,Ne=E+u*(a-C);oe<=Ne;oe+=X){var le=oe+z,ge=oe+O,ke=ge+z;w?(Oe(e[oe+t],e[ge+t]),ae=te.a,pe=te.b,Oe(e[le+t],e[ke+t]),se=te.a,_e=te.b,Oe(ae,se),e[oe+t]=te.a,e[le+t]=te.b,Oe(pe,_e),e[ge+t]=te.a,e[ke+t]=te.b):(Le(e[oe+t],e[ge+t]),ae=te.a,pe=te.b,Le(e[le+t],e[ke+t]),se=te.a,_e=te.b,Le(ae,se),e[oe+t]=te.a,e[le+t]=te.b,Le(pe,_e),e[ge+t]=te.a,e[ke+t]=te.b)}if(a&M){var ge=oe+O;w?Oe(e[oe+t],e[ge+t]):Le(e[oe+t],e[ge+t]),ae=te.a,e[ge+t]=te.b,e[oe+t]=ae}}if(d&M)for(var oe=E,Ne=E+u*(a-C);oe<=Ne;oe+=X){var le=oe+z;w?Oe(e[oe+t],e[le+t]):Le(e[oe+t],e[le+t]),ae=te.a,e[le+t]=te.b,e[oe+t]=ae}C=M,M>>=1}return E}function Rt(e,t,a,u,d,h,b,w,S,M){for(var C=0,E=0,de=w,O=Math.trunc(d.value+(h+7)/8);d.value<O;)for(ve(C,E,a,d),C=re.c,E=re.lc;E>=14;){var L=C>>E-14&16383,z=t[L];if(z.len)E-=z.len,fe(z.lit,b,C,E,a,u,d,S,M,de),C=ie.c,E=ie.lc;else{if(!z.p)throw"hufDecode issues";var X;for(X=0;X<z.lit;X++){for(var ae=he(e[z.p[X]]);E<ae&&d.value<O;)ve(C,E,a,d),C=re.c,E=re.lc;if(E>=ae&&be(e[z.p[X]])==(C>>E-ae&(1<<ae)-1)){E-=ae,fe(z.p[X],b,C,E,a,u,d,S,M,de),C=ie.c,E=ie.lc;break}}if(X==z.lit)throw"hufDecode issues"}}var se=8-h&7;for(C>>=se,E-=se;E>0;){var z=t[C<<14-E&16383];if(z.len)E-=z.len,fe(z.lit,b,C,E,a,u,d,S,M,de),C=ie.c,E=ie.lc;else throw"hufDecode issues"}return!0}function Br(e,t,a,u,d,h){var b={value:0},w=a.value,S=xe(t,a),M=xe(t,a);a.value+=4;var C=xe(t,a);if(a.value+=4,S<0||S>=65537||M<0||M>=65537)throw"Something wrong with HUF_ENCSIZE";var E=new Array(65537),de=new Array(16384);G(de);var O=u-(a.value-w);if(j(e,t,a,O,S,M,E),C>8*(u-(a.value-w)))throw"Something wrong with hufUncompress";ye(E,S,M,de),Rt(E,de,e,t,a,C,M,h,d,b)}function Tt(e,t,a){for(var u=0;u<a;++u)t[u]=e[t[u]]}function Dr(e){for(var t=1;t<e.length;t++){var a=e[t-1]+e[t]-128;e[t]=a}}function Pr(e,t){for(var a=0,u=Math.floor((e.length+1)/2),d=0,h=e.length-1;!(d>h||(t[d++]=e[a++],d>h));)t[d++]=e[u++]}function Hr(e){for(var t=e.byteLength,a=new Array,u=0,d=new DataView(e);t>0;){var h=d.getInt8(u++);if(h<0){var b=-h;t-=b+1;for(var w=0;w<b;w++)a.push(d.getUint8(u++))}else{var b=h;t-=2;for(var S=d.getUint8(u++),w=0;w<b+1;w++)a.push(S)}}return a}function At(e,t,a,u,d,h){var le=new DataView(h.buffer),b=a[e.idx[0]].width,w=a[e.idx[0]].height,S=3,M=Math.floor(b/8),C=Math.ceil(b/8),E=Math.ceil(w/8),de=b-(C-1)*8,O=w-(E-1)*8,L={value:0},z=new Array(S),X=new Array(S),ae=new Array(S),se=new Array(S),pe=new Array(S);for(let ne=0;ne<S;++ne)pe[ne]=t[e.idx[ne]],z[ne]=ne<1?0:z[ne-1]+C*E,X[ne]=new Float32Array(64),ae[ne]=new Uint16Array(64),se[ne]=new Uint16Array(C*64);for(let ne=0;ne<E;++ne){var _e=8;ne==E-1&&(_e=O);var oe=8;for(let ue=0;ue<C;++ue){ue==C-1&&(oe=de);for(let ee=0;ee<S;++ee)ae[ee].fill(0),ae[ee][0]=d[z[ee]++],Ft(L,u,ae[ee]),Nt(ae[ee],X[ee]),Ut(X[ee]);Ot(X);for(let ee=0;ee<S;++ee)Lt(X[ee],se[ee],ue*64)}let we=0;for(let ue=0;ue<S;++ue){const ee=a[e.idx[ue]].type;for(let Te=8*ne;Te<8*ne+_e;++Te){we=pe[ue][Te];for(let ze=0;ze<M;++ze){const Me=ze*64+(Te&7)*8;le.setUint16(we+0*2*ee,se[ue][Me+0],!0),le.setUint16(we+1*2*ee,se[ue][Me+1],!0),le.setUint16(we+2*2*ee,se[ue][Me+2],!0),le.setUint16(we+3*2*ee,se[ue][Me+3],!0),le.setUint16(we+4*2*ee,se[ue][Me+4],!0),le.setUint16(we+5*2*ee,se[ue][Me+5],!0),le.setUint16(we+6*2*ee,se[ue][Me+6],!0),le.setUint16(we+7*2*ee,se[ue][Me+7],!0),we+=8*2*ee}}if(M!=C)for(let Te=8*ne;Te<8*ne+_e;++Te){const ze=pe[ue][Te]+8*M*2*ee,Me=M*64+(Te&7)*8;for(let De=0;De<oe;++De)le.setUint16(ze+De*2*ee,se[ue][Me+De],!0)}}}for(var Ne=new Uint16Array(b),le=new DataView(h.buffer),ge=0;ge<S;++ge){a[e.idx[ge]].decoded=!0;var ke=a[e.idx[ge]].type;if(a[ge].type==2)for(var er=0;er<w;++er){const ne=pe[ge][er];for(var Re=0;Re<b;++Re)Ne[Re]=le.getUint16(ne+Re*2*ke,!0);for(var Re=0;Re<b;++Re)le.setFloat32(ne+Re*2*ke,N(Ne[Re]),!0)}}}function Ft(e,t,a){for(var u,d=1;d<64;)u=t[e.value],u==65280?d=64:u>>8==255?d+=u&255:(a[d]=u,d++),e.value++}function Nt(e,t){t[0]=N(e[0]),t[1]=N(e[1]),t[2]=N(e[5]),t[3]=N(e[6]),t[4]=N(e[14]),t[5]=N(e[15]),t[6]=N(e[27]),t[7]=N(e[28]),t[8]=N(e[2]),t[9]=N(e[4]),t[10]=N(e[7]),t[11]=N(e[13]),t[12]=N(e[16]),t[13]=N(e[26]),t[14]=N(e[29]),t[15]=N(e[42]),t[16]=N(e[3]),t[17]=N(e[8]),t[18]=N(e[12]),t[19]=N(e[17]),t[20]=N(e[25]),t[21]=N(e[30]),t[22]=N(e[41]),t[23]=N(e[43]),t[24]=N(e[9]),t[25]=N(e[11]),t[26]=N(e[18]),t[27]=N(e[24]),t[28]=N(e[31]),t[29]=N(e[40]),t[30]=N(e[44]),t[31]=N(e[53]),t[32]=N(e[10]),t[33]=N(e[19]),t[34]=N(e[23]),t[35]=N(e[32]),t[36]=N(e[39]),t[37]=N(e[45]),t[38]=N(e[52]),t[39]=N(e[54]),t[40]=N(e[20]),t[41]=N(e[22]),t[42]=N(e[33]),t[43]=N(e[38]),t[44]=N(e[46]),t[45]=N(e[51]),t[46]=N(e[55]),t[47]=N(e[60]),t[48]=N(e[21]),t[49]=N(e[34]),t[50]=N(e[37]),t[51]=N(e[47]),t[52]=N(e[50]),t[53]=N(e[56]),t[54]=N(e[59]),t[55]=N(e[61]),t[56]=N(e[35]),t[57]=N(e[36]),t[58]=N(e[48]),t[59]=N(e[49]),t[60]=N(e[57]),t[61]=N(e[58]),t[62]=N(e[62]),t[63]=N(e[63])}function Ut(e){const t=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),u=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),h=.5*Math.cos(5*3.14159/16),b=.5*Math.cos(3*3.14159/8),w=.5*Math.cos(7*3.14159/16);for(var S=new Array(4),M=new Array(4),C=new Array(4),E=new Array(4),de=0;de<8;++de){var O=de*8;S[0]=u*e[O+2],S[1]=b*e[O+2],S[2]=u*e[O+6],S[3]=b*e[O+6],M[0]=a*e[O+1]+d*e[O+3]+h*e[O+5]+w*e[O+7],M[1]=d*e[O+1]-w*e[O+3]-a*e[O+5]-h*e[O+7],M[2]=h*e[O+1]-a*e[O+3]+w*e[O+5]+d*e[O+7],M[3]=w*e[O+1]-h*e[O+3]+d*e[O+5]-a*e[O+7],C[0]=t*(e[O+0]+e[O+4]),C[3]=t*(e[O+0]-e[O+4]),C[1]=S[0]+S[3],C[2]=S[1]-S[2],E[0]=C[0]+C[1],E[1]=C[3]+C[2],E[2]=C[3]-C[2],E[3]=C[0]-C[1],e[O+0]=E[0]+M[0],e[O+1]=E[1]+M[1],e[O+2]=E[2]+M[2],e[O+3]=E[3]+M[3],e[O+4]=E[3]-M[3],e[O+5]=E[2]-M[2],e[O+6]=E[1]-M[1],e[O+7]=E[0]-M[0]}for(var L=0;L<8;++L)S[0]=u*e[16+L],S[1]=b*e[16+L],S[2]=u*e[48+L],S[3]=b*e[48+L],M[0]=a*e[8+L]+d*e[24+L]+h*e[40+L]+w*e[56+L],M[1]=d*e[8+L]-w*e[24+L]-a*e[40+L]-h*e[56+L],M[2]=h*e[8+L]-a*e[24+L]+w*e[40+L]+d*e[56+L],M[3]=w*e[8+L]-h*e[24+L]+d*e[40+L]-a*e[56+L],C[0]=t*(e[L]+e[32+L]),C[3]=t*(e[L]-e[32+L]),C[1]=S[0]+S[3],C[2]=S[1]-S[2],E[0]=C[0]+C[1],E[1]=C[3]+C[2],E[2]=C[3]-C[2],E[3]=C[0]-C[1],e[0+L]=E[0]+M[0],e[8+L]=E[1]+M[1],e[16+L]=E[2]+M[2],e[24+L]=E[3]+M[3],e[32+L]=E[3]-M[3],e[40+L]=E[2]-M[2],e[48+L]=E[1]-M[1],e[56+L]=E[0]-M[0]}function Ot(e){for(var t=0;t<64;++t){var a=e[0][t],u=e[1][t],d=e[2][t];e[0][t]=a+1.5747*d,e[1][t]=a-.1873*u-.4682*d,e[2][t]=a+1.8556*u}}function Lt(e,t,a){for(var u=0;u<64;++u)t[a+u]=We.toHalfFloat(kt(e[u]))}function kt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(T,Math.abs(e)-1)}function jr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Bt(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Hr(t)),u=new Uint8Array(a.length);return Dr(a),Pr(a,u),new DataView(u.buffer)}function yr(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),a=cr(t),u=new Uint8Array(a.length);return Dr(a),Pr(a,u),new DataView(u.buffer)}function Dt(e){for(var t=e.viewer,a={value:e.offset.value},u=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),d=new Uint8Array(8192),h=0,b=new Array(e.channels),w=0;w<e.channels;w++)b[w]={},b[w].start=h,b[w].end=b[w].start,b[w].nx=e.width,b[w].ny=e.lines,b[w].size=e.type,h+=b[w].nx*b[w].ny*b[w].size;var S=Ke(t,a),M=Ke(t,a);if(M>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(S<=M)for(var w=0;w<M-S+1;w++)d[w+S]=Ge(t,a);var C=new Uint16Array(65536),E=H(d,C),de=xe(t,a);Br(e.array,t,a,de,u,h);for(var w=0;w<e.channels;++w)for(var O=b[w],L=0;L<b[w].size;++L)Ct(u,O.start+L,O.nx,O.size,O.ny,O.nx*O.size,E);Tt(C,u,h);for(var z=0,X=new Uint8Array(u.buffer.byteLength),ae=0;ae<e.lines;ae++)for(var se=0;se<e.channels;se++){var O=b[se],pe=O.nx*O.size,_e=new Uint8Array(u.buffer,O.end*2,pe*2);X.set(_e,z),z+=pe*2,O.end+=pe}return new DataView(X.buffer)}function Pt(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),a=cr(t);const u=e.lines*e.channels*e.width,d=e.type==1?new Uint16Array(u):new Uint32Array(u);let h=0,b=0;const w=new Array(4);for(let S=0;S<e.lines;S++)for(let M=0;M<e.channels;M++){let C=0;switch(e.type){case 1:w[0]=h,w[1]=w[0]+e.width,h=w[1]+e.width;for(let E=0;E<e.width;++E){const de=a[w[0]++]<<8|a[w[1]++];C+=de,d[b]=C,b++}break;case 2:w[0]=h,w[1]=w[0]+e.width,w[2]=w[1]+e.width,h=w[2]+e.width;for(let E=0;E<e.width;++E){const de=a[w[0]++]<<24|a[w[1]++]<<16|a[w[2]++]<<8;C+=de,d[b]=C,b++}break}}return new DataView(d.buffer)}function zr(e){var t=e.viewer,a={value:e.offset.value},u=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),d={version:Ce(t,a),unknownUncompressedSize:Ce(t,a),unknownCompressedSize:Ce(t,a),acCompressedSize:Ce(t,a),dcCompressedSize:Ce(t,a),rleCompressedSize:Ce(t,a),rleUncompressedSize:Ce(t,a),rleRawSize:Ce(t,a),totalAcUncompressedCount:Ce(t,a),totalDcUncompressedCount:Ce(t,a),acCompression:Ce(t,a)};if(d.version<2)throw"EXRLoader.parse: "+Qe.compression+" version "+d.version+" is unsupported";for(var h=new Array,b=Ke(t,a)-2;b>0;){var w=or(t.buffer,a),S=Ge(t,a),M=S>>2&3,C=(S>>4)-1,E=new Int8Array([C])[0],de=Ge(t,a);h.push({name:w,index:E,type:de,compression:M}),b-=w.length+3}for(var O=Qe.channels,L=new Array(e.channels),z=0;z<e.channels;++z){var X=L[z]={},ae=O[z];X.name=ae.name,X.compression=0,X.decoded=!1,X.type=ae.pixelType,X.pLinear=ae.pLinear,X.width=e.width,X.height=e.lines}for(var se={idx:new Array(3)},pe=0;pe<e.channels;++pe)for(var X=L[pe],z=0;z<h.length;++z){var _e=h[z];X.name==_e.name&&(X.compression=_e.compression,_e.index>=0&&(se.idx[_e.index]=pe),X.offset=pe)}if(d.acCompressedSize>0)switch(d.acCompression){case 0:var le=new Uint16Array(d.totalAcUncompressedCount);Br(e.array,t,a,d.acCompressedSize,le,d.totalAcUncompressedCount);break;case 1:var oe=e.array.slice(a.value,a.value+d.totalAcUncompressedCount),Ne=cr(oe),le=new Uint16Array(Ne.buffer);a.value+=d.totalAcUncompressedCount;break}if(d.dcCompressedSize>0){var ge={array:e.array,offset:a,size:d.dcCompressedSize},ke=new Uint16Array(yr(ge).buffer);a.value+=d.dcCompressedSize}if(d.rleRawSize>0){var oe=e.array.slice(a.value,a.value+d.rleCompressedSize),Ne=cr(oe),er=Hr(Ne.buffer);a.value+=d.rleCompressedSize}for(var Re=0,ne=new Array(L.length),z=0;z<ne.length;++z)ne[z]=new Array;for(var we=0;we<e.lines;++we)for(var ue=0;ue<L.length;++ue)ne[ue].push(Re),Re+=L[ue].width*e.type*2;At(se,ne,L,le,ke,u);for(var z=0;z<L.length;++z){var X=L[z];if(!X.decoded)switch(X.compression){case 2:for(var ee=0,Te=0,we=0;we<e.lines;++we){for(var ze=ne[z][ee],Me=0;Me<X.width;++Me){for(var De=0;De<2*X.type;++De)u[ze++]=er[Te+De*X.width*X.height];Te++}ee++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(u.buffer)}function or(e,t){for(var a=new Uint8Array(e),u=0;a[t.value+u]!=0;)u+=1;var d=new TextDecoder().decode(a.slice(t.value,t.value+u));return t.value=t.value+u+1,d}function Ht(e,t,a){var u=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+a));return t.value=t.value+a,u}function jt(e,t){var a=qe(e,t),u=xe(e,t);return[a,u]}function zt(e,t){var a=xe(e,t),u=xe(e,t);return[a,u]}function qe(e,t){var a=e.getInt32(t.value,!0);return t.value=t.value+4,a}function xe(e,t){var a=e.getUint32(t.value,!0);return t.value=t.value+4,a}function Gr(e,t){var a=e[t.value];return t.value=t.value+1,a}function Ge(e,t){var a=e.getUint8(t.value);return t.value=t.value+1,a}const Ce=function(e,t){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(t.value,!0)):a=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,a};function me(e,t){var a=e.getFloat32(t.value,!0);return t.value+=4,a}function Gt(e,t){return We.toHalfFloat(me(e,t))}function N(e){var t=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(t?t===31?a?NaN:1/0:Math.pow(2,t-15)*(1+a/1024):6103515625e-14*(a/1024))}function Ke(e,t){var a=e.getUint16(t.value,!0);return t.value+=2,a}function Zt(e,t){return N(Ke(e,t))}function Wt(e,t,a,u){for(var d=a.value,h=[];a.value<d+u-1;){var b=or(t,a),w=qe(e,a),S=Ge(e,a);a.value+=3;var M=qe(e,a),C=qe(e,a);h.push({name:b,pixelType:w,pLinear:S,xSampling:M,ySampling:C})}return a.value+=1,h}function $t(e,t){var a=me(e,t),u=me(e,t),d=me(e,t),h=me(e,t),b=me(e,t),w=me(e,t),S=me(e,t),M=me(e,t);return{redX:a,redY:u,greenX:d,greenY:h,blueX:b,blueY:w,whiteX:S,whiteY:M}}function Xt(e,t){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],u=Ge(e,t);return a[u]}function Yt(e,t){var a=xe(e,t),u=xe(e,t),d=xe(e,t),h=xe(e,t);return{xMin:a,yMin:u,xMax:d,yMax:h}}function Vt(e,t){var a=["INCREASING_Y"],u=Ge(e,t);return a[u]}function qt(e,t){var a=me(e,t),u=me(e,t);return[a,u]}function Kt(e,t){var a=me(e,t),u=me(e,t),d=me(e,t);return[a,u,d]}function Jt(e,t,a,u,d){if(u==="string"||u==="stringvector"||u==="iccProfile")return Ht(t,a,d);if(u==="chlist")return Wt(e,t,a,d);if(u==="chromaticities")return $t(e,a);if(u==="compression")return Xt(e,a);if(u==="box2i")return Yt(e,a);if(u==="lineOrder")return Vt(e,a);if(u==="float")return me(e,a);if(u==="v2f")return qt(e,a);if(u==="v3f")return Kt(e,a);if(u==="int")return qe(e,a);if(u==="rational")return jt(e,a);if(u==="timecode")return zt(e,a);if(u==="preview")return a.value+=d,"skipped";a.value+=d}function Qt(e,t,a){const u={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";u.version=e.getUint8(4);const d=e.getUint8(5);u.spec={singleTile:!!(d&2),longName:!!(d&4),deepFormat:!!(d&8),multiPart:!!(d&16)},a.value=8;for(var h=!0;h;){var b=or(t,a);if(b==0)h=!1;else{var w=or(t,a),S=xe(e,a),M=Jt(e,t,a,w,S);M===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${w}'.`):u[b]=M}}if((d&-5)!=0)throw console.error("EXRHeader:",u),"THREE.EXRLoader: provided file is currently unsupported.";return u}function ea(e,t,a,u,d){const h={size:0,viewer:t,array:a,offset:u,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[rr?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":h.lines=1,h.uncompress=jr;break;case"RLE_COMPRESSION":h.lines=1,h.uncompress=Bt;break;case"ZIPS_COMPRESSION":h.lines=1,h.uncompress=yr;break;case"ZIP_COMPRESSION":h.lines=16,h.uncompress=yr;break;case"PIZ_COMPRESSION":h.lines=32,h.uncompress=Dt;break;case"PXR24_COMPRESSION":h.lines=16,h.uncompress=Pt;break;case"DWAA_COMPRESSION":h.lines=32,h.uncompress=zr;break;case"DWAB_COMPRESSION":h.lines=256,h.uncompress=zr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(h.scanlineBlockSize=h.lines,h.type==1)switch(d){case Be:h.getter=Zt,h.inputSize=2;break;case Se:h.getter=Ke,h.inputSize=2;break}else if(h.type==2)switch(d){case Be:h.getter=me,h.inputSize=4;break;case Se:h.getter=Gt,h.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+h.type+" for "+e.compression+".";h.blockCount=(e.dataWindow.yMax+1)/h.scanlineBlockSize;for(var b=0;b<h.blockCount;b++)Ce(t,u);h.outputChannels=h.channels==3?4:h.channels;const w=h.width*h.height*h.outputChannels;switch(d){case Be:h.byteArray=new Float32Array(w),h.channels<h.outputChannels&&h.byteArray.fill(1,0,w);break;case Se:h.byteArray=new Uint16Array(w),h.channels<h.outputChannels&&h.byteArray.fill(15360,0,w);break;default:console.error("THREE.EXRLoader: unsupported type: ",d);break}return h.bytesPerLine=h.width*h.inputSize*h.channels,h.outputChannels==4?h.format=nr:h.format=ia,rr?h.colorSpace="srgb-linear":h.encoding=3e3,h}const lr=new DataView(r),ra=new Uint8Array(r),Je={value:0},Qe=Qt(lr,r,Je),q=ea(Qe,lr,ra,Je,this.type),Zr={value:0},ta={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<q.height/q.scanlineBlockSize;e++){const t=xe(lr,Je);q.size=xe(lr,Je),q.lines=t+q.scanlineBlockSize>q.height?q.height-t:q.scanlineBlockSize;const u=q.size<q.lines*q.bytesPerLine?q.uncompress(q):jr(q);Je.value+=q.size;for(let d=0;d<q.scanlineBlockSize;d++){const h=d+e*q.scanlineBlockSize;if(h>=q.height)break;for(let b=0;b<q.channels;b++){const w=ta[Qe.channels[b].name];for(let S=0;S<q.width;S++){Zr.value=(d*(q.channels*q.width)+b*q.width+S)*q.inputSize;const M=(q.height-1-h)*(q.width*q.outputChannels)+S*q.outputChannels+w;q.byteArray[M]=q.getter(u,Zr)}}}}return{header:Qe,width:q.width,height:q.height,data:q.byteArray,format:q.format,[rr?"colorSpace":"encoding"]:q[rr?"colorSpace":"encoding"],type:this.type}}setDataType(r){return this.type=r,this}load(r,n,l,o){function c(s,f){rr?s.colorSpace=f.colorSpace:s.encoding=f.encoding,s.minFilter=Ue,s.magFilter=Ue,s.generateMipmaps=!1,s.flipY=!1,n&&n(s,f)}return super.load(r,c,l,o)}}function ut(i,r,n,l){var o;return o=class extends vr{constructor(c){super({vertexShader:r,fragmentShader:n,...c});for(const s in i)this.uniforms[s]=new sa(i[s]),Object.defineProperty(this,s,{get(){return this.uniforms[s].value},set(f){this.uniforms[s].value=f}});this.uniforms=oa.clone(this.uniforms)}},o.key=dr.generateUUID(),o}const Ka=()=>parseInt(la.replace(/\D+/g,"")),dt=Ka();function Tr(i,r){const n=g.useRef(null),[l]=g.useState(()=>r?r instanceof Wr?{current:r}:r:n),[o]=g.useState(()=>new ca(void 0));g.useLayoutEffect(()=>{r&&(l.current=r instanceof Wr?r:r.current),o._root=l.current});const c=g.useRef({}),s=g.useMemo(()=>{const f={};return i.forEach(p=>Object.defineProperty(f,p.name,{enumerable:!0,get(){if(l.current)return c.current[p.name]||(c.current[p.name]=o.clipAction(p,l.current))},configurable:!0})),{ref:l,clips:i,actions:f,names:i.map(p=>p.name),mixer:o}},[i]);return Cr((f,p)=>o.update(p)),g.useEffect(()=>{const f=l.current;return()=>{c.current={},o.stopAllAction(),Object.values(s.actions).forEach(p=>{f&&o.uncacheAction(p,f)})}},[i]),s}const Ja=ut({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }"),ht=(i,r,n)=>{let l;switch(i){case Er:l=new Uint8ClampedArray(r*n*4);break;case Se:l=new Uint16Array(r*n*4);break;case ma:l=new Uint32Array(r*n*4);break;case va:l=new Int8Array(r*n*4);break;case ga:l=new Int16Array(r*n*4);break;case pa:l=new Int32Array(r*n*4);break;case Be:l=new Float32Array(r*n*4);break;default:throw new Error("Unsupported data type")}return l};let ur;const Qa=(i,r,n,l)=>{if(ur!==void 0)return ur;const o=new fr(1,1,l);r.setRenderTarget(o);const c=new Ir(new et,new fa({color:16777215}));r.render(c,n),r.setRenderTarget(null);const s=ht(i,o.width,o.height);return r.readRenderTargetPixels(o,0,0,o.width,o.height,s),o.dispose(),c.geometry.dispose(),c.material.dispose(),ur=s[0]!==0,ur};class Ar{constructor(r){var n,l,o,c,s,f,p,v,A,I,F,U,B,Q,P,V;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Y){throw this._renderer.setRenderTarget(null),Y}this._renderer.setRenderTarget(null)},this._width=r.width,this._height=r.height,this._type=r.type,this._colorSpace=r.colorSpace;const Z={format:nr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=r.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(l=r.renderTargetOptions)===null||l===void 0?void 0:l.anisotropy:1,generateMipmaps:((o=r.renderTargetOptions)===null||o===void 0?void 0:o.generateMipmaps)!==void 0?(c=r.renderTargetOptions)===null||c===void 0?void 0:c.generateMipmaps:!1,magFilter:((s=r.renderTargetOptions)===null||s===void 0?void 0:s.magFilter)!==void 0?(f=r.renderTargetOptions)===null||f===void 0?void 0:f.magFilter:Ue,minFilter:((p=r.renderTargetOptions)===null||p===void 0?void 0:p.minFilter)!==void 0?(v=r.renderTargetOptions)===null||v===void 0?void 0:v.minFilter:Ue,samples:((A=r.renderTargetOptions)===null||A===void 0?void 0:A.samples)!==void 0?(I=r.renderTargetOptions)===null||I===void 0?void 0:I.samples:void 0,wrapS:((F=r.renderTargetOptions)===null||F===void 0?void 0:F.wrapS)!==void 0?(U=r.renderTargetOptions)===null||U===void 0?void 0:U.wrapS:He,wrapT:((B=r.renderTargetOptions)===null||B===void 0?void 0:B.wrapT)!==void 0?(Q=r.renderTargetOptions)===null||Q===void 0?void 0:Q.wrapT:He};if(this._material=r.material,r.renderer?this._renderer=r.renderer:(this._renderer=Ar.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Qr,this._camera=new ua,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Qa(this._type,this._renderer,this._camera,Z)){let Y;switch(this._type){case Se:Y=this._renderer.extensions.has("EXT_color_buffer_float")?Be:void 0;break}Y!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Be}`),this._type=Y):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Ir(new et,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new fr(this.width,this.height,Z),this._renderTarget.texture.mapping=((P=r.renderTargetOptions)===null||P===void 0?void 0:P.mapping)!==void 0?(V=r.renderTargetOptions)===null||V===void 0?void 0:V.mapping:pr}static instantiateRenderer(){const r=new da;return r.setSize(128,128),r}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const r=ht(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,r),r}toDataTexture(r){const n=new ha(this.toArray(),this.width,this.height,nr,this._type,(r==null?void 0:r.mapping)||pr,(r==null?void 0:r.wrapS)||He,(r==null?void 0:r.wrapT)||He,(r==null?void 0:r.magFilter)||Ue,(r==null?void 0:r.minFilter)||Ue,(r==null?void 0:r.anisotropy)||1,xr);return n.generateMipmaps=(r==null?void 0:r.generateMipmaps)!==void 0?r==null?void 0:r.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(r){this.disposeOnDemandRenderer(),r&&this.renderTarget.dispose(),this.material instanceof vr&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof $e&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof $e&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(r){this._width=r,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(r){this._height=r,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(r){this._renderTarget=r,this._width=r.width,this._height=r.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const en=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,rn=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class tn extends vr{constructor({gamma:r,offsetHdr:n,offsetSdr:l,gainMapMin:o,gainMapMax:c,maxDisplayBoost:s,hdrCapacityMin:f,hdrCapacityMax:p,sdr:v,gainMap:A}){super({name:"GainMapDecoderMaterial",vertexShader:en,fragmentShader:rn,uniforms:{sdr:{value:v},gainMap:{value:A},gamma:{value:new Ze(1/r[0],1/r[1],1/r[2])},offsetHdr:{value:new Ze().fromArray(n)},offsetSdr:{value:new Ze().fromArray(l)},gainMapMin:{value:new Ze().fromArray(o)},gainMapMax:{value:new Ze().fromArray(c)},weightFactor:{value:(Math.log2(s)-f)/(p-f)}},blending:ba,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=s,this._hdrCapacityMin=f,this._hdrCapacityMax=p,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(r){this.uniforms.sdr.value=r}get gainMap(){return this.uniforms.gainMap.value}set gainMap(r){this.uniforms.gainMap.value=r}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(r){this.uniforms.offsetHdr.value.fromArray(r)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(r){this.uniforms.offsetSdr.value.fromArray(r)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(r){this.uniforms.gainMapMin.value.fromArray(r)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(r){this.uniforms.gainMapMax.value.fromArray(r)}get gamma(){const r=this.uniforms.gamma.value;return[1/r.x,1/r.y,1/r.z]}set gamma(r){const n=this.uniforms.gamma.value;n.x=1/r[0],n.y=1/r[1],n.z=1/r[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(r){this._hdrCapacityMin=r,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(r){this._hdrCapacityMax=r,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(r){this._maxDisplayBoost=Math.max(1,Math.min(65504,r)),this.calculateWeight()}calculateWeight(){const r=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,r))}}class ft extends Error{}class pt extends Error{}const tr=(i,r,n)=>{const l=new RegExp(`${r}="([^"]*)"`,"i").exec(i);if(l)return l[1];const o=new RegExp(`<${r}[^>]*>([\\s\\S]*?)</${r}>`,"i").exec(i);if(o){const c=o[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return c&&c.length===3?c.map(s=>s.replace(/<\/?rdf:li>/g,"")):o[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${r} in gainmap metadata`)},an=i=>{let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(i):r=i.toString();let n=r.indexOf("<x:xmpmeta");for(;n!==-1;){const l=r.indexOf("x:xmpmeta>",n),o=r.slice(n,l+10);try{const c=tr(o,"hdrgm:GainMapMin","0"),s=tr(o,"hdrgm:GainMapMax"),f=tr(o,"hdrgm:Gamma","1"),p=tr(o,"hdrgm:OffsetSDR","0.015625"),v=tr(o,"hdrgm:OffsetHDR","0.015625"),A=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(o),I=A?A[1]:"0",F=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(o);if(!F)throw new Error("Incomplete gainmap metadata");const U=F[1];return{gainMapMin:Array.isArray(c)?c.map(B=>parseFloat(B)):[parseFloat(c),parseFloat(c),parseFloat(c)],gainMapMax:Array.isArray(s)?s.map(B=>parseFloat(B)):[parseFloat(s),parseFloat(s),parseFloat(s)],gamma:Array.isArray(f)?f.map(B=>parseFloat(B)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetSdr:Array.isArray(p)?p.map(B=>parseFloat(B)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetHdr:Array.isArray(v)?v.map(B=>parseFloat(B)):[parseFloat(v),parseFloat(v),parseFloat(v)],hdrCapacityMin:parseFloat(I),hdrCapacityMax:parseFloat(U)}}catch{}n=r.indexOf("<x:xmpmeta",l)}};class nn{constructor(r){this.options={debug:r&&r.debug!==void 0?r.debug:!1,extractFII:r&&r.extractFII!==void 0?r.extractFII:!0,extractNonFII:r&&r.extractNonFII!==void 0?r.extractNonFII:!0}}extract(r){return new Promise((n,l)=>{const o=this.options.debug,c=new DataView(r.buffer);if(c.getUint16(0)!==65496){l(new Error("Not a valid jpeg"));return}const s=c.byteLength;let f=2,p=0,v;for(;f<s;){if(++p>250){l(new Error(`Found no marker after ${p} loops 😵`));return}if(c.getUint8(f)!==255){l(new Error(`Not a valid marker at offset 0x${f.toString(16)}, found: 0x${c.getUint8(f).toString(16)}`));return}if(v=c.getUint8(f+1),o&&console.log(`Marker: ${v.toString(16)}`),v===226){o&&console.log("Found APP2 marker (0xffe2)");const A=f+4;if(c.getUint32(A)===1297106432){const I=A+4;let F;if(c.getUint16(I)===18761)F=!1;else if(c.getUint16(I)===19789)F=!0;else{l(new Error("No valid endianness marker found in TIFF header"));return}if(c.getUint16(I+2,!F)!==42){l(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const U=c.getUint32(I+4,!F);if(U<8){l(new Error("Not valid TIFF data! (First offset less than 8)"));return}const B=I+U,Q=c.getUint16(B,!F),P=B+2;let V=0;for(let m=P;m<P+12*Q;m+=12)c.getUint16(m,!F)===45057&&(V=c.getUint32(m+8,!F));const Y=B+2+Q*12+4,R=[];for(let m=Y;m<Y+V*16;m+=16){const y={MPType:c.getUint32(m,!F),size:c.getUint32(m+4,!F),dataOffset:c.getUint32(m+8,!F),dependantImages:c.getUint32(m+12,!F),start:-1,end:-1,isFII:!1};y.dataOffset?(y.start=I+y.dataOffset,y.isFII=!1):(y.start=0,y.isFII=!0),y.end=y.start+y.size,R.push(y)}if(this.options.extractNonFII&&R.length){const m=new Blob([c]),y=[];for(const D of R){if(D.isFII&&!this.options.extractFII)continue;const x=m.slice(D.start,D.end+1,"image/jpeg");y.push(x)}n(y)}}}f+=2+c.getUint16(f+2)}})}}const sn=async i=>{const r=an(i);if(!r)throw new pt("Gain map XMP metadata not found");const l=await new nn({extractFII:!0,extractNonFII:!0}).extract(i);if(l.length!==2)throw new ft("Gain map recovery image not found");return{sdr:new Uint8Array(await l[0].arrayBuffer()),gainMap:new Uint8Array(await l[1].arrayBuffer()),metadata:r}},Vr=i=>new Promise((r,n)=>{const l=document.createElement("img");l.onload=()=>{r(l)},l.onerror=o=>{n(o)},l.src=URL.createObjectURL(i)});class gt extends wa{constructor(r,n){super(n),r&&(this._renderer=r),this._internalLoadingManager=new ya}setRenderer(r){return this._renderer=r,this}setRenderTargetOptions(r){return this._renderTargetOptions=r,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const r=new tn({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new $e,sdr:new $e});return new Ar({width:16,height:16,type:Se,colorSpace:xr,material:r,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(r,n,l,o){const c=o?new Blob([o],{type:"image/jpeg"}):void 0,s=new Blob([l],{type:"image/jpeg"});let f,p,v=!1;if(typeof createImageBitmap>"u"){const F=await Promise.all([c?Vr(c):Promise.resolve(void 0),Vr(s)]);p=F[0],f=F[1],v=!0}else{const F=await Promise.all([c?createImageBitmap(c,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:"flipY"})]);p=F[0],f=F[1]}const A=new $e(p||new ImageData(2,2),pr,He,He,Ue,$r,nr,Er,1,xr);A.flipY=v,A.needsUpdate=!0;const I=new $e(f,pr,He,He,Ue,$r,nr,Er,1,_a);I.flipY=v,I.needsUpdate=!0,r.width=f.width,r.height=f.height,r.material.gainMap=A,r.material.sdr=I,r.material.gainMapMin=n.gainMapMin,r.material.gainMapMax=n.gainMapMax,r.material.offsetHdr=n.offsetHdr,r.material.offsetSdr=n.offsetSdr,r.material.gamma=n.gamma,r.material.hdrCapacityMin=n.hdrCapacityMin,r.material.hdrCapacityMax=n.hdrCapacityMax,r.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),r.material.needsUpdate=!0,r.render()}}class on extends gt{load([r,n,l],o,c,s){const f=this.prepareQuadRenderer();let p,v,A;const I=async()=>{if(p&&v&&A){try{await this.render(f,A,p,v)}catch(T){this.manager.itemError(r),this.manager.itemError(n),this.manager.itemError(l),typeof s=="function"&&s(T),f.disposeOnDemandRenderer();return}typeof o=="function"&&o(f),this.manager.itemEnd(r),this.manager.itemEnd(n),this.manager.itemEnd(l),f.disposeOnDemandRenderer()}};let F=!0,U=0,B=0,Q=!0,P=0,V=0,Z=!0,Y=0,R=0;const m=()=>{if(typeof c=="function"){const T=U+P+Y,H=B+V+R,G=F&&Q&&Z;c(new ProgressEvent("progress",{lengthComputable:G,loaded:H,total:T}))}};this.manager.itemStart(r),this.manager.itemStart(n),this.manager.itemStart(l);const y=new hr(this._internalLoadingManager);y.setResponseType("arraybuffer"),y.setRequestHeader(this.requestHeader),y.setPath(this.path),y.setWithCredentials(this.withCredentials),y.load(r,async T=>{if(typeof T=="string")throw new Error("Invalid sdr buffer");p=T,await I()},T=>{F=T.lengthComputable,B=T.loaded,U=T.total,m()},T=>{this.manager.itemError(r),typeof s=="function"&&s(T)});const D=new hr(this._internalLoadingManager);D.setResponseType("arraybuffer"),D.setRequestHeader(this.requestHeader),D.setPath(this.path),D.setWithCredentials(this.withCredentials),D.load(n,async T=>{if(typeof T=="string")throw new Error("Invalid gainmap buffer");v=T,await I()},T=>{Q=T.lengthComputable,V=T.loaded,P=T.total,m()},T=>{this.manager.itemError(n),typeof s=="function"&&s(T)});const x=new hr(this._internalLoadingManager);return x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(l,async T=>{if(typeof T!="string")throw new Error("Invalid metadata string");A=JSON.parse(T),await I()},T=>{Z=T.lengthComputable,R=T.loaded,Y=T.total,m()},T=>{this.manager.itemError(l),typeof s=="function"&&s(T)}),f}}class ln extends gt{load(r,n,l,o){const c=this.prepareQuadRenderer(),s=new hr(this._internalLoadingManager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(this.withCredentials),this.manager.itemStart(r),s.load(r,async f=>{if(typeof f=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const p=new Uint8Array(f);let v,A,I;try{const F=await sn(p);v=F.sdr,A=F.gainMap,I=F.metadata}catch(F){if(F instanceof pt||F instanceof ft)console.warn(`Failure to reconstruct an HDR image from ${r}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),I={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},v=p;else throw F}try{await this.render(c,I,v,A)}catch(F){this.manager.itemError(r),typeof o=="function"&&o(F),c.disposeOnDemandRenderer();return}typeof n=="function"&&n(c),this.manager.itemEnd(r),c.disposeOnDemandRenderer()},l,f=>{this.manager.itemError(r),typeof o=="function"&&o(f)}),c}}const ir={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},vt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Xe=i=>Array.isArray(i),Fr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function mr({files:i=Fr,path:r="",preset:n=void 0,colorSpace:l=void 0,extensions:o}={}){n&&(Nr(n),i=ir[n],r=vt);const c=Xe(i),{extension:s,isCubemap:f}=Ur(i),p=Or(s);if(!p)throw new Error("useEnvironment: Unrecognized file extension: "+i);const v=Ie(U=>U.gl);g.useLayoutEffect(()=>{if(s!=="webp"&&s!=="jpg"&&s!=="jpeg")return;function U(){gr.clear(p,c?[i]:i)}v.domElement.addEventListener("webglcontextlost",U,{once:!0})},[i,v.domElement]);const A=gr(p,c?[i]:i,U=>{(s==="webp"||s==="jpg"||s==="jpeg")&&U.setRenderer(v),U.setPath==null||U.setPath(r),o&&o(U)});let I=c?A[0]:A;if(s==="jpg"||s==="jpeg"||s==="webp"){var F;I=(F=I.renderTarget)==null?void 0:F.texture}return I.mapping=f?xa:Ea,I.colorSpace=l??(f?"srgb":"srgb-linear"),I}const cn={files:Fr,path:"",preset:void 0,extensions:void 0};mr.preload=i=>{const r={...cn,...i};let{files:n,path:l=""}=r;const{preset:o,extensions:c}=r;o&&(Nr(o),n=ir[o],l=vt);const{extension:s}=Ur(n);if(s==="webp"||s==="jpg"||s==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const f=Or(s);if(!f)throw new Error("useEnvironment: Unrecognized file extension: "+n);gr.preload(f,Xe(n)?[n]:n,p=>{p.setPath==null||p.setPath(l),c&&c(p)})};const un={files:Fr,preset:void 0};mr.clear=i=>{const r={...un,...i};let{files:n}=r;const{preset:l}=r;l&&(Nr(l),n=ir[l]);const{extension:o}=Ur(n),c=Or(o);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);gr.clear(c,Xe(n)?[n]:n)};function Nr(i){if(!(i in ir))throw new Error("Preset must be one of: "+Object.keys(ir).join(", "))}function Ur(i){var r;const n=Xe(i)&&i.length===6,l=Xe(i)&&i.length===3&&i.some(s=>s.endsWith("json")),o=Xe(i)?i[0]:i;return{extension:n?"cube":l?"webp":o.startsWith("data:application/exr")?"exr":o.startsWith("data:application/hdr")?"hdr":o.startsWith("data:image/jpeg")?"jpg":(r=o.split(".").pop())==null||(r=r.split("?"))==null||(r=r.shift())==null?void 0:r.toLowerCase(),isCubemap:n,isGainmap:l}}function Or(i){return i==="cube"?Ma:i==="hdr"?Va:i==="exr"?qa:i==="jpg"||i==="jpeg"?ln:i==="webp"?on:null}const dn=i=>i.current&&i.current.isScene,hn=i=>dn(i)?i.current:i;function Lr(i,r,n,l,o={}){var c,s,f,p;o={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...o};const v=hn(r||n),A=v.background,I=v.environment,F={backgroundBlurriness:v.backgroundBlurriness,backgroundIntensity:v.backgroundIntensity,backgroundRotation:(c=(s=v.backgroundRotation)==null||s.clone==null?void 0:s.clone())!==null&&c!==void 0?c:[0,0,0],environmentIntensity:v.environmentIntensity,environmentRotation:(f=(p=v.environmentRotation)==null||p.clone==null?void 0:p.clone())!==null&&f!==void 0?f:[0,0,0]};return i!=="only"&&(v.environment=l),i&&(v.background=l),Xr(v,o),()=>{i!=="only"&&(v.environment=I),i&&(v.background=A),Xr(v,F)}}function kr({scene:i,background:r=!1,map:n,...l}){const o=Ie(c=>c.scene);return g.useLayoutEffect(()=>{if(n)return Lr(r,i,o,n,l)}),null}function mt({background:i=!1,scene:r,blur:n,backgroundBlurriness:l,backgroundIntensity:o,backgroundRotation:c,environmentIntensity:s,environmentRotation:f,...p}){const v=mr(p),A=Ie(I=>I.scene);return g.useLayoutEffect(()=>Lr(i,r,A,v,{backgroundBlurriness:n??l,backgroundIntensity:o,backgroundRotation:c,environmentIntensity:s,environmentRotation:f})),g.useEffect(()=>()=>{v.dispose()},[v]),null}function fn({children:i,near:r=.1,far:n=1e3,resolution:l=256,frames:o=1,map:c,background:s=!1,blur:f,backgroundBlurriness:p,backgroundIntensity:v,backgroundRotation:A,environmentIntensity:I,environmentRotation:F,scene:U,files:B,path:Q,preset:P=void 0,extensions:V}){const Z=Ie(x=>x.gl),Y=Ie(x=>x.scene),R=g.useRef(null),[m]=g.useState(()=>new Qr),y=g.useMemo(()=>{const x=new tt(l);return x.texture.type=Se,x},[l]);g.useEffect(()=>()=>{y.dispose()},[y]),g.useLayoutEffect(()=>{if(o===1){const x=Z.autoClear;Z.autoClear=!0,R.current.update(Z,m),Z.autoClear=x}return Lr(s,U,Y,y.texture,{backgroundBlurriness:f??p,backgroundIntensity:v,backgroundRotation:A,environmentIntensity:I,environmentRotation:F})},[i,m,y.texture,U,Y,s,o,Z]);let D=1;return Cr(()=>{if(o===1/0||D<o){const x=Z.autoClear;Z.autoClear=!0,R.current.update(Z,m),Z.autoClear=x,D++}}),g.createElement(g.Fragment,null,Sa(g.createElement(g.Fragment,null,i,g.createElement("cubeCamera",{ref:R,args:[r,n,y]}),B||P?g.createElement(mt,{background:!0,files:B,preset:P,path:Q,extensions:V}):c?g.createElement(kr,{background:!0,map:c,extensions:V}):null),m))}function pn(i){var r,n,l,o;const c=mr(i),s=i.map||c;g.useMemo(()=>Rr({GroundProjectedEnvImpl:Ya}),[]),g.useEffect(()=>()=>{c.dispose()},[c]);const f=g.useMemo(()=>[s],[s]),p=(r=i.ground)==null?void 0:r.height,v=(n=i.ground)==null?void 0:n.radius,A=(l=(o=i.ground)==null?void 0:o.scale)!==null&&l!==void 0?l:1e3;return g.createElement(g.Fragment,null,g.createElement(kr,rt({},i,{map:s})),g.createElement("groundProjectedEnvImpl",{args:f,scale:A,height:p,radius:v}))}function gn(i){return i.ground?g.createElement(pn,i):i.map?g.createElement(kr,i):i.children?g.createElement(fn,i):g.createElement(mt,i)}function vn(i){return i.isLight}function mn(i){return!!i.geometry}const wt=g.createContext(null),wn=ut({color:new at,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${dt>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),yn=g.forwardRef(({children:i,temporal:r,frames:n=40,limit:l=1/0,blend:o=20,scale:c=10,opacity:s=1,alphaTest:f=.75,color:p="black",colorBlend:v=2,resolution:A=1024,toneMapped:I=!0,...F},U)=>{Rr({SoftShadowMaterial:wn});const B=Ie(y=>y.gl),Q=Ie(y=>y.scene),P=Ie(y=>y.camera),V=Ie(y=>y.invalidate),Z=g.useRef(null),Y=g.useRef(null),[R]=g.useState(()=>new _n(B,Q,A));g.useLayoutEffect(()=>{R.configure(Z.current)},[]);const m=g.useMemo(()=>({lights:new Map,temporal:!!r,frames:Math.max(2,n),blend:Math.max(2,n===1/0?o:n),count:0,getMesh:()=>Z.current,reset:()=>{R.clear();const y=Z.current.material;y.opacity=0,y.alphaTest=0,m.count=0},update:(y=1)=>{const D=Z.current.material;m.temporal?(D.opacity=Math.min(s,D.opacity+s/m.blend),D.alphaTest=Math.min(f,D.alphaTest+f/m.blend)):(D.opacity=s,D.alphaTest=f),Y.current.visible=!0,R.prepare();for(let x=0;x<y;x++)m.lights.forEach(T=>T.update()),R.update(P,m.blend);Y.current.visible=!1,R.finish()}}),[R,P,Q,r,n,o,s,f]);return g.useLayoutEffect(()=>{m.reset(),!m.temporal&&m.frames!==1/0&&m.update(m.blend)}),g.useImperativeHandle(U,()=>m,[m]),Cr(()=>{(m.temporal||m.frames===1/0)&&m.count<m.frames&&m.count<l&&(V(),m.update(),m.count++)}),g.createElement("group",F,g.createElement("group",{traverse:()=>null,ref:Y},g.createElement(wt.Provider,{value:m},i)),g.createElement("mesh",{receiveShadow:!0,ref:Z,scale:c,rotation:[-Math.PI/2,0,0]},g.createElement("planeGeometry",null),g.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:I,color:p,blend:v,map:R.progressiveLightMap2.texture})))}),qr=g.forwardRef(({castShadow:i=!0,bias:r=.001,mapSize:n=512,size:l=5,near:o=.5,far:c=500,frames:s=1,position:f=[0,0,0],radius:p=1,amount:v=8,intensity:A=dt>=155?Math.PI:1,ambient:I=.5,...F},U)=>{const B=g.useRef(null),Q=new Ze(...f).length(),P=g.useContext(wt),V=g.useCallback(()=>{let Y;if(B.current)for(let R=0;R<B.current.children.length;R++)if(Y=B.current.children[R],Math.random()>I)Y.position.set(f[0]+dr.randFloatSpread(p),f[1]+dr.randFloatSpread(p),f[2]+dr.randFloatSpread(p));else{let m=Math.acos(2*Math.random()-1)-Math.PI/2,y=2*Math.PI*Math.random();Y.position.set(Math.cos(m)*Math.cos(y)*Q,Math.abs(Math.cos(m)*Math.sin(y)*Q),Math.sin(m)*Q)}},[p,I,Q,...f]),Z=g.useMemo(()=>({update:V}),[V]);return g.useImperativeHandle(U,()=>Z,[Z]),g.useLayoutEffect(()=>{var Y;const R=B.current;return P&&((Y=P.lights)==null||Y.set(R.uuid,Z)),()=>{var m;return void(P==null||(m=P.lights)==null?void 0:m.delete(R.uuid))}},[P,Z]),g.createElement("group",rt({ref:B},F),Array.from({length:v},(Y,R)=>g.createElement("directionalLight",{key:R,castShadow:i,"shadow-bias":r,"shadow-mapSize":[n,n],intensity:A/v},g.createElement("orthographicCamera",{attach:"shadow-camera",args:[-l,l,l,-l,o,c]}))))});class _n{constructor(r,n,l=1024){this.renderer=r,this.res=l,this.scene=n,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new at,this.clearAlpha=0;const o={type:Se,magFilter:Yr,minFilter:Yr};this.progressiveLightMap1=new fr(this.res,this.res,o),this.progressiveLightMap2=new fr(this.res,this.res,o),this.discardMat=new Ja,this.targetMat=new Ia({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=c=>{c.vertexShader=`varying vec2 vUv;
`+c.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const s=c.fragmentShader.indexOf("void main() {");c.fragmentShader=`varying vec2 vUv;
`+c.fragmentShader.slice(0,s)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+c.fragmentShader.slice(s-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,c.uniforms.previousShadowMap=this.previousShadowMap,c.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(r=>{mn(r)?this.meshes.push({object:r,material:r.material}):vn(r)&&this.lights.push({object:r,intensity:r.intensity})})}prepare(){this.lights.forEach(r=>r.object.intensity=0),this.meshes.forEach(r=>r.object.material=this.discardMat)}finish(){this.lights.forEach(r=>r.object.intensity=r.intensity),this.meshes.forEach(r=>r.object.material=r.material)}configure(r){this.object=r}update(r,n=100){if(!this.object)return;this.averagingWindow.value=n,this.object.material=this.targetMat;const l=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,o=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,c=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(l),this.previousShadowMap.value=o.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,r),this.renderer.setRenderTarget(null),this.scene.background=c}}function bn({all:i,scene:r,camera:n}){const l=Ie(({gl:s})=>s),o=Ie(({camera:s})=>s),c=Ie(({scene:s})=>s);return g.useLayoutEffect(()=>{const s=[];i&&(r||c).traverse(v=>{v.visible===!1&&(s.push(v),v.visible=!0)}),l.compile(r||c,n||o);const f=new tt(128);new Ca(.01,1e5,f).update(l,r||c),f.dispose(),s.forEach(v=>v.visible=!1)},[]),null}function yt(i){const r=g.useRef(),{nodes:n,materials:l,animations:o}=Ye("/models/bird_orange.glb"),{actions:c}=Tr(o,r);return g.useEffect(()=>{if(i.playAnimation&&c&&Object.keys(c).length>0){const s=Object.keys(c)[0],f=c[s];if(f)return f.reset().fadeIn(.5).play(),()=>f.fadeOut(.5)}},[i.playAnimation,c]),_.jsx("group",{ref:r,...i,dispose:null,children:_.jsx("group",{name:"Sketchfab_Scene",children:_.jsx("group",{name:"Sketchfab_model",rotation:[-Math.PI/2,0,0],scale:46.683,children:_.jsx("group",{name:"bfb1ea86655f4c4ab4c6cbbb449cedf4fbx",rotation:[Math.PI/2,0,0],scale:.01,children:_.jsx("group",{name:"Object_2",children:_.jsx("group",{name:"RootNode",children:_.jsxs("group",{name:"BirdOrange_all",children:[_.jsx("group",{name:"Main",position:[-.083,0,.451],rotation:[0,-.074,0],children:_.jsxs("group",{name:"Object_6",children:[_.jsx("primitive",{object:n._rootJoint}),_.jsx("skinnedMesh",{name:"Object_51",geometry:n.Object_51.geometry,material:l.BirdOrange_LMB,skeleton:n.Object_51.skeleton}),_.jsx("group",{name:"Object_50"})]})}),_.jsx("group",{name:"Geometry",children:_.jsx("group",{name:"BirdOrange"})})]})})})})})})})}yt.propTypes={playAnimation:J.bool,scale:J.oneOfType([J.number,J.arrayOf(J.number)]),position:J.arrayOf(J.number)};Ye.preload("/models/bird_orange.glb");Ye.preload("/models/cat.glb");Ye.preload("/models/sign.glb");J.string,J.object;Rr(Na);const _t=g.memo(Fa.forwardRef((i,r)=>{const{onPositionChange:n,onBirdHover:l,onCatHover:o,onSignHover:c}=i,s=g.useRef(null),f=g.useRef(null),p=g.useRef(null),v=g.useRef(null),A=g.useRef(null),I=g.useRef({sign:null,birds:null,cat:null,traffic:null});g.useEffect(()=>{r&&(r.current=I)},[r]);const F=g.useRef(!1),U=g.useRef(!1),B=g.useRef(!1);g.useRef(!1);const Q=g.useRef(!1),P=g.useCallback(()=>{if(!A.current||A.current.state==="closed"){const R=window.AudioContext||window.webkitAudioContext;A.current=new R}else A.current.state==="suspended"&&A.current.resume();return A.current},[]),V=g.useCallback(()=>{const R=A.current;R&&(R.state==="suspended"&&R.resume(),!Q.current&&I.current&&(console.log("Starting audio playback..."),Object.entries(I.current).forEach(([m,y])=>{if(y!=null&&y.source&&y.source.buffer)try{y.gainNode.gain.value=.5,y.source.start(0),console.log(`Started ${m} audio source`)}catch(D){D.message.includes("start")||console.error(`Error starting ${m} audio:`,D)}else console.warn(`Audio source or buffer not ready for ${m}`)}),Q.current=!0))},[]);g.useEffect(()=>()=>{var R,m;Q.current&&Object.values(I.current).forEach(y=>{if(y!=null&&y.source)try{y.source.stop(),y.source.disconnect()}catch(D){D.message.includes("stop")||console.error("Error stopping audio:",D)}y!=null&&y.analyzer&&y.analyzer.disconnect(),y!=null&&y.panner&&y.panner.disconnect(),y!=null&&y.gainNode&&y.gainNode.disconnect()}),((R=A.current)==null?void 0:R.state)!=="closed"&&((m=A.current)==null||m.close())},[]);const Z=g.useCallback(()=>{const R=A.current;if(!R)return console.warn("No audio context available for analyzer creation"),null;const m=R.createAnalyser();return m.fftSize=2048,m.smoothingTimeConstant=.8,m.minDecibels=-90,m.maxDecibels=-10,m},[]);g.useEffect(()=>{A.current&&I.current&&Object.entries(I.current).forEach(([R,m])=>{if(m!=null&&m.gainNode&&!m.analyzer){const y=Z();y&&(m.gainNode.connect(y),m.analyzer=y,console.log(`Created analyzer for ${R} audio source`))}})},[Z]),g.useEffect(()=>{(async()=>{try{const m=P(),y=async H=>{console.log(`Loading audio from ${H}`);const G=await fetch(H);if(!G.ok)throw new Error(`Failed to fetch audio file ${H}: ${G.status} ${G.statusText}`);const W=await G.arrayBuffer(),K=await m.decodeAudioData(W),k=m.createBufferSource(),$=m.createPanner(),j=m.createGain();k.buffer=K,k.loop=!0,$.panningModel="HRTF",$.distanceModel="inverse",$.refDistance=1,$.maxDistance=1e4,$.rolloffFactor=1,$.coneInnerAngle=360,$.coneOuterAngle=0,$.coneOuterGain=0,j.gain.value=.5,k.connect($),$.connect(j);const he=Z();return he?(j.connect(he),he.connect(m.destination)):j.connect(m.destination),{source:k,panner:$,gainNode:j,analyzer:he,isStarted:!1}},D={sign:"/audio/sign.mp3",birds:"/audio/birds.mp3",cat:"/audio/cat.mp3",traffic:"/audio/traffic.mp3"},x=await Promise.all(Object.entries(D).map(async([H,G])=>{try{const W=await y(G);return console.log(`Successfully loaded audio for ${H}`),[H,W]}catch(W){return console.error(`Failed to load audio for ${H}:`,W),[H,null]}}));I.current=Object.fromEntries(x.filter(([H,G])=>G!==null));const T=()=>{console.log("First user interaction detected"),V(),document.removeEventListener("click",T),document.removeEventListener("touchstart",T)};document.addEventListener("click",T),document.addEventListener("touchstart",T)}catch(m){console.error("Failed to initialize audio:",m)}})()},[P,V,Z]);const Y=g.useCallback(R=>{var re;if(!s.current)return;const m=s.current.getBoundingClientRect(),y=(R.clientX-m.left)/m.width,D=(R.clientY-m.top)/m.height,x={x:.5,y:.5},T={x:.7,y:.3},H={x:.3,y:.3},G=Math.sqrt(.5),W=Math.hypot(y-x.x,D-x.y),K=Math.hypot(y-T.x,D-T.y),k=Math.hypot(y-H.x,D-H.y),$=Math.max(0,1-W/G),j=Math.max(0,1-K/G),he=Math.max(0,1-k/G),be=.1,ye=1.5;if(I.current.sign){const ve=B.current?$*ye:$,ie=F.current?j*ye:j,fe=U.current?he*ye:he;I.current.sign.gainNode.gain.value=I.current.sign.gainNode.gain.value*(1-be)+ve*be,I.current.birds.gainNode.gain.value=I.current.birds.gainNode.gain.value*(1-be)+ie*be,I.current.cat.gainNode.gain.value=I.current.cat.gainNode.gain.value*(1-be)+fe*be,I.current.sign.panner.setPosition((y-.5)*2,(D-.5)*2,-.5),I.current.birds.panner.setPosition((y-T.x)*2,(D-T.y)*2,-.5),I.current.cat.panner.setPosition((y-H.x)*2,(D-H.y)*2,-.5),Q.current?((re=A.current)==null?void 0:re.state)==="suspended"&&A.current.resume().catch(Ee=>{console.error("Error resuming audio context:",Ee),Ee.message.includes("closed")&&(P(),V())}):((!A.current||A.current.state==="closed")&&P(),V())}Object.values(I.current).forEach(ve=>{ve!=null&&ve.gainNode&&ve.gainNode.gain.value>1&&(ve.gainNode.gain.value=1)}),n==null||n({x:y*2-1,y:-(D*2-1)})},[n,V,P]);return _.jsx("div",{className:"relative h-full w-full p-2 sm:p-4 md:p-6 lg:p-8",children:_.jsx("div",{className:"w-full h-full construction-border",children:_.jsxs("div",{ref:s,className:"w-full h-full bg-gray-900 rounded-lg relative cursor-crosshair overflow-hidden shadow-inner",onMouseMove:Y,onTouchMove:R=>{if(R.touches&&R.touches[0]){const m=R.touches[0],y={clientX:m.clientX,clientY:m.clientY};Y(y)}},children:[_.jsx("div",{className:"absolute w-full h-px bg-gray-700 opacity-70 top-1/2 transform -translate-y-1/2"}),_.jsx("div",{className:"absolute h-full w-px bg-gray-700 opacity-70 left-1/2 transform -translate-x-1/2"}),_.jsx("img",{ref:v,src:"/icons/buzz.svg",alt:"Sign",className:"absolute top-1/2 left-1/2 w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 transform -translate-x-1/2 -translate-y-1/2 filter drop-shadow-[0_0_8px_rgba(77,171,247,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(77,171,247,0.8)] active:scale-110 z-10",title:"Sign",onMouseEnter:()=>{var R;B.current=!0,c(!0),(R=v.current)==null||R.classList.add("animate-pulse")},onMouseLeave:()=>{var R;B.current=!1,c(!1),(R=v.current)==null||R.classList.remove("animate-pulse")}}),_.jsx("img",{ref:f,src:"/icons/bird.svg",alt:"Birds",className:"absolute top-[30%] left-[70%] w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 filter drop-shadow-[0_0_8px_rgba(255,212,59,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(255,212,59,0.8)] active:scale-110 z-10",title:"Birds",onMouseEnter:()=>{var R;F.current=!0,l(!0),(R=f.current)==null||R.classList.add("animate-pulse")},onMouseLeave:()=>{var R;F.current=!1,l(!1),(R=f.current)==null||R.classList.remove("animate-pulse")}}),_.jsx("img",{ref:p,src:"/icons/cat.svg",alt:"Cat",className:"absolute top-[30%] left-[30%] w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 filter drop-shadow-[0_0_8px_rgba(255,107,107,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(255,107,107,0.8)] active:scale-110 z-10",title:"Cat",onMouseEnter:()=>{var R;U.current=!0,o(!0),(R=p.current)==null||R.classList.add("animate-pulse")},onMouseLeave:()=>{var R;U.current=!1,o(!1),(R=p.current)==null||R.classList.remove("animate-pulse")}}),_.jsx("div",{className:`absolute top-1/2 left-1/2 w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-blue-500 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${B.current?"opacity-20":""}`}),_.jsx("div",{className:`absolute top-[30%] left-[70%] w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-yellow-300 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${F.current?"opacity-20":""}`}),_.jsx("div",{className:`absolute top-[30%] left-[30%] w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-red-400 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${U.current?"opacity-20":""}`})]})})})}));_t.propTypes={onPositionChange:J.func,onBirdHover:J.func,onCatHover:J.func,onSignHover:J.func,ref:J.shape({current:J.object})};const bt=g.memo(({isBirdHovered:i,isCatHovered:r,isSignHovered:n})=>{const{camera:l,gl:o}=Ie();return g.useEffect(()=>{l&&(l.position.set(10,2,10),l.fov=60,l.updateProjectionMatrix()),o&&(o.shadowMap.enabled=!0,o.shadowMap.type=Ta)},[l,o]),_.jsxs(_.Fragment,{children:[_.jsx("color",{attach:"background",args:["#9fbcea"]}),_.jsx("fog",{attach:"fog",args:["#9fbcea",10,50]}),_.jsxs(g.Suspense,{fallback:null,children:[_.jsx(gn,{files:"/assets/env/background.jpg",background:!0,blur:0}),_.jsx("hemisphereLight",{intensity:.3,groundColor:"#ffd9b3"}),_.jsx("directionalLight",{castShadow:!0,position:[4,1,10],intensity:7,children:_.jsx("orthographicCamera",{attach:"shadow-camera",args:[-10,10,10,-10,.1,100]})}),_.jsx("spotLight",{castShadow:!0,position:[-5,8,-5],penumbra:1,intensity:400,color:"#b3d9ff","shadow-camera-far":50}),_.jsx(St,{isBirdHovered:i,isCatHovered:r,isSignHovered:n}),_.jsxs(yn,{position:[0,-.99,0],scale:100,frames:100,temporal:!0,opacity:.8,color:"#2a2a2a",blend:.7,children:[_.jsx(qr,{amount:8,radius:6,intensity:1.2,position:[3,5,3],bias:.001}),_.jsx(qr,{amount:4,radius:4,intensity:.8,position:[-5,7,-5],color:"#b3d9ff",bias:.001})]}),_.jsx(bn,{all:!0})]}),_.jsx(Aa,{enableZoom:!0,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/4,enableDamping:!0,dampingFactor:.05})]})});bt.propTypes={isBirdHovered:J.bool,isCatHovered:J.bool,isSignHovered:J.bool};const wr=g.memo(({position:i,rotation:r,scale:n,children:l})=>{const o=g.useRef();return g.useEffect(()=>{o.current&&(i&&o.current.position.set(...i),r&&o.current.rotation.set(...r),n&&(Array.isArray(n)?o.current.scale.set(...n):o.current.scale.set(n,n,n)))},[i,r,n]),_.jsx("group",{ref:o,children:l})});wr.propTypes={children:J.node,position:J.arrayOf(J.number),rotation:J.arrayOf(J.number),scale:J.oneOfType([J.number,J.arrayOf(J.number)])};const xt=g.memo(({isBirdHovered:i})=>_.jsx(wr,{position:[5.8,-.4,7.2],rotation:[0,Math.PI/6,0],children:_.jsx(yt,{scale:.32,playAnimation:i})}));xt.propTypes={isBirdHovered:J.bool};const Et=g.memo(({isCatHovered:i})=>{const{scene:r,animations:n}=Ye("/models/cat.glb"),l=g.useRef(),{actions:o}=Tr(n,l);return g.useEffect(()=>{const c=o;return c&&Object.values(c).forEach(s=>{s&&typeof s.reset=="function"&&(i?s.reset().fadeIn(.2).play():s.fadeOut(.2))}),()=>{c&&Object.values(c).forEach(s=>{if(s&&typeof s.stop=="function")try{s.stop()}catch(f){console.warn("Error stopping cat animation:",f)}})}},[i,o]),_.jsx(wr,{position:[2.8,-.9,3.2],rotation:[0,-Math.PI/2,0],scale:.08,children:_.jsx("group",{ref:l,children:_.jsx("primitive",{object:r})})})});Et.propTypes={isCatHovered:J.bool};const Mt=g.memo(({isSignHovered:i})=>{const{scene:r,animations:n}=Ye("/models/sign.glb"),l=g.useRef(),{actions:o}=Tr(n,l);return g.useEffect(()=>{const c=o;return c&&Object.values(c).forEach(s=>{s&&typeof s.reset=="function"&&(i?s.reset().fadeIn(.2).play():s.fadeOut(.2))}),()=>{c&&Object.values(c).forEach(s=>{if(s&&typeof s.stop=="function")try{s.stop()}catch(f){console.warn("Error stopping sign animation:",f)}})}},[i,o]),_.jsx(wr,{position:[2.9,2.8,0],rotation:[0,Math.PI/3,0],scale:.8,children:_.jsx("group",{ref:l,children:_.jsx("primitive",{object:r})})})});Mt.propTypes={isSignHovered:J.bool};const St=g.memo(({isBirdHovered:i,isCatHovered:r,isSignHovered:n})=>_.jsxs("group",{children:[_.jsx(xt,{isBirdHovered:i}),_.jsx(Et,{isCatHovered:r}),_.jsx(Mt,{isSignHovered:n})]}));St.propTypes={isBirdHovered:J.bool,isCatHovered:J.bool,isSignHovered:J.bool};const xn=()=>_.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900",children:_.jsxs("div",{className:"flex flex-col items-center",children:[_.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),_.jsx("h2",{className:"text-xl text-white font-light",children:"Loading Neuro Experience"}),_.jsx("p",{className:"text-gray-400 mt-2",children:"Please wait while we tune your neural interface..."})]})}),En=()=>{const[i,r]=g.useState({x:0,y:0}),[n,l]=g.useState(!1),[o,c]=g.useState(!1),[s,f]=g.useState(!1),[p,v]=g.useState(!0),[A,I]=g.useState(null),F=g.useCallback((U,B)=>{B?I(U):A===U&&I(null)},[A]);return g.useEffect(()=>{const U=setTimeout(()=>{v(!1)},2e3);return()=>clearTimeout(U)},[]),p?_.jsx(xn,{}):_.jsxs("div",{className:"h-full grid grid-rows-[1fr,auto]",children:[_.jsxs("div",{className:"relative w-full h-full",children:[_.jsx(Ra,{shadows:!0,dpr:[1,2],camera:{position:[10,2,10],fov:60},children:_.jsx(bt,{isBirdHovered:n,isCatHovered:o,isSignHovered:s})}),A&&_.jsxs("div",{className:"absolute top-16 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-full text-sm font-medium flex items-center space-x-2 animate-[fadeIn_0.5s_ease-in-out]",children:[_.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-[pulse_1.5s_infinite_ease-in-out]"}),_.jsxs("span",{children:["Focusing on: ",A]})]})]}),_.jsx("div",{className:"h-[25vh] min-h-[200px] max-h-[250px] bg-gradient-to-b from-gray-900 to-gray-800 backdrop-blur-md",children:_.jsx(_t,{ref:U=>{U&&(window.audioRefs=U)},onPositionChange:r,onBirdHover:U=>{l(U),F("birds",U)},onCatHover:U=>{c(U),F("cat",U)},onSignHover:U=>{f(U),F("sign",U)}})})]})},Mn=({title:i,sub:r})=>_.jsxs("div",{className:"flex flex-col items-center gap-5",children:[_.jsx("div",{className:"hero-badge",children:_.jsx("p",{children:r})}),_.jsx("div",{children:_.jsx("h1",{className:"font-semibold md:text-5xl text-3xl text-center",children:i})})]}),It=({children:i})=>{const[r,n]=g.useState(!1),[l,o]=g.useState("");g.useEffect(()=>{const s=f=>{var p;console.error("Application Error:",f),!((p=f.message)!=null&&p.includes("AudioContext"))&&(o(f.message||"An unexpected error occurred"),n(!0))};return window.addEventListener("error",s),()=>window.removeEventListener("error",s)},[]);const c=g.useCallback(()=>{if(n(!1),o(""),window.audioContext){try{window.audioContext.close()}catch(s){console.error("Error closing audio context:",s)}delete window.audioContext}},[]);return r?_.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-900",children:_.jsxs("div",{className:"text-center text-white",children:[_.jsx("h2",{className:"text-xl mb-4",children:"Something went wrong"}),_.jsx("p",{className:"text-gray-400 mb-4",children:l}),_.jsx("button",{className:"px-4 py-2 bg-blue-500 rounded hover:bg-blue-600",onClick:c,children:"Try again"})]})}):i};It.propTypes={children:J.node.isRequired};const In=()=>(g.useEffect(()=>(window.scrollTo(0,0),()=>{if(window.audioContext){try{window.audioContext.close()}catch(i){console.error("Error closing audio context:",i)}delete window.audioContext}}),[]),_.jsx(It,{children:_.jsxs("section",{className:"h-screen overflow-hidden bg-gradient-to-b from-gray-900 to-gray-800",children:[_.jsx("div",{className:"absolute top-12 left-4 z-10",children:_.jsxs(Ua,{to:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900/50 backdrop-blur-sm rounded-lg text-white hover:bg-gray-800 transition-all",children:[_.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",children:_.jsx("path",{d:"M15 10H5M5 10L10 15M5 10L10 5"})}),"Home"]})}),_.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 text-center z-10",children:_.jsx(Mn,{})}),_.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-sm text-gray-400 z-10",children:"Move cursor to focus on sound of interest"}),_.jsx("div",{className:"h-full",role:"main","aria-label":"3D Audio Experience",children:_.jsx(En,{})})]})}));export{In as default};
