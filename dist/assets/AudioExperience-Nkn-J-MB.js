import{J as Sr,K as na,S as Cr,D as ia,N as Kr,O as Jr,Q as Se,R as Be,U as We,V as Oe,W as nr,X as sa,Y as oa,r as p,Z as Wr,_ as la,a as Ir,$ as je,a0 as Qr,a1 as ca,a2 as et,a3 as hr,a4 as fr,a5 as ua,a6 as da,a7 as _r,a8 as $e,a9 as ha,aa as fa,ab as ga,ac as pa,ad as va,ae as xr,af as dr,ag as ma,ah as wa,ai as $r,aj as ya,ak as ba,al as Ze,am as Ce,an as gr,ao as _a,ap as xa,aq as Ea,e as Rr,ar as rt,as as tt,at as Ma,au as Xr,av as wr,C as at,aw as Yr,ax as Sa,ay as Ca,u as Ye,j as y,P as Q,c as Ia,az as Ra,aA as Ta,aB as Aa,aC as Fa,L as Na}from"./index-BYGCyQlB.js";import{s as nt}from"./shaderMaterial-C2FNOz3U.js";var Ae=Uint8Array,He=Uint16Array,Er=Uint32Array,it=new Ae([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),st=new Ae([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Oa=new Ae([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ot=function(a,r){for(var n=new He(31),l=0;l<31;++l)n[l]=r+=1<<a[l-1];for(var s=new Er(n[30]),l=1;l<30;++l)for(var c=n[l];c<n[l+1];++c)s[c]=c-n[l]<<5|l;return[n,s]},lt=ot(it,2),ct=lt[0],Ua=lt[1];ct[28]=258,Ua[258]=28;var La=ot(st,0),ka=La[0],Mr=new He(32768);for(var ce=0;ce<32768;++ce){var Pe=(ce&43690)>>>1|(ce&21845)<<1;Pe=(Pe&52428)>>>2|(Pe&13107)<<2,Pe=(Pe&61680)>>>4|(Pe&3855)<<4,Mr[ce]=((Pe&65280)>>>8|(Pe&255)<<8)>>>1}var ar=function(a,r,n){for(var l=a.length,s=0,c=new He(r);s<l;++s)++c[a[s]-1];var o=new He(r);for(s=0;s<r;++s)o[s]=o[s-1]+c[s-1]<<1;var f;if(n){f=new He(1<<r);var g=15-r;for(s=0;s<l;++s)if(a[s])for(var v=s<<4|a[s],R=r-a[s],x=o[a[s]-1]++<<R,F=x|(1<<R)-1;x<=F;++x)f[Mr[x]>>>g]=v}else for(f=new He(l),s=0;s<l;++s)a[s]&&(f[s]=Mr[o[a[s]-1]++]>>>15-a[s]);return f},sr=new Ae(288);for(var ce=0;ce<144;++ce)sr[ce]=8;for(var ce=144;ce<256;++ce)sr[ce]=9;for(var ce=256;ce<280;++ce)sr[ce]=7;for(var ce=280;ce<288;++ce)sr[ce]=8;var ut=new Ae(32);for(var ce=0;ce<32;++ce)ut[ce]=5;var Ba=ar(sr,9,1),Da=ar(ut,5,1),yr=function(a){for(var r=a[0],n=1;n<a.length;++n)a[n]>r&&(r=a[n]);return r},Fe=function(a,r,n){var l=r/8|0;return(a[l]|a[l+1]<<8)>>(r&7)&n},br=function(a,r){var n=r/8|0;return(a[n]|a[n+1]<<8|a[n+2]<<16)>>(r&7)},Pa=function(a){return(a/8|0)+(a&7&&1)},ja=function(a,r,n){(n==null||n>a.length)&&(n=a.length);var l=new(a instanceof He?He:a instanceof Er?Er:Ae)(n-r);return l.set(a.subarray(r,n)),l},Ha=function(a,r,n){var l=a.length;if(!l||n&&!n.l&&l<5)return r||new Ae(0);var s=!r||n,c=!n||n.i;n||(n={}),r||(r=new Ae(l*3));var o=function(te){var Ue=r.length;if(te>Ue){var Le=new Ae(Math.max(Ue*2,te));Le.set(r),r=Le}},f=n.f||0,g=n.p||0,v=n.b||0,R=n.l,x=n.d,F=n.m,D=n.n,O=l*8;do{if(!R){n.f=f=Fe(a,g,1);var Z=Fe(a,g+1,3);if(g+=3,Z)if(Z==1)R=Ba,x=Da,F=9,D=5;else if(Z==2){var q=Fe(a,g,31)+257,T=Fe(a,g+10,15)+4,m=q+Fe(a,g+5,31)+1;g+=14;for(var b=new Ae(m),P=new Ae(19),E=0;E<T;++E)P[Oa[E]]=Fe(a,g+E*3,7);g+=T*3;for(var A=yr(P),j=(1<<A)-1,W=ar(P,A,1),E=0;E<m;){var $=W[Fe(a,g,j)];g+=$&15;var k=$>>>4;if(k<16)b[E++]=k;else{var J=0,B=0;for(k==16?(B=3+Fe(a,g,3),g+=2,J=b[E-1]):k==17?(B=3+Fe(a,g,7),g+=3):k==18&&(B=11+Fe(a,g,127),g+=7);B--;)b[E++]=J}}var Y=b.subarray(0,q),H=b.subarray(q);F=yr(Y),D=yr(H),R=ar(Y,F,1),x=ar(H,D,1)}else throw"invalid block type";else{var k=Pa(g)+4,X=a[k-4]|a[k-3]<<8,z=k+X;if(z>l){if(c)throw"unexpected EOF";break}s&&o(v+X),r.set(a.subarray(k,z),v),n.b=v+=X,n.p=g=z*8;continue}if(g>O){if(c)throw"unexpected EOF";break}}s&&o(v+131072);for(var he=(1<<F)-1,_e=(1<<D)-1,ye=g;;ye=g){var J=R[br(a,g)&he],re=J>>>4;if(g+=J&15,g>O){if(c)throw"unexpected EOF";break}if(!J)throw"invalid length/literal";if(re<256)r[v++]=re;else if(re==256){ye=g,R=null;break}else{var ve=re-254;if(re>264){var E=re-257,ie=it[E];ve=Fe(a,g,(1<<ie)-1)+ct[E],g+=ie}var fe=x[br(a,g)&_e],Ee=fe>>>4;if(!fe)throw"invalid distance";g+=fe&15;var H=ka[Ee];if(Ee>3){var ie=st[Ee];H+=br(a,g)&(1<<ie)-1,g+=ie}if(g>O){if(c)throw"unexpected EOF";break}s&&o(v+131072);for(var Ve=v+ve;v<Ve;v+=4)r[v]=r[v-H],r[v+1]=r[v+1-H],r[v+2]=r[v+2-H],r[v+3]=r[v+3-H];v=Ve}}n.l=R,n.p=ye,n.b=v,R&&(f=1,n.m=F,n.d=x,n.n=D)}while(!f);return v==r.length?r:ja(r,0,v)},za=new Ae(0),Ga=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function cr(a,r){return Ha((Ga(a),a.subarray(2,-4)),r)}var Za=typeof TextDecoder<"u"&&new TextDecoder,Wa=0;try{Za.decode(za,{stream:!0}),Wa=1}catch{}const $a=a=>a&&a.isCubeTexture;class Xa extends Sr{constructor(r,n){var l,s;const c=$a(r),f=((s=c?(l=r.image[0])==null?void 0:l.width:r.image.width)!=null?s:1024)/4,g=Math.floor(Math.log2(f)),v=Math.pow(2,g),R=3*Math.max(v,16*7),x=4*v,F=[c?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/R}`,`#define CUBEUV_TEXEL_HEIGHT ${1/x}`,`#define CUBEUV_MAX_MIP ${g}.0`],D=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,O=F.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Kr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,Z={map:{value:r},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},k=new na(1,16),X=new Cr({uniforms:Z,fragmentShader:O,vertexShader:D,side:ia});super(k,X)}set radius(r){this.material.uniforms.radius.value=r}get radius(){return this.material.uniforms.radius.value}set height(r){this.material.uniforms.height.value=r}get height(){return this.material.uniforms.height.value}}class Ya extends Jr{constructor(r){super(r),this.type=Se}parse(r){const o=function(E,A){switch(E){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(A||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(A||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(A||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(A||""))}},R=`
`,x=function(E,A,j){A=A||1024;let $=E.pos,J=-1,B=0,Y="",H=String.fromCharCode.apply(null,new Uint16Array(E.subarray($,$+128)));for(;0>(J=H.indexOf(R))&&B<A&&$<E.byteLength;)Y+=H,B+=H.length,$+=128,H+=String.fromCharCode.apply(null,new Uint16Array(E.subarray($,$+128)));return-1<J?(E.pos+=B+J+1,Y+H.slice(0,J)):!1},F=function(E){const A=/^#\?(\S+)/,j=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,W=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,$=/^\s*FORMAT=(\S+)\s*$/,J=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,B={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,H;for((E.pos>=E.byteLength||!(Y=x(E)))&&o(1,"no header found"),(H=Y.match(A))||o(3,"bad initial token"),B.valid|=1,B.programtype=H[1],B.string+=Y+`
`;Y=x(E),Y!==!1;){if(B.string+=Y+`
`,Y.charAt(0)==="#"){B.comments+=Y+`
`;continue}if((H=Y.match(j))&&(B.gamma=parseFloat(H[1])),(H=Y.match(W))&&(B.exposure=parseFloat(H[1])),(H=Y.match($))&&(B.valid|=2,B.format=H[1]),(H=Y.match(J))&&(B.valid|=4,B.height=parseInt(H[1],10),B.width=parseInt(H[2],10)),B.valid&2&&B.valid&4)break}return B.valid&2||o(3,"missing format specifier"),B.valid&4||o(3,"missing image size specifier"),B},D=function(E,A,j){const W=A;if(W<8||W>32767||E[0]!==2||E[1]!==2||E[2]&128)return new Uint8Array(E);W!==(E[2]<<8|E[3])&&o(3,"wrong scanline width");const $=new Uint8Array(4*A*j);$.length||o(4,"unable to allocate buffer space");let J=0,B=0;const Y=4*W,H=new Uint8Array(4),he=new Uint8Array(Y);let _e=j;for(;_e>0&&B<E.byteLength;){B+4>E.byteLength&&o(1),H[0]=E[B++],H[1]=E[B++],H[2]=E[B++],H[3]=E[B++],(H[0]!=2||H[1]!=2||(H[2]<<8|H[3])!=W)&&o(3,"bad rgbe scanline format");let ye=0,re;for(;ye<Y&&B<E.byteLength;){re=E[B++];const ie=re>128;if(ie&&(re-=128),(re===0||ye+re>Y)&&o(3,"bad scanline data"),ie){const fe=E[B++];for(let Ee=0;Ee<re;Ee++)he[ye++]=fe}else he.set(E.subarray(B,B+re),ye),ye+=re,B+=re}const ve=W;for(let ie=0;ie<ve;ie++){let fe=0;$[J]=he[ie+fe],fe+=W,$[J+1]=he[ie+fe],fe+=W,$[J+2]=he[ie+fe],fe+=W,$[J+3]=he[ie+fe],J+=4}_e--}return $},O=function(E,A,j,W){const $=E[A+3],J=Math.pow(2,$-128)/255;j[W+0]=E[A+0]*J,j[W+1]=E[A+1]*J,j[W+2]=E[A+2]*J,j[W+3]=1},Z=function(E,A,j,W){const $=E[A+3],J=Math.pow(2,$-128)/255;j[W+0]=We.toHalfFloat(Math.min(E[A+0]*J,65504)),j[W+1]=We.toHalfFloat(Math.min(E[A+1]*J,65504)),j[W+2]=We.toHalfFloat(Math.min(E[A+2]*J,65504)),j[W+3]=We.toHalfFloat(1)},k=new Uint8Array(r);k.pos=0;const X=F(k),z=X.width,q=X.height,T=D(k.subarray(k.pos),z,q);let m,b,P;switch(this.type){case Be:P=T.length/4;const E=new Float32Array(P*4);for(let j=0;j<P;j++)O(T,j*4,E,j*4);m=E,b=Be;break;case Se:P=T.length/4;const A=new Uint16Array(P*4);for(let j=0;j<P;j++)Z(T,j*4,A,j*4);m=A,b=Se;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:z,height:q,data:m,header:X.string,gamma:X.gamma,exposure:X.exposure,type:b}}setDataType(r){return this.type=r,this}load(r,n,l,s){function c(o,f){switch(o.type){case Be:case Se:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Oe,o.magFilter=Oe,o.generateMipmaps=!1,o.flipY=!0;break}n&&n(o,f)}return super.load(r,c,l,s)}}const rr=Kr>=152;class Va extends Jr{constructor(r){super(r),this.type=Se}parse(r){const A=Math.pow(2.7182818,2.2);function j(e,t){for(var i=0,u=0;u<65536;++u)(u==0||e[u>>3]&1<<(u&7))&&(t[i++]=u);for(var d=i-1;i<65536;)t[i++]=0;return d}function W(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const $={l:0,c:0,lc:0};function J(e,t,i,u,d){for(;i<e;)t=t<<8|Gr(u,d),i+=8;i-=e,$.l=t>>i&(1<<e)-1,$.c=t,$.lc=i}const B=new Array(59);function Y(e){for(var t=0;t<=58;++t)B[t]=0;for(var t=0;t<65537;++t)B[e[t]]+=1;for(var i=0,t=58;t>0;--t){var u=i+B[t]>>1;B[t]=i,i=u}for(var t=0;t<65537;++t){var d=e[t];d>0&&(e[t]=d|B[d]++<<6)}}function H(e,t,i,u,d,h,_){for(var w=i,C=0,S=0;d<=h;d++){if(w.value-i.value>u)return!1;J(6,C,S,e,w);var I=$.l;if(C=$.c,S=$.lc,_[d]=I,I==63){if(w.value-i.value>u)throw"Something wrong with hufUnpackEncTable";J(8,C,S,e,w);var M=$.l+6;if(C=$.c,S=$.lc,d+M>h+1)throw"Something wrong with hufUnpackEncTable";for(;M--;)_[d++]=0;d--}else if(I>=59){var M=I-59+2;if(d+M>h+1)throw"Something wrong with hufUnpackEncTable";for(;M--;)_[d++]=0;d--}}Y(_)}function he(e){return e&63}function _e(e){return e>>6}function ye(e,t,i,u){for(;t<=i;t++){var d=_e(e[t]),h=he(e[t]);if(d>>h)throw"Invalid table entry";if(h>14){var _=u[d>>h-14];if(_.len)throw"Invalid table entry";if(_.lit++,_.p){var w=_.p;_.p=new Array(_.lit);for(var C=0;C<_.lit-1;++C)_.p[C]=w[C]}else _.p=new Array(1);_.p[_.lit-1]=t}else if(h)for(var S=0,C=1<<14-h;C>0;C--){var _=u[(d<<14-h)+S];if(_.len||_.p)throw"Invalid table entry";_.len=h,_.lit=t,S++}}return!0}const re={c:0,lc:0};function ve(e,t,i,u){e=e<<8|Gr(i,u),t+=8,re.c=e,re.lc=t}const ie={c:0,lc:0};function fe(e,t,i,u,d,h,_,w,C,S){if(e==t){u<8&&(ve(i,u,d,_),i=re.c,u=re.lc),u-=8;var I=i>>u,I=new Uint8Array([I])[0];if(C.value+I>S)return!1;for(var M=w[C.value-1];I-- >0;)w[C.value++]=M}else if(C.value<S)w[C.value++]=e;else return!1;ie.c=i,ie.lc=u}function Ee(e){return e&65535}function Ve(e){var t=Ee(e);return t>32767?t-65536:t}const te={a:0,b:0};function Ue(e,t){var i=Ve(e),u=Ve(t),d=u,h=i+(d&1)+(d>>1),_=h,w=h-d;te.a=_,te.b=w}function Le(e,t){var i=Ee(e),u=Ee(t),d=i-(u>>1)&65535,h=u+d-32768&65535;te.a=h,te.b=d}function Rt(e,t,i,u,d,h,_){for(var w=_<16384,C=i>d?d:i,S=1,I;S<=C;)S<<=1;for(S>>=1,I=S,S>>=1;S>=1;){for(var M=0,de=M+h*(d-I),U=h*S,L=h*I,G=u*S,V=u*I,ae,se,ge,be;M<=de;M+=L){for(var oe=M,Ne=M+u*(i-I);oe<=Ne;oe+=V){var le=oe+G,pe=oe+U,ke=pe+G;w?(Ue(e[oe+t],e[pe+t]),ae=te.a,ge=te.b,Ue(e[le+t],e[ke+t]),se=te.a,be=te.b,Ue(ae,se),e[oe+t]=te.a,e[le+t]=te.b,Ue(ge,be),e[pe+t]=te.a,e[ke+t]=te.b):(Le(e[oe+t],e[pe+t]),ae=te.a,ge=te.b,Le(e[le+t],e[ke+t]),se=te.a,be=te.b,Le(ae,se),e[oe+t]=te.a,e[le+t]=te.b,Le(ge,be),e[pe+t]=te.a,e[ke+t]=te.b)}if(i&S){var pe=oe+U;w?Ue(e[oe+t],e[pe+t]):Le(e[oe+t],e[pe+t]),ae=te.a,e[pe+t]=te.b,e[oe+t]=ae}}if(d&S)for(var oe=M,Ne=M+u*(i-I);oe<=Ne;oe+=V){var le=oe+G;w?Ue(e[oe+t],e[le+t]):Le(e[oe+t],e[le+t]),ae=te.a,e[le+t]=te.b,e[oe+t]=ae}I=S,S>>=1}return M}function Tt(e,t,i,u,d,h,_,w,C,S){for(var I=0,M=0,de=w,U=Math.trunc(d.value+(h+7)/8);d.value<U;)for(ve(I,M,i,d),I=re.c,M=re.lc;M>=14;){var L=I>>M-14&16383,G=t[L];if(G.len)M-=G.len,fe(G.lit,_,I,M,i,u,d,C,S,de),I=ie.c,M=ie.lc;else{if(!G.p)throw"hufDecode issues";var V;for(V=0;V<G.lit;V++){for(var ae=he(e[G.p[V]]);M<ae&&d.value<U;)ve(I,M,i,d),I=re.c,M=re.lc;if(M>=ae&&_e(e[G.p[V]])==(I>>M-ae&(1<<ae)-1)){M-=ae,fe(G.p[V],_,I,M,i,u,d,C,S,de),I=ie.c,M=ie.lc;break}}if(V==G.lit)throw"hufDecode issues"}}var se=8-h&7;for(I>>=se,M-=se;M>0;){var G=t[I<<14-M&16383];if(G.len)M-=G.len,fe(G.lit,_,I,M,i,u,d,C,S,de),I=ie.c,M=ie.lc;else throw"hufDecode issues"}return!0}function Br(e,t,i,u,d,h){var _={value:0},w=i.value,C=xe(t,i),S=xe(t,i);i.value+=4;var I=xe(t,i);if(i.value+=4,C<0||C>=65537||S<0||S>=65537)throw"Something wrong with HUF_ENCSIZE";var M=new Array(65537),de=new Array(16384);W(de);var U=u-(i.value-w);if(H(e,t,i,U,C,S,M),I>8*(u-(i.value-w)))throw"Something wrong with hufUncompress";ye(M,C,S,de),Tt(M,de,e,t,i,I,S,h,d,_)}function At(e,t,i){for(var u=0;u<i;++u)t[u]=e[t[u]]}function Dr(e){for(var t=1;t<e.length;t++){var i=e[t-1]+e[t]-128;e[t]=i}}function Pr(e,t){for(var i=0,u=Math.floor((e.length+1)/2),d=0,h=e.length-1;!(d>h||(t[d++]=e[i++],d>h));)t[d++]=e[u++]}function jr(e){for(var t=e.byteLength,i=new Array,u=0,d=new DataView(e);t>0;){var h=d.getInt8(u++);if(h<0){var _=-h;t-=_+1;for(var w=0;w<_;w++)i.push(d.getUint8(u++))}else{var _=h;t-=2;for(var C=d.getUint8(u++),w=0;w<_+1;w++)i.push(C)}}return i}function Ft(e,t,i,u,d,h){var le=new DataView(h.buffer),_=i[e.idx[0]].width,w=i[e.idx[0]].height,C=3,S=Math.floor(_/8),I=Math.ceil(_/8),M=Math.ceil(w/8),de=_-(I-1)*8,U=w-(M-1)*8,L={value:0},G=new Array(C),V=new Array(C),ae=new Array(C),se=new Array(C),ge=new Array(C);for(let ne=0;ne<C;++ne)ge[ne]=t[e.idx[ne]],G[ne]=ne<1?0:G[ne-1]+I*M,V[ne]=new Float32Array(64),ae[ne]=new Uint16Array(64),se[ne]=new Uint16Array(I*64);for(let ne=0;ne<M;++ne){var be=8;ne==M-1&&(be=U);var oe=8;for(let ue=0;ue<I;++ue){ue==I-1&&(oe=de);for(let ee=0;ee<C;++ee)ae[ee].fill(0),ae[ee][0]=d[G[ee]++],Nt(L,u,ae[ee]),Ot(ae[ee],V[ee]),Ut(V[ee]);Lt(V);for(let ee=0;ee<C;++ee)kt(V[ee],se[ee],ue*64)}let we=0;for(let ue=0;ue<C;++ue){const ee=i[e.idx[ue]].type;for(let Te=8*ne;Te<8*ne+be;++Te){we=ge[ue][Te];for(let ze=0;ze<S;++ze){const Me=ze*64+(Te&7)*8;le.setUint16(we+0*2*ee,se[ue][Me+0],!0),le.setUint16(we+1*2*ee,se[ue][Me+1],!0),le.setUint16(we+2*2*ee,se[ue][Me+2],!0),le.setUint16(we+3*2*ee,se[ue][Me+3],!0),le.setUint16(we+4*2*ee,se[ue][Me+4],!0),le.setUint16(we+5*2*ee,se[ue][Me+5],!0),le.setUint16(we+6*2*ee,se[ue][Me+6],!0),le.setUint16(we+7*2*ee,se[ue][Me+7],!0),we+=8*2*ee}}if(S!=I)for(let Te=8*ne;Te<8*ne+be;++Te){const ze=ge[ue][Te]+8*S*2*ee,Me=S*64+(Te&7)*8;for(let De=0;De<oe;++De)le.setUint16(ze+De*2*ee,se[ue][Me+De],!0)}}}for(var Ne=new Uint16Array(_),le=new DataView(h.buffer),pe=0;pe<C;++pe){i[e.idx[pe]].decoded=!0;var ke=i[e.idx[pe]].type;if(i[pe].type==2)for(var er=0;er<w;++er){const ne=ge[pe][er];for(var Re=0;Re<_;++Re)Ne[Re]=le.getUint16(ne+Re*2*ke,!0);for(var Re=0;Re<_;++Re)le.setFloat32(ne+Re*2*ke,N(Ne[Re]),!0)}}}function Nt(e,t,i){for(var u,d=1;d<64;)u=t[e.value],u==65280?d=64:u>>8==255?d+=u&255:(i[d]=u,d++),e.value++}function Ot(e,t){t[0]=N(e[0]),t[1]=N(e[1]),t[2]=N(e[5]),t[3]=N(e[6]),t[4]=N(e[14]),t[5]=N(e[15]),t[6]=N(e[27]),t[7]=N(e[28]),t[8]=N(e[2]),t[9]=N(e[4]),t[10]=N(e[7]),t[11]=N(e[13]),t[12]=N(e[16]),t[13]=N(e[26]),t[14]=N(e[29]),t[15]=N(e[42]),t[16]=N(e[3]),t[17]=N(e[8]),t[18]=N(e[12]),t[19]=N(e[17]),t[20]=N(e[25]),t[21]=N(e[30]),t[22]=N(e[41]),t[23]=N(e[43]),t[24]=N(e[9]),t[25]=N(e[11]),t[26]=N(e[18]),t[27]=N(e[24]),t[28]=N(e[31]),t[29]=N(e[40]),t[30]=N(e[44]),t[31]=N(e[53]),t[32]=N(e[10]),t[33]=N(e[19]),t[34]=N(e[23]),t[35]=N(e[32]),t[36]=N(e[39]),t[37]=N(e[45]),t[38]=N(e[52]),t[39]=N(e[54]),t[40]=N(e[20]),t[41]=N(e[22]),t[42]=N(e[33]),t[43]=N(e[38]),t[44]=N(e[46]),t[45]=N(e[51]),t[46]=N(e[55]),t[47]=N(e[60]),t[48]=N(e[21]),t[49]=N(e[34]),t[50]=N(e[37]),t[51]=N(e[47]),t[52]=N(e[50]),t[53]=N(e[56]),t[54]=N(e[59]),t[55]=N(e[61]),t[56]=N(e[35]),t[57]=N(e[36]),t[58]=N(e[48]),t[59]=N(e[49]),t[60]=N(e[57]),t[61]=N(e[58]),t[62]=N(e[62]),t[63]=N(e[63])}function Ut(e){const t=.5*Math.cos(.7853975),i=.5*Math.cos(3.14159/16),u=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),h=.5*Math.cos(5*3.14159/16),_=.5*Math.cos(3*3.14159/8),w=.5*Math.cos(7*3.14159/16);for(var C=new Array(4),S=new Array(4),I=new Array(4),M=new Array(4),de=0;de<8;++de){var U=de*8;C[0]=u*e[U+2],C[1]=_*e[U+2],C[2]=u*e[U+6],C[3]=_*e[U+6],S[0]=i*e[U+1]+d*e[U+3]+h*e[U+5]+w*e[U+7],S[1]=d*e[U+1]-w*e[U+3]-i*e[U+5]-h*e[U+7],S[2]=h*e[U+1]-i*e[U+3]+w*e[U+5]+d*e[U+7],S[3]=w*e[U+1]-h*e[U+3]+d*e[U+5]-i*e[U+7],I[0]=t*(e[U+0]+e[U+4]),I[3]=t*(e[U+0]-e[U+4]),I[1]=C[0]+C[3],I[2]=C[1]-C[2],M[0]=I[0]+I[1],M[1]=I[3]+I[2],M[2]=I[3]-I[2],M[3]=I[0]-I[1],e[U+0]=M[0]+S[0],e[U+1]=M[1]+S[1],e[U+2]=M[2]+S[2],e[U+3]=M[3]+S[3],e[U+4]=M[3]-S[3],e[U+5]=M[2]-S[2],e[U+6]=M[1]-S[1],e[U+7]=M[0]-S[0]}for(var L=0;L<8;++L)C[0]=u*e[16+L],C[1]=_*e[16+L],C[2]=u*e[48+L],C[3]=_*e[48+L],S[0]=i*e[8+L]+d*e[24+L]+h*e[40+L]+w*e[56+L],S[1]=d*e[8+L]-w*e[24+L]-i*e[40+L]-h*e[56+L],S[2]=h*e[8+L]-i*e[24+L]+w*e[40+L]+d*e[56+L],S[3]=w*e[8+L]-h*e[24+L]+d*e[40+L]-i*e[56+L],I[0]=t*(e[L]+e[32+L]),I[3]=t*(e[L]-e[32+L]),I[1]=C[0]+C[3],I[2]=C[1]-C[2],M[0]=I[0]+I[1],M[1]=I[3]+I[2],M[2]=I[3]-I[2],M[3]=I[0]-I[1],e[0+L]=M[0]+S[0],e[8+L]=M[1]+S[1],e[16+L]=M[2]+S[2],e[24+L]=M[3]+S[3],e[32+L]=M[3]-S[3],e[40+L]=M[2]-S[2],e[48+L]=M[1]-S[1],e[56+L]=M[0]-S[0]}function Lt(e){for(var t=0;t<64;++t){var i=e[0][t],u=e[1][t],d=e[2][t];e[0][t]=i+1.5747*d,e[1][t]=i-.1873*u-.4682*d,e[2][t]=i+1.8556*u}}function kt(e,t,i){for(var u=0;u<64;++u)t[i+u]=We.toHalfFloat(Bt(e[u]))}function Bt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(A,Math.abs(e)-1)}function Hr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Dt(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),i=new Uint8Array(jr(t)),u=new Uint8Array(i.length);return Dr(i),Pr(i,u),new DataView(u.buffer)}function mr(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),i=cr(t),u=new Uint8Array(i.length);return Dr(i),Pr(i,u),new DataView(u.buffer)}function Pt(e){for(var t=e.viewer,i={value:e.offset.value},u=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),d=new Uint8Array(8192),h=0,_=new Array(e.channels),w=0;w<e.channels;w++)_[w]={},_[w].start=h,_[w].end=_[w].start,_[w].nx=e.width,_[w].ny=e.lines,_[w].size=e.type,h+=_[w].nx*_[w].ny*_[w].size;var C=Ke(t,i),S=Ke(t,i);if(S>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(C<=S)for(var w=0;w<S-C+1;w++)d[w+C]=Ge(t,i);var I=new Uint16Array(65536),M=j(d,I),de=xe(t,i);Br(e.array,t,i,de,u,h);for(var w=0;w<e.channels;++w)for(var U=_[w],L=0;L<_[w].size;++L)Rt(u,U.start+L,U.nx,U.size,U.ny,U.nx*U.size,M);At(I,u,h);for(var G=0,V=new Uint8Array(u.buffer.byteLength),ae=0;ae<e.lines;ae++)for(var se=0;se<e.channels;se++){var U=_[se],ge=U.nx*U.size,be=new Uint8Array(u.buffer,U.end*2,ge*2);V.set(be,G),G+=ge*2,U.end+=ge}return new DataView(V.buffer)}function jt(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),i=cr(t);const u=e.lines*e.channels*e.width,d=e.type==1?new Uint16Array(u):new Uint32Array(u);let h=0,_=0;const w=new Array(4);for(let C=0;C<e.lines;C++)for(let S=0;S<e.channels;S++){let I=0;switch(e.type){case 1:w[0]=h,w[1]=w[0]+e.width,h=w[1]+e.width;for(let M=0;M<e.width;++M){const de=i[w[0]++]<<8|i[w[1]++];I+=de,d[_]=I,_++}break;case 2:w[0]=h,w[1]=w[0]+e.width,w[2]=w[1]+e.width,h=w[2]+e.width;for(let M=0;M<e.width;++M){const de=i[w[0]++]<<24|i[w[1]++]<<16|i[w[2]++]<<8;I+=de,d[_]=I,_++}break}}return new DataView(d.buffer)}function zr(e){var t=e.viewer,i={value:e.offset.value},u=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),d={version:Ie(t,i),unknownUncompressedSize:Ie(t,i),unknownCompressedSize:Ie(t,i),acCompressedSize:Ie(t,i),dcCompressedSize:Ie(t,i),rleCompressedSize:Ie(t,i),rleUncompressedSize:Ie(t,i),rleRawSize:Ie(t,i),totalAcUncompressedCount:Ie(t,i),totalDcUncompressedCount:Ie(t,i),acCompression:Ie(t,i)};if(d.version<2)throw"EXRLoader.parse: "+Qe.compression+" version "+d.version+" is unsupported";for(var h=new Array,_=Ke(t,i)-2;_>0;){var w=or(t.buffer,i),C=Ge(t,i),S=C>>2&3,I=(C>>4)-1,M=new Int8Array([I])[0],de=Ge(t,i);h.push({name:w,index:M,type:de,compression:S}),_-=w.length+3}for(var U=Qe.channels,L=new Array(e.channels),G=0;G<e.channels;++G){var V=L[G]={},ae=U[G];V.name=ae.name,V.compression=0,V.decoded=!1,V.type=ae.pixelType,V.pLinear=ae.pLinear,V.width=e.width,V.height=e.lines}for(var se={idx:new Array(3)},ge=0;ge<e.channels;++ge)for(var V=L[ge],G=0;G<h.length;++G){var be=h[G];V.name==be.name&&(V.compression=be.compression,be.index>=0&&(se.idx[be.index]=ge),V.offset=ge)}if(d.acCompressedSize>0)switch(d.acCompression){case 0:var le=new Uint16Array(d.totalAcUncompressedCount);Br(e.array,t,i,d.acCompressedSize,le,d.totalAcUncompressedCount);break;case 1:var oe=e.array.slice(i.value,i.value+d.totalAcUncompressedCount),Ne=cr(oe),le=new Uint16Array(Ne.buffer);i.value+=d.totalAcUncompressedCount;break}if(d.dcCompressedSize>0){var pe={array:e.array,offset:i,size:d.dcCompressedSize},ke=new Uint16Array(mr(pe).buffer);i.value+=d.dcCompressedSize}if(d.rleRawSize>0){var oe=e.array.slice(i.value,i.value+d.rleCompressedSize),Ne=cr(oe),er=jr(Ne.buffer);i.value+=d.rleCompressedSize}for(var Re=0,ne=new Array(L.length),G=0;G<ne.length;++G)ne[G]=new Array;for(var we=0;we<e.lines;++we)for(var ue=0;ue<L.length;++ue)ne[ue].push(Re),Re+=L[ue].width*e.type*2;Ft(se,ne,L,le,ke,u);for(var G=0;G<L.length;++G){var V=L[G];if(!V.decoded)switch(V.compression){case 2:for(var ee=0,Te=0,we=0;we<e.lines;++we){for(var ze=ne[G][ee],Me=0;Me<V.width;++Me){for(var De=0;De<2*V.type;++De)u[ze++]=er[Te+De*V.width*V.height];Te++}ee++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(u.buffer)}function or(e,t){for(var i=new Uint8Array(e),u=0;i[t.value+u]!=0;)u+=1;var d=new TextDecoder().decode(i.slice(t.value,t.value+u));return t.value=t.value+u+1,d}function Ht(e,t,i){var u=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+i));return t.value=t.value+i,u}function zt(e,t){var i=qe(e,t),u=xe(e,t);return[i,u]}function Gt(e,t){var i=xe(e,t),u=xe(e,t);return[i,u]}function qe(e,t){var i=e.getInt32(t.value,!0);return t.value=t.value+4,i}function xe(e,t){var i=e.getUint32(t.value,!0);return t.value=t.value+4,i}function Gr(e,t){var i=e[t.value];return t.value=t.value+1,i}function Ge(e,t){var i=e.getUint8(t.value);return t.value=t.value+1,i}const Ie=function(e,t){let i;return"getBigInt64"in DataView.prototype?i=Number(e.getBigInt64(t.value,!0)):i=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,i};function me(e,t){var i=e.getFloat32(t.value,!0);return t.value+=4,i}function Zt(e,t){return We.toHalfFloat(me(e,t))}function N(e){var t=(e&31744)>>10,i=e&1023;return(e>>15?-1:1)*(t?t===31?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):6103515625e-14*(i/1024))}function Ke(e,t){var i=e.getUint16(t.value,!0);return t.value+=2,i}function Wt(e,t){return N(Ke(e,t))}function $t(e,t,i,u){for(var d=i.value,h=[];i.value<d+u-1;){var _=or(t,i),w=qe(e,i),C=Ge(e,i);i.value+=3;var S=qe(e,i),I=qe(e,i);h.push({name:_,pixelType:w,pLinear:C,xSampling:S,ySampling:I})}return i.value+=1,h}function Xt(e,t){var i=me(e,t),u=me(e,t),d=me(e,t),h=me(e,t),_=me(e,t),w=me(e,t),C=me(e,t),S=me(e,t);return{redX:i,redY:u,greenX:d,greenY:h,blueX:_,blueY:w,whiteX:C,whiteY:S}}function Yt(e,t){var i=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],u=Ge(e,t);return i[u]}function Vt(e,t){var i=xe(e,t),u=xe(e,t),d=xe(e,t),h=xe(e,t);return{xMin:i,yMin:u,xMax:d,yMax:h}}function qt(e,t){var i=["INCREASING_Y"],u=Ge(e,t);return i[u]}function Kt(e,t){var i=me(e,t),u=me(e,t);return[i,u]}function Jt(e,t){var i=me(e,t),u=me(e,t),d=me(e,t);return[i,u,d]}function Qt(e,t,i,u,d){if(u==="string"||u==="stringvector"||u==="iccProfile")return Ht(t,i,d);if(u==="chlist")return $t(e,t,i,d);if(u==="chromaticities")return Xt(e,i);if(u==="compression")return Yt(e,i);if(u==="box2i")return Vt(e,i);if(u==="lineOrder")return qt(e,i);if(u==="float")return me(e,i);if(u==="v2f")return Kt(e,i);if(u==="v3f")return Jt(e,i);if(u==="int")return qe(e,i);if(u==="rational")return zt(e,i);if(u==="timecode")return Gt(e,i);if(u==="preview")return i.value+=d,"skipped";i.value+=d}function ea(e,t,i){const u={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";u.version=e.getUint8(4);const d=e.getUint8(5);u.spec={singleTile:!!(d&2),longName:!!(d&4),deepFormat:!!(d&8),multiPart:!!(d&16)},i.value=8;for(var h=!0;h;){var _=or(t,i);if(_==0)h=!1;else{var w=or(t,i),C=xe(e,i),S=Qt(e,t,i,w,C);S===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${w}'.`):u[_]=S}}if((d&-5)!=0)throw console.error("EXRHeader:",u),"THREE.EXRLoader: provided file is currently unsupported.";return u}function ra(e,t,i,u,d){const h={size:0,viewer:t,array:i,offset:u,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[rr?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":h.lines=1,h.uncompress=Hr;break;case"RLE_COMPRESSION":h.lines=1,h.uncompress=Dt;break;case"ZIPS_COMPRESSION":h.lines=1,h.uncompress=mr;break;case"ZIP_COMPRESSION":h.lines=16,h.uncompress=mr;break;case"PIZ_COMPRESSION":h.lines=32,h.uncompress=Pt;break;case"PXR24_COMPRESSION":h.lines=16,h.uncompress=jt;break;case"DWAA_COMPRESSION":h.lines=32,h.uncompress=zr;break;case"DWAB_COMPRESSION":h.lines=256,h.uncompress=zr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(h.scanlineBlockSize=h.lines,h.type==1)switch(d){case Be:h.getter=Wt,h.inputSize=2;break;case Se:h.getter=Ke,h.inputSize=2;break}else if(h.type==2)switch(d){case Be:h.getter=me,h.inputSize=4;break;case Se:h.getter=Zt,h.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+h.type+" for "+e.compression+".";h.blockCount=(e.dataWindow.yMax+1)/h.scanlineBlockSize;for(var _=0;_<h.blockCount;_++)Ie(t,u);h.outputChannels=h.channels==3?4:h.channels;const w=h.width*h.height*h.outputChannels;switch(d){case Be:h.byteArray=new Float32Array(w),h.channels<h.outputChannels&&h.byteArray.fill(1,0,w);break;case Se:h.byteArray=new Uint16Array(w),h.channels<h.outputChannels&&h.byteArray.fill(15360,0,w);break;default:console.error("THREE.EXRLoader: unsupported type: ",d);break}return h.bytesPerLine=h.width*h.inputSize*h.channels,h.outputChannels==4?h.format=nr:h.format=sa,rr?h.colorSpace="srgb-linear":h.encoding=3e3,h}const lr=new DataView(r),ta=new Uint8Array(r),Je={value:0},Qe=ea(lr,r,Je),K=ra(Qe,lr,ta,Je,this.type),Zr={value:0},aa={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<K.height/K.scanlineBlockSize;e++){const t=xe(lr,Je);K.size=xe(lr,Je),K.lines=t+K.scanlineBlockSize>K.height?K.height-t:K.scanlineBlockSize;const u=K.size<K.lines*K.bytesPerLine?K.uncompress(K):Hr(K);Je.value+=K.size;for(let d=0;d<K.scanlineBlockSize;d++){const h=d+e*K.scanlineBlockSize;if(h>=K.height)break;for(let _=0;_<K.channels;_++){const w=aa[Qe.channels[_].name];for(let C=0;C<K.width;C++){Zr.value=(d*(K.channels*K.width)+_*K.width+C)*K.inputSize;const S=(K.height-1-h)*(K.width*K.outputChannels)+C*K.outputChannels+w;K.byteArray[S]=K.getter(u,Zr)}}}}return{header:Qe,width:K.width,height:K.height,data:K.byteArray,format:K.format,[rr?"colorSpace":"encoding"]:K[rr?"colorSpace":"encoding"],type:this.type}}setDataType(r){return this.type=r,this}load(r,n,l,s){function c(o,f){rr?o.colorSpace=f.colorSpace:o.encoding=f.encoding,o.minFilter=Oe,o.magFilter=Oe,o.generateMipmaps=!1,o.flipY=!1,n&&n(o,f)}return super.load(r,c,l,s)}}const qa=()=>parseInt(oa.replace(/\D+/g,"")),dt=qa();function Tr(a,r){const n=p.useRef(null),[l]=p.useState(()=>r?r instanceof Wr?{current:r}:r:n),[s]=p.useState(()=>new la(void 0));p.useLayoutEffect(()=>{r&&(l.current=r instanceof Wr?r:r.current),s._root=l.current});const c=p.useRef({}),o=p.useMemo(()=>{const f={};return a.forEach(g=>Object.defineProperty(f,g.name,{enumerable:!0,get(){if(l.current)return c.current[g.name]||(c.current[g.name]=s.clipAction(g,l.current))},configurable:!0})),{ref:l,clips:a,actions:f,names:a.map(g=>g.name),mixer:s}},[a]);return Ir((f,g)=>s.update(g)),p.useEffect(()=>{const f=l.current;return()=>{c.current={},s.stopAllAction(),Object.values(o.actions).forEach(g=>{f&&s.uncacheAction(g,f)})}},[a]),o}const Ka=nt({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }"),ht=(a,r,n)=>{let l;switch(a){case xr:l=new Uint8ClampedArray(r*n*4);break;case Se:l=new Uint16Array(r*n*4);break;case va:l=new Uint32Array(r*n*4);break;case pa:l=new Int8Array(r*n*4);break;case ga:l=new Int16Array(r*n*4);break;case fa:l=new Int32Array(r*n*4);break;case Be:l=new Float32Array(r*n*4);break;default:throw new Error("Unsupported data type")}return l};let ur;const Ja=(a,r,n,l)=>{if(ur!==void 0)return ur;const s=new hr(1,1,l);r.setRenderTarget(s);const c=new Sr(new et,new ha({color:16777215}));r.render(c,n),r.setRenderTarget(null);const o=ht(a,s.width,s.height);return r.readRenderTargetPixels(s,0,0,s.width,s.height,o),s.dispose(),c.geometry.dispose(),c.material.dispose(),ur=o[0]!==0,ur};class Ar{constructor(r){var n,l,s,c,o,f,g,v,R,x,F,D,O,Z,k,X;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(q){throw this._renderer.setRenderTarget(null),q}this._renderer.setRenderTarget(null)},this._width=r.width,this._height=r.height,this._type=r.type,this._colorSpace=r.colorSpace;const z={format:nr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=r.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(l=r.renderTargetOptions)===null||l===void 0?void 0:l.anisotropy:1,generateMipmaps:((s=r.renderTargetOptions)===null||s===void 0?void 0:s.generateMipmaps)!==void 0?(c=r.renderTargetOptions)===null||c===void 0?void 0:c.generateMipmaps:!1,magFilter:((o=r.renderTargetOptions)===null||o===void 0?void 0:o.magFilter)!==void 0?(f=r.renderTargetOptions)===null||f===void 0?void 0:f.magFilter:Oe,minFilter:((g=r.renderTargetOptions)===null||g===void 0?void 0:g.minFilter)!==void 0?(v=r.renderTargetOptions)===null||v===void 0?void 0:v.minFilter:Oe,samples:((R=r.renderTargetOptions)===null||R===void 0?void 0:R.samples)!==void 0?(x=r.renderTargetOptions)===null||x===void 0?void 0:x.samples:void 0,wrapS:((F=r.renderTargetOptions)===null||F===void 0?void 0:F.wrapS)!==void 0?(D=r.renderTargetOptions)===null||D===void 0?void 0:D.wrapS:je,wrapT:((O=r.renderTargetOptions)===null||O===void 0?void 0:O.wrapT)!==void 0?(Z=r.renderTargetOptions)===null||Z===void 0?void 0:Z.wrapT:je};if(this._material=r.material,r.renderer?this._renderer=r.renderer:(this._renderer=Ar.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Qr,this._camera=new ca,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Ja(this._type,this._renderer,this._camera,z)){let q;switch(this._type){case Se:q=this._renderer.extensions.has("EXT_color_buffer_float")?Be:void 0;break}q!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Be}`),this._type=q):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Sr(new et,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new hr(this.width,this.height,z),this._renderTarget.texture.mapping=((k=r.renderTargetOptions)===null||k===void 0?void 0:k.mapping)!==void 0?(X=r.renderTargetOptions)===null||X===void 0?void 0:X.mapping:fr}static instantiateRenderer(){const r=new ua;return r.setSize(128,128),r}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const r=ht(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,r),r}toDataTexture(r){const n=new da(this.toArray(),this.width,this.height,nr,this._type,(r==null?void 0:r.mapping)||fr,(r==null?void 0:r.wrapS)||je,(r==null?void 0:r.wrapT)||je,(r==null?void 0:r.magFilter)||Oe,(r==null?void 0:r.minFilter)||Oe,(r==null?void 0:r.anisotropy)||1,_r);return n.generateMipmaps=(r==null?void 0:r.generateMipmaps)!==void 0?r==null?void 0:r.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(r){this.disposeOnDemandRenderer(),r&&this.renderTarget.dispose(),this.material instanceof Cr&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof $e&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof $e&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(r){this._width=r,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(r){this._height=r,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(r){this._renderTarget=r,this._width=r.width,this._height=r.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Qa=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,en=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class rn extends Cr{constructor({gamma:r,offsetHdr:n,offsetSdr:l,gainMapMin:s,gainMapMax:c,maxDisplayBoost:o,hdrCapacityMin:f,hdrCapacityMax:g,sdr:v,gainMap:R}){super({name:"GainMapDecoderMaterial",vertexShader:Qa,fragmentShader:en,uniforms:{sdr:{value:v},gainMap:{value:R},gamma:{value:new Ze(1/r[0],1/r[1],1/r[2])},offsetHdr:{value:new Ze().fromArray(n)},offsetSdr:{value:new Ze().fromArray(l)},gainMapMin:{value:new Ze().fromArray(s)},gainMapMax:{value:new Ze().fromArray(c)},weightFactor:{value:(Math.log2(o)-f)/(g-f)}},blending:ba,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=f,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(r){this.uniforms.sdr.value=r}get gainMap(){return this.uniforms.gainMap.value}set gainMap(r){this.uniforms.gainMap.value=r}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(r){this.uniforms.offsetHdr.value.fromArray(r)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(r){this.uniforms.offsetSdr.value.fromArray(r)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(r){this.uniforms.gainMapMin.value.fromArray(r)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(r){this.uniforms.gainMapMax.value.fromArray(r)}get gamma(){const r=this.uniforms.gamma.value;return[1/r.x,1/r.y,1/r.z]}set gamma(r){const n=this.uniforms.gamma.value;n.x=1/r[0],n.y=1/r[1],n.z=1/r[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(r){this._hdrCapacityMin=r,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(r){this._hdrCapacityMax=r,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(r){this._maxDisplayBoost=Math.max(1,Math.min(65504,r)),this.calculateWeight()}calculateWeight(){const r=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,r))}}class ft extends Error{}class gt extends Error{}const tr=(a,r,n)=>{const l=new RegExp(`${r}="([^"]*)"`,"i").exec(a);if(l)return l[1];const s=new RegExp(`<${r}[^>]*>([\\s\\S]*?)</${r}>`,"i").exec(a);if(s){const c=s[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return c&&c.length===3?c.map(o=>o.replace(/<\/?rdf:li>/g,"")):s[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${r} in gainmap metadata`)},tn=a=>{let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(a):r=a.toString();let n=r.indexOf("<x:xmpmeta");for(;n!==-1;){const l=r.indexOf("x:xmpmeta>",n),s=r.slice(n,l+10);try{const c=tr(s,"hdrgm:GainMapMin","0"),o=tr(s,"hdrgm:GainMapMax"),f=tr(s,"hdrgm:Gamma","1"),g=tr(s,"hdrgm:OffsetSDR","0.015625"),v=tr(s,"hdrgm:OffsetHDR","0.015625"),R=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(s),x=R?R[1]:"0",F=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(s);if(!F)throw new Error("Incomplete gainmap metadata");const D=F[1];return{gainMapMin:Array.isArray(c)?c.map(O=>parseFloat(O)):[parseFloat(c),parseFloat(c),parseFloat(c)],gainMapMax:Array.isArray(o)?o.map(O=>parseFloat(O)):[parseFloat(o),parseFloat(o),parseFloat(o)],gamma:Array.isArray(f)?f.map(O=>parseFloat(O)):[parseFloat(f),parseFloat(f),parseFloat(f)],offsetSdr:Array.isArray(g)?g.map(O=>parseFloat(O)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetHdr:Array.isArray(v)?v.map(O=>parseFloat(O)):[parseFloat(v),parseFloat(v),parseFloat(v)],hdrCapacityMin:parseFloat(x),hdrCapacityMax:parseFloat(D)}}catch{}n=r.indexOf("<x:xmpmeta",l)}};class an{constructor(r){this.options={debug:r&&r.debug!==void 0?r.debug:!1,extractFII:r&&r.extractFII!==void 0?r.extractFII:!0,extractNonFII:r&&r.extractNonFII!==void 0?r.extractNonFII:!0}}extract(r){return new Promise((n,l)=>{const s=this.options.debug,c=new DataView(r.buffer);if(c.getUint16(0)!==65496){l(new Error("Not a valid jpeg"));return}const o=c.byteLength;let f=2,g=0,v;for(;f<o;){if(++g>250){l(new Error(`Found no marker after ${g} loops ðŸ˜µ`));return}if(c.getUint8(f)!==255){l(new Error(`Not a valid marker at offset 0x${f.toString(16)}, found: 0x${c.getUint8(f).toString(16)}`));return}if(v=c.getUint8(f+1),s&&console.log(`Marker: ${v.toString(16)}`),v===226){s&&console.log("Found APP2 marker (0xffe2)");const R=f+4;if(c.getUint32(R)===1297106432){const x=R+4;let F;if(c.getUint16(x)===18761)F=!1;else if(c.getUint16(x)===19789)F=!0;else{l(new Error("No valid endianness marker found in TIFF header"));return}if(c.getUint16(x+2,!F)!==42){l(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const D=c.getUint32(x+4,!F);if(D<8){l(new Error("Not valid TIFF data! (First offset less than 8)"));return}const O=x+D,Z=c.getUint16(O,!F),k=O+2;let X=0;for(let m=k;m<k+12*Z;m+=12)c.getUint16(m,!F)===45057&&(X=c.getUint32(m+8,!F));const q=O+2+Z*12+4,T=[];for(let m=q;m<q+X*16;m+=16){const b={MPType:c.getUint32(m,!F),size:c.getUint32(m+4,!F),dataOffset:c.getUint32(m+8,!F),dependantImages:c.getUint32(m+12,!F),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=x+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,T.push(b)}if(this.options.extractNonFII&&T.length){const m=new Blob([c]),b=[];for(const P of T){if(P.isFII&&!this.options.extractFII)continue;const E=m.slice(P.start,P.end+1,"image/jpeg");b.push(E)}n(b)}}}f+=2+c.getUint16(f+2)}})}}const nn=async a=>{const r=tn(a);if(!r)throw new gt("Gain map XMP metadata not found");const l=await new an({extractFII:!0,extractNonFII:!0}).extract(a);if(l.length!==2)throw new ft("Gain map recovery image not found");return{sdr:new Uint8Array(await l[0].arrayBuffer()),gainMap:new Uint8Array(await l[1].arrayBuffer()),metadata:r}},Vr=a=>new Promise((r,n)=>{const l=document.createElement("img");l.onload=()=>{r(l)},l.onerror=s=>{n(s)},l.src=URL.createObjectURL(a)});class pt extends ma{constructor(r,n){super(n),r&&(this._renderer=r),this._internalLoadingManager=new wa}setRenderer(r){return this._renderer=r,this}setRenderTargetOptions(r){return this._renderTargetOptions=r,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const r=new rn({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new $e,sdr:new $e});return new Ar({width:16,height:16,type:Se,colorSpace:_r,material:r,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(r,n,l,s){const c=s?new Blob([s],{type:"image/jpeg"}):void 0,o=new Blob([l],{type:"image/jpeg"});let f,g,v=!1;if(typeof createImageBitmap>"u"){const F=await Promise.all([c?Vr(c):Promise.resolve(void 0),Vr(o)]);g=F[0],f=F[1],v=!0}else{const F=await Promise.all([c?createImageBitmap(c,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);g=F[0],f=F[1]}const R=new $e(g||new ImageData(2,2),fr,je,je,Oe,$r,nr,xr,1,_r);R.flipY=v,R.needsUpdate=!0;const x=new $e(f,fr,je,je,Oe,$r,nr,xr,1,ya);x.flipY=v,x.needsUpdate=!0,r.width=f.width,r.height=f.height,r.material.gainMap=R,r.material.sdr=x,r.material.gainMapMin=n.gainMapMin,r.material.gainMapMax=n.gainMapMax,r.material.offsetHdr=n.offsetHdr,r.material.offsetSdr=n.offsetSdr,r.material.gamma=n.gamma,r.material.hdrCapacityMin=n.hdrCapacityMin,r.material.hdrCapacityMax=n.hdrCapacityMax,r.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),r.material.needsUpdate=!0,r.render()}}class sn extends pt{load([r,n,l],s,c,o){const f=this.prepareQuadRenderer();let g,v,R;const x=async()=>{if(g&&v&&R){try{await this.render(f,R,g,v)}catch(A){this.manager.itemError(r),this.manager.itemError(n),this.manager.itemError(l),typeof o=="function"&&o(A),f.disposeOnDemandRenderer();return}typeof s=="function"&&s(f),this.manager.itemEnd(r),this.manager.itemEnd(n),this.manager.itemEnd(l),f.disposeOnDemandRenderer()}};let F=!0,D=0,O=0,Z=!0,k=0,X=0,z=!0,q=0,T=0;const m=()=>{if(typeof c=="function"){const A=D+k+q,j=O+X+T,W=F&&Z&&z;c(new ProgressEvent("progress",{lengthComputable:W,loaded:j,total:A}))}};this.manager.itemStart(r),this.manager.itemStart(n),this.manager.itemStart(l);const b=new dr(this._internalLoadingManager);b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(r,async A=>{if(typeof A=="string")throw new Error("Invalid sdr buffer");g=A,await x()},A=>{F=A.lengthComputable,O=A.loaded,D=A.total,m()},A=>{this.manager.itemError(r),typeof o=="function"&&o(A)});const P=new dr(this._internalLoadingManager);P.setResponseType("arraybuffer"),P.setRequestHeader(this.requestHeader),P.setPath(this.path),P.setWithCredentials(this.withCredentials),P.load(n,async A=>{if(typeof A=="string")throw new Error("Invalid gainmap buffer");v=A,await x()},A=>{Z=A.lengthComputable,X=A.loaded,k=A.total,m()},A=>{this.manager.itemError(n),typeof o=="function"&&o(A)});const E=new dr(this._internalLoadingManager);return E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(this.withCredentials),E.load(l,async A=>{if(typeof A!="string")throw new Error("Invalid metadata string");R=JSON.parse(A),await x()},A=>{z=A.lengthComputable,T=A.loaded,q=A.total,m()},A=>{this.manager.itemError(l),typeof o=="function"&&o(A)}),f}}class on extends pt{load(r,n,l,s){const c=this.prepareQuadRenderer(),o=new dr(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(r),o.load(r,async f=>{if(typeof f=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(f);let v,R,x;try{const F=await nn(g);v=F.sdr,R=F.gainMap,x=F.metadata}catch(F){if(F instanceof gt||F instanceof ft)console.warn(`Failure to reconstruct an HDR image from ${r}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),x={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},v=g;else throw F}try{await this.render(c,x,v,R)}catch(F){this.manager.itemError(r),typeof s=="function"&&s(F),c.disposeOnDemandRenderer();return}typeof n=="function"&&n(c),this.manager.itemEnd(r),c.disposeOnDemandRenderer()},l,f=>{this.manager.itemError(r),typeof s=="function"&&s(f)}),c}}const ir={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},vt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Xe=a=>Array.isArray(a),Fr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function pr({files:a=Fr,path:r="",preset:n=void 0,colorSpace:l=void 0,extensions:s}={}){n&&(Nr(n),a=ir[n],r=vt);const c=Xe(a),{extension:o,isCubemap:f}=Or(a),g=Ur(o);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+a);const v=Ce(D=>D.gl);p.useLayoutEffect(()=>{if(o!=="webp"&&o!=="jpg"&&o!=="jpeg")return;function D(){gr.clear(g,c?[a]:a)}v.domElement.addEventListener("webglcontextlost",D,{once:!0})},[a,v.domElement]);const R=gr(g,c?[a]:a,D=>{(o==="webp"||o==="jpg"||o==="jpeg")&&D.setRenderer(v),D.setPath==null||D.setPath(r),s&&s(D)});let x=c?R[0]:R;if(o==="jpg"||o==="jpeg"||o==="webp"){var F;x=(F=x.renderTarget)==null?void 0:F.texture}return x.mapping=f?_a:xa,x.colorSpace=l??(f?"srgb":"srgb-linear"),x}const ln={files:Fr,path:"",preset:void 0,extensions:void 0};pr.preload=a=>{const r={...ln,...a};let{files:n,path:l=""}=r;const{preset:s,extensions:c}=r;s&&(Nr(s),n=ir[s],l=vt);const{extension:o}=Or(n);if(o==="webp"||o==="jpg"||o==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const f=Ur(o);if(!f)throw new Error("useEnvironment: Unrecognized file extension: "+n);gr.preload(f,Xe(n)?[n]:n,g=>{g.setPath==null||g.setPath(l),c&&c(g)})};const cn={files:Fr,preset:void 0};pr.clear=a=>{const r={...cn,...a};let{files:n}=r;const{preset:l}=r;l&&(Nr(l),n=ir[l]);const{extension:s}=Or(n),c=Ur(s);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);gr.clear(c,Xe(n)?[n]:n)};function Nr(a){if(!(a in ir))throw new Error("Preset must be one of: "+Object.keys(ir).join(", "))}function Or(a){var r;const n=Xe(a)&&a.length===6,l=Xe(a)&&a.length===3&&a.some(o=>o.endsWith("json")),s=Xe(a)?a[0]:a;return{extension:n?"cube":l?"webp":s.startsWith("data:application/exr")?"exr":s.startsWith("data:application/hdr")?"hdr":s.startsWith("data:image/jpeg")?"jpg":(r=s.split(".").pop())==null||(r=r.split("?"))==null||(r=r.shift())==null?void 0:r.toLowerCase(),isCubemap:n,isGainmap:l}}function Ur(a){return a==="cube"?Ea:a==="hdr"?Ya:a==="exr"?Va:a==="jpg"||a==="jpeg"?on:a==="webp"?sn:null}const un=a=>a.current&&a.current.isScene,dn=a=>un(a)?a.current:a;function Lr(a,r,n,l,s={}){var c,o,f,g;s={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...s};const v=dn(r||n),R=v.background,x=v.environment,F={backgroundBlurriness:v.backgroundBlurriness,backgroundIntensity:v.backgroundIntensity,backgroundRotation:(c=(o=v.backgroundRotation)==null||o.clone==null?void 0:o.clone())!==null&&c!==void 0?c:[0,0,0],environmentIntensity:v.environmentIntensity,environmentRotation:(f=(g=v.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&f!==void 0?f:[0,0,0]};return a!=="only"&&(v.environment=l),a&&(v.background=l),Xr(v,s),()=>{a!=="only"&&(v.environment=x),a&&(v.background=R),Xr(v,F)}}function kr({scene:a,background:r=!1,map:n,...l}){const s=Ce(c=>c.scene);return p.useLayoutEffect(()=>{if(n)return Lr(r,a,s,n,l)}),null}function mt({background:a=!1,scene:r,blur:n,backgroundBlurriness:l,backgroundIntensity:s,backgroundRotation:c,environmentIntensity:o,environmentRotation:f,...g}){const v=pr(g),R=Ce(x=>x.scene);return p.useLayoutEffect(()=>Lr(a,r,R,v,{backgroundBlurriness:n??l,backgroundIntensity:s,backgroundRotation:c,environmentIntensity:o,environmentRotation:f})),p.useEffect(()=>()=>{v.dispose()},[v]),null}function hn({children:a,near:r=.1,far:n=1e3,resolution:l=256,frames:s=1,map:c,background:o=!1,blur:f,backgroundBlurriness:g,backgroundIntensity:v,backgroundRotation:R,environmentIntensity:x,environmentRotation:F,scene:D,files:O,path:Z,preset:k=void 0,extensions:X}){const z=Ce(E=>E.gl),q=Ce(E=>E.scene),T=p.useRef(null),[m]=p.useState(()=>new Qr),b=p.useMemo(()=>{const E=new tt(l);return E.texture.type=Se,E},[l]);p.useEffect(()=>()=>{b.dispose()},[b]),p.useLayoutEffect(()=>{if(s===1){const E=z.autoClear;z.autoClear=!0,T.current.update(z,m),z.autoClear=E}return Lr(o,D,q,b.texture,{backgroundBlurriness:f??g,backgroundIntensity:v,backgroundRotation:R,environmentIntensity:x,environmentRotation:F})},[a,m,b.texture,D,q,o,s,z]);let P=1;return Ir(()=>{if(s===1/0||P<s){const E=z.autoClear;z.autoClear=!0,T.current.update(z,m),z.autoClear=E,P++}}),p.createElement(p.Fragment,null,Ma(p.createElement(p.Fragment,null,a,p.createElement("cubeCamera",{ref:T,args:[r,n,b]}),O||k?p.createElement(mt,{background:!0,files:O,preset:k,path:Z,extensions:X}):c?p.createElement(kr,{background:!0,map:c,extensions:X}):null),m))}function fn(a){var r,n,l,s;const c=pr(a),o=a.map||c;p.useMemo(()=>Rr({GroundProjectedEnvImpl:Xa}),[]),p.useEffect(()=>()=>{c.dispose()},[c]);const f=p.useMemo(()=>[o],[o]),g=(r=a.ground)==null?void 0:r.height,v=(n=a.ground)==null?void 0:n.radius,R=(l=(s=a.ground)==null?void 0:s.scale)!==null&&l!==void 0?l:1e3;return p.createElement(p.Fragment,null,p.createElement(kr,rt({},a,{map:o})),p.createElement("groundProjectedEnvImpl",{args:f,scale:R,height:g,radius:v}))}function gn(a){return a.ground?p.createElement(fn,a):a.map?p.createElement(kr,a):a.children?p.createElement(hn,a):p.createElement(mt,a)}function pn(a){return a.isLight}function vn(a){return!!a.geometry}const wt=p.createContext(null),mn=nt({color:new at,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${dt>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),wn=p.forwardRef(({children:a,temporal:r,frames:n=40,limit:l=1/0,blend:s=20,scale:c=10,opacity:o=1,alphaTest:f=.75,color:g="black",colorBlend:v=2,resolution:R=1024,toneMapped:x=!0,...F},D)=>{Rr({SoftShadowMaterial:mn});const O=Ce(b=>b.gl),Z=Ce(b=>b.scene),k=Ce(b=>b.camera),X=Ce(b=>b.invalidate),z=p.useRef(null),q=p.useRef(null),[T]=p.useState(()=>new yn(O,Z,R));p.useLayoutEffect(()=>{T.configure(z.current)},[]);const m=p.useMemo(()=>({lights:new Map,temporal:!!r,frames:Math.max(2,n),blend:Math.max(2,n===1/0?s:n),count:0,getMesh:()=>z.current,reset:()=>{T.clear();const b=z.current.material;b.opacity=0,b.alphaTest=0,m.count=0},update:(b=1)=>{const P=z.current.material;m.temporal?(P.opacity=Math.min(o,P.opacity+o/m.blend),P.alphaTest=Math.min(f,P.alphaTest+f/m.blend)):(P.opacity=o,P.alphaTest=f),q.current.visible=!0,T.prepare();for(let E=0;E<b;E++)m.lights.forEach(A=>A.update()),T.update(k,m.blend);q.current.visible=!1,T.finish()}}),[T,k,Z,r,n,s,o,f]);return p.useLayoutEffect(()=>{m.reset(),!m.temporal&&m.frames!==1/0&&m.update(m.blend)}),p.useImperativeHandle(D,()=>m,[m]),Ir(()=>{(m.temporal||m.frames===1/0)&&m.count<m.frames&&m.count<l&&(X(),m.update(),m.count++)}),p.createElement("group",F,p.createElement("group",{traverse:()=>null,ref:q},p.createElement(wt.Provider,{value:m},a)),p.createElement("mesh",{receiveShadow:!0,ref:z,scale:c,rotation:[-Math.PI/2,0,0]},p.createElement("planeGeometry",null),p.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:x,color:g,blend:v,map:T.progressiveLightMap2.texture})))}),qr=p.forwardRef(({castShadow:a=!0,bias:r=.001,mapSize:n=512,size:l=5,near:s=.5,far:c=500,frames:o=1,position:f=[0,0,0],radius:g=1,amount:v=8,intensity:R=dt>=155?Math.PI:1,ambient:x=.5,...F},D)=>{const O=p.useRef(null),Z=new Ze(...f).length(),k=p.useContext(wt),X=p.useCallback(()=>{let q;if(O.current)for(let T=0;T<O.current.children.length;T++)if(q=O.current.children[T],Math.random()>x)q.position.set(f[0]+wr.randFloatSpread(g),f[1]+wr.randFloatSpread(g),f[2]+wr.randFloatSpread(g));else{let m=Math.acos(2*Math.random()-1)-Math.PI/2,b=2*Math.PI*Math.random();q.position.set(Math.cos(m)*Math.cos(b)*Z,Math.abs(Math.cos(m)*Math.sin(b)*Z),Math.sin(m)*Z)}},[g,x,Z,...f]),z=p.useMemo(()=>({update:X}),[X]);return p.useImperativeHandle(D,()=>z,[z]),p.useLayoutEffect(()=>{var q;const T=O.current;return k&&((q=k.lights)==null||q.set(T.uuid,z)),()=>{var m;return void(k==null||(m=k.lights)==null?void 0:m.delete(T.uuid))}},[k,z]),p.createElement("group",rt({ref:O},F),Array.from({length:v},(q,T)=>p.createElement("directionalLight",{key:T,castShadow:a,"shadow-bias":r,"shadow-mapSize":[n,n],intensity:R/v},p.createElement("orthographicCamera",{attach:"shadow-camera",args:[-l,l,l,-l,s,c]}))))});class yn{constructor(r,n,l=1024){this.renderer=r,this.res=l,this.scene=n,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new at,this.clearAlpha=0;const s={type:Se,magFilter:Yr,minFilter:Yr};this.progressiveLightMap1=new hr(this.res,this.res,s),this.progressiveLightMap2=new hr(this.res,this.res,s),this.discardMat=new Ka,this.targetMat=new Sa({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=c=>{c.vertexShader=`varying vec2 vUv;
`+c.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const o=c.fragmentShader.indexOf("void main() {");c.fragmentShader=`varying vec2 vUv;
`+c.fragmentShader.slice(0,o)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+c.fragmentShader.slice(o-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,c.uniforms.previousShadowMap=this.previousShadowMap,c.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(r=>{vn(r)?this.meshes.push({object:r,material:r.material}):pn(r)&&this.lights.push({object:r,intensity:r.intensity})})}prepare(){this.lights.forEach(r=>r.object.intensity=0),this.meshes.forEach(r=>r.object.material=this.discardMat)}finish(){this.lights.forEach(r=>r.object.intensity=r.intensity),this.meshes.forEach(r=>r.object.material=r.material)}configure(r){this.object=r}update(r,n=100){if(!this.object)return;this.averagingWindow.value=n,this.object.material=this.targetMat;const l=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,s=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,c=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(l),this.previousShadowMap.value=s.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,r),this.renderer.setRenderTarget(null),this.scene.background=c}}function bn({all:a,scene:r,camera:n}){const l=Ce(({gl:o})=>o),s=Ce(({camera:o})=>o),c=Ce(({scene:o})=>o);return p.useLayoutEffect(()=>{const o=[];a&&(r||c).traverse(v=>{v.visible===!1&&(o.push(v),v.visible=!0)}),l.compile(r||c,n||s);const f=new tt(128);new Ca(.01,1e5,f).update(l,r||c),f.dispose(),o.forEach(v=>v.visible=!1)},[]),null}function yt(a){const r=p.useRef(),{nodes:n,materials:l,animations:s}=Ye("/models/bird_orange.glb"),{actions:c}=Tr(s,r);return p.useEffect(()=>{if(a.playAnimation&&c&&Object.keys(c).length>0){const o=Object.keys(c)[0],f=c[o];if(f)return f.reset().fadeIn(.5).play(),()=>f.fadeOut(.5)}},[a.playAnimation,c]),y.jsx("group",{ref:r,...a,dispose:null,children:y.jsx("group",{name:"Sketchfab_Scene",children:y.jsx("group",{name:"Sketchfab_model",rotation:[-Math.PI/2,0,0],scale:46.683,children:y.jsx("group",{name:"bfb1ea86655f4c4ab4c6cbbb449cedf4fbx",rotation:[Math.PI/2,0,0],scale:.01,children:y.jsx("group",{name:"Object_2",children:y.jsx("group",{name:"RootNode",children:y.jsxs("group",{name:"BirdOrange_all",children:[y.jsx("group",{name:"Main",position:[-.083,0,.451],rotation:[0,-.074,0],children:y.jsxs("group",{name:"Object_6",children:[y.jsx("primitive",{object:n._rootJoint}),y.jsx("skinnedMesh",{name:"Object_51",geometry:n.Object_51.geometry,material:l.BirdOrange_LMB,skeleton:n.Object_51.skeleton}),y.jsx("group",{name:"Object_50"})]})}),y.jsx("group",{name:"Geometry",children:y.jsx("group",{name:"BirdOrange"})})]})})})})})})})}yt.propTypes={playAnimation:Q.bool,scale:Q.oneOfType([Q.number,Q.arrayOf(Q.number)]),position:Q.arrayOf(Q.number)};Ye.preload("/models/bird_orange.glb");Ye.preload("/models/cat.glb");Ye.preload("/models/sign.glb");const bt=({activeAudioSource:a,audioRefs:r})=>{const n=p.useRef(null),l=p.useRef(null),s=p.useRef(null);return p.useEffect(()=>{if(!a||!n.current||!r){console.log("Skipping visualization:",{activeAudioSource:a,hasCanvas:!!n.current,hasAudioRefs:!!r});return}let c;const o=a.toLowerCase();if(r[o])c=r[o],console.log(`Found audio element for ${o}:`,!!c);else{console.warn(`No audio element found for source: ${o}`);return}if(!(c!=null&&c.analyzer)){console.warn("Audio element does not have an analyzer node:",a);return}console.log(`Analyzer node found for ${a}:`,!!c.analyzer),s.current=c.analyzer;const f=n.current,g=f.getContext("2d"),v=()=>{f.width=f.clientWidth,f.height=f.clientHeight};v(),window.addEventListener("resize",v);const R=()=>{if(!s.current)return;const x=s.current.frequencyBinCount,F=new Uint8Array(x);try{s.current.getByteFrequencyData(F)}catch(k){console.error("Error getting frequency data:",k);return}g.clearRect(0,0,f.width,f.height);const D=f.width/x*2.5;let O=0,Z;switch(a.toLowerCase()){case"birds":Z="rgba(255, 212, 59, 0.8)";break;case"cat":Z="rgba(255, 107, 107, 0.8)";break;case"sign":Z="rgba(77, 171, 247, 0.8)";break;default:Z="rgba(255, 255, 255, 0.8)"}for(let k=0;k<x;k++){const X=F[k]/255*f.height,z=g.createLinearGradient(0,f.height,0,0);z.addColorStop(0,"rgba(0, 0, 0, 0.2)"),z.addColorStop(1,Z),g.fillStyle=z,g.fillRect(O,f.height-X,D,X),O+=D+1}l.current=requestAnimationFrame(R)};return R(),()=>{window.removeEventListener("resize",v),l.current&&(cancelAnimationFrame(l.current),l.current=null)}},[a,r]),y.jsxs("div",{className:`absolute bottom-4 left-4 right-4 h-16 sm:h-20 md:h-24 bg-black bg-opacity-30 backdrop-blur-sm rounded-xl overflow-hidden transition-all duration-500 shadow-lg ${a?"opacity-100 transform translate-y-0":"opacity-0 transform translate-y-8"}`,children:[y.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:y.jsx("div",{className:`text-xs sm:text-sm font-medium text-white opacity-50 ${a?"":"hidden"}`,children:a?`Visualizing ${a}`:""})}),y.jsx("canvas",{ref:n,className:"w-full h-full"})]})};bt.propTypes={activeAudioSource:Q.string,audioRefs:Q.object};Rr(Fa);const _t=p.memo(Aa.forwardRef((a,r)=>{const{onPositionChange:n,onBirdHover:l,onCatHover:s,onSignHover:c}=a,o=p.useRef(null),f=p.useRef(null),g=p.useRef(null),v=p.useRef(null),R=p.useRef(null),x=p.useRef({sign:null,birds:null,cat:null,traffic:null});p.useEffect(()=>{r&&(r.current=x)},[r]);const F=p.useRef(!1),D=p.useRef(!1),O=p.useRef(!1);p.useRef(!1);const Z=p.useRef(!1),k=p.useCallback(()=>{if(!R.current||R.current.state==="closed"){const T=window.AudioContext||window.webkitAudioContext;R.current=new T}else R.current.state==="suspended"&&R.current.resume();return R.current},[]),X=p.useCallback(()=>{const T=R.current;T&&(T.state==="suspended"&&T.resume(),!Z.current&&x.current&&(console.log("Starting audio playback..."),Object.entries(x.current).forEach(([m,b])=>{if(b!=null&&b.source&&b.source.buffer)try{b.gainNode.gain.value=.5,b.source.start(0),console.log(`Started ${m} audio source`)}catch(P){P.message.includes("start")||console.error(`Error starting ${m} audio:`,P)}else console.warn(`Audio source or buffer not ready for ${m}`)}),Z.current=!0))},[]);p.useEffect(()=>()=>{var T,m;Z.current&&Object.values(x.current).forEach(b=>{if(b!=null&&b.source)try{b.source.stop(),b.source.disconnect()}catch(P){P.message.includes("stop")||console.error("Error stopping audio:",P)}b!=null&&b.analyzer&&b.analyzer.disconnect(),b!=null&&b.panner&&b.panner.disconnect(),b!=null&&b.gainNode&&b.gainNode.disconnect()}),((T=R.current)==null?void 0:T.state)!=="closed"&&((m=R.current)==null||m.close())},[]);const z=p.useCallback(()=>{const T=R.current;if(!T)return console.warn("No audio context available for analyzer creation"),null;const m=T.createAnalyser();return m.fftSize=2048,m.smoothingTimeConstant=.8,m.minDecibels=-90,m.maxDecibels=-10,m},[]);p.useEffect(()=>{R.current&&x.current&&Object.entries(x.current).forEach(([T,m])=>{if(m!=null&&m.gainNode&&!m.analyzer){const b=z();b&&(m.gainNode.connect(b),m.analyzer=b,console.log(`Created analyzer for ${T} audio source`))}})},[z]),p.useEffect(()=>{(async()=>{try{const m=k(),b=async j=>{console.log(`Loading audio from ${j}`);const W=await fetch(j);if(!W.ok)throw new Error(`Failed to fetch audio file ${j}: ${W.status} ${W.statusText}`);const $=await W.arrayBuffer(),J=await m.decodeAudioData($),B=m.createBufferSource(),Y=m.createPanner(),H=m.createGain();B.buffer=J,B.loop=!0,Y.panningModel="HRTF",Y.distanceModel="inverse",Y.refDistance=1,Y.maxDistance=1e4,Y.rolloffFactor=1,Y.coneInnerAngle=360,Y.coneOuterAngle=0,Y.coneOuterGain=0,H.gain.value=.5,B.connect(Y),Y.connect(H);const he=z();return he?(H.connect(he),he.connect(m.destination)):H.connect(m.destination),{source:B,panner:Y,gainNode:H,analyzer:he,isStarted:!1}},P={sign:"/audio/sign.mp3",birds:"/audio/birds.mp3",cat:"/audio/cat.mp3",traffic:"/audio/traffic.mp3"},E=await Promise.all(Object.entries(P).map(async([j,W])=>{try{const $=await b(W);return console.log(`Successfully loaded audio for ${j}`),[j,$]}catch($){return console.error(`Failed to load audio for ${j}:`,$),[j,null]}}));x.current=Object.fromEntries(E.filter(([j,W])=>W!==null));const A=()=>{console.log("First user interaction detected"),X(),document.removeEventListener("click",A),document.removeEventListener("touchstart",A)};document.addEventListener("click",A),document.addEventListener("touchstart",A)}catch(m){console.error("Failed to initialize audio:",m)}})()},[k,X,z]);const q=p.useCallback(T=>{var re;if(!o.current)return;const m=o.current.getBoundingClientRect(),b=(T.clientX-m.left)/m.width,P=(T.clientY-m.top)/m.height,E={x:.5,y:.5},A={x:.7,y:.3},j={x:.3,y:.3},W=Math.sqrt(.5),$=Math.hypot(b-E.x,P-E.y),J=Math.hypot(b-A.x,P-A.y),B=Math.hypot(b-j.x,P-j.y),Y=Math.max(0,1-$/W),H=Math.max(0,1-J/W),he=Math.max(0,1-B/W),_e=.1,ye=1.5;if(x.current.sign){const ve=O.current?Y*ye:Y,ie=F.current?H*ye:H,fe=D.current?he*ye:he;x.current.sign.gainNode.gain.value=x.current.sign.gainNode.gain.value*(1-_e)+ve*_e,x.current.birds.gainNode.gain.value=x.current.birds.gainNode.gain.value*(1-_e)+ie*_e,x.current.cat.gainNode.gain.value=x.current.cat.gainNode.gain.value*(1-_e)+fe*_e,x.current.sign.panner.setPosition((b-.5)*2,(P-.5)*2,-.5),x.current.birds.panner.setPosition((b-A.x)*2,(P-A.y)*2,-.5),x.current.cat.panner.setPosition((b-j.x)*2,(P-j.y)*2,-.5),Z.current?((re=R.current)==null?void 0:re.state)==="suspended"&&R.current.resume().catch(Ee=>{console.error("Error resuming audio context:",Ee),Ee.message.includes("closed")&&(k(),X())}):((!R.current||R.current.state==="closed")&&k(),X())}Object.values(x.current).forEach(ve=>{ve!=null&&ve.gainNode&&ve.gainNode.gain.value>1&&(ve.gainNode.gain.value=1)}),n==null||n({x:b*2-1,y:-(P*2-1)})},[n,X,k]);return y.jsx("div",{className:"relative h-full w-full p-2 sm:p-4 md:p-6 lg:p-8",children:y.jsx("div",{className:"w-full h-full construction-border",children:y.jsxs("div",{ref:o,className:"w-full h-full bg-gray-900 rounded-lg relative cursor-crosshair overflow-hidden shadow-inner",onMouseMove:q,onTouchMove:T=>{if(T.touches&&T.touches[0]){const m=T.touches[0],b={clientX:m.clientX,clientY:m.clientY};q(b)}},children:[y.jsx("div",{className:"absolute w-full h-px bg-gray-700 opacity-70 top-1/2 transform -translate-y-1/2"}),y.jsx("div",{className:"absolute h-full w-px bg-gray-700 opacity-70 left-1/2 transform -translate-x-1/2"}),y.jsx("img",{ref:v,src:"/icons/buzz.svg",alt:"Sign",className:"absolute top-1/2 left-1/2 w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 transform -translate-x-1/2 -translate-y-1/2 filter drop-shadow-[0_0_8px_rgba(77,171,247,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(77,171,247,0.8)] active:scale-110 z-10",title:"Sign",onMouseEnter:()=>{var T;O.current=!0,c(!0),(T=v.current)==null||T.classList.add("animate-pulse")},onMouseLeave:()=>{var T;O.current=!1,c(!1),(T=v.current)==null||T.classList.remove("animate-pulse")}}),y.jsx("img",{ref:f,src:"/icons/bird.svg",alt:"Birds",className:"absolute top-[30%] left-[70%] w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 filter drop-shadow-[0_0_8px_rgba(255,212,59,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(255,212,59,0.8)] active:scale-110 z-10",title:"Birds",onMouseEnter:()=>{var T;F.current=!0,l(!0),(T=f.current)==null||T.classList.add("animate-pulse")},onMouseLeave:()=>{var T;F.current=!1,l(!1),(T=f.current)==null||T.classList.remove("animate-pulse")}}),y.jsx("img",{ref:g,src:"/icons/cat.svg",alt:"Cat",className:"absolute top-[30%] left-[30%] w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 lg:w-12 lg:h-12 filter drop-shadow-[0_0_8px_rgba(255,107,107,0.5)] transition-all duration-300 hover:scale-125 hover:drop-shadow-[0_0_15px_rgba(255,107,107,0.8)] active:scale-110 z-10",title:"Cat",onMouseEnter:()=>{var T;D.current=!0,s(!0),(T=g.current)==null||T.classList.add("animate-pulse")},onMouseLeave:()=>{var T;D.current=!1,s(!1),(T=g.current)==null||T.classList.remove("animate-pulse")}}),y.jsx("div",{className:`absolute top-1/2 left-1/2 w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-blue-500 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${O.current?"opacity-20":""}`}),y.jsx("div",{className:`absolute top-[30%] left-[70%] w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-yellow-300 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${F.current?"opacity-20":""}`}),y.jsx("div",{className:`absolute top-[30%] left-[30%] w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full bg-red-400 opacity-10 transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${D.current?"opacity-20":""}`})]})})})}));_t.propTypes={onPositionChange:Q.func,onBirdHover:Q.func,onCatHover:Q.func,onSignHover:Q.func,ref:Q.shape({current:Q.object})};const xt=p.memo(({isBirdHovered:a,isCatHovered:r,isSignHovered:n})=>{const{camera:l,gl:s}=Ce();return p.useEffect(()=>{l&&(l.position.set(10,2,10),l.fov=60,l.updateProjectionMatrix()),s&&(s.shadowMap.enabled=!0,s.shadowMap.type=Ra)},[l,s]),y.jsxs(y.Fragment,{children:[y.jsx("color",{attach:"background",args:["#9fbcea"]}),y.jsx("fog",{attach:"fog",args:["#9fbcea",10,50]}),y.jsxs(p.Suspense,{fallback:null,children:[y.jsx(gn,{files:"/assets/env/background.jpg",background:!0,blur:0}),y.jsx("hemisphereLight",{intensity:.3,groundColor:"#ffd9b3"}),y.jsx("directionalLight",{castShadow:!0,position:[4,1,10],intensity:7,children:y.jsx("orthographicCamera",{attach:"shadow-camera",args:[-10,10,10,-10,.1,100]})}),y.jsx("spotLight",{castShadow:!0,position:[-5,8,-5],penumbra:1,intensity:400,color:"#b3d9ff","shadow-camera-far":50}),y.jsx(Ct,{isBirdHovered:a,isCatHovered:r,isSignHovered:n}),y.jsxs(wn,{position:[0,-.99,0],scale:100,frames:100,temporal:!0,opacity:.8,color:"#2a2a2a",blend:.7,children:[y.jsx(qr,{amount:8,radius:6,intensity:1.2,position:[3,5,3],bias:.001}),y.jsx(qr,{amount:4,radius:4,intensity:.8,position:[-5,7,-5],color:"#b3d9ff",bias:.001})]}),y.jsx(bn,{all:!0})]}),y.jsx(Ta,{enableZoom:!0,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/4,enableDamping:!0,dampingFactor:.05})]})});xt.propTypes={isBirdHovered:Q.bool,isCatHovered:Q.bool,isSignHovered:Q.bool};const vr=p.memo(({position:a,rotation:r,scale:n,children:l})=>{const s=p.useRef();return p.useEffect(()=>{s.current&&(a&&s.current.position.set(...a),r&&s.current.rotation.set(...r),n&&(Array.isArray(n)?s.current.scale.set(...n):s.current.scale.set(n,n,n)))},[a,r,n]),y.jsx("group",{ref:s,children:l})});vr.propTypes={children:Q.node,position:Q.arrayOf(Q.number),rotation:Q.arrayOf(Q.number),scale:Q.oneOfType([Q.number,Q.arrayOf(Q.number)])};const Et=p.memo(({isBirdHovered:a})=>y.jsx(vr,{position:[5.8,-.4,7.2],rotation:[0,Math.PI/6,0],children:y.jsx(yt,{scale:.32,playAnimation:a})}));Et.propTypes={isBirdHovered:Q.bool};const Mt=p.memo(({isCatHovered:a})=>{const{scene:r,animations:n}=Ye("/models/cat.glb"),l=p.useRef(),{actions:s}=Tr(n,l);return p.useEffect(()=>{const c=s;return c&&Object.values(c).forEach(o=>{o&&typeof o.reset=="function"&&(a?o.reset().fadeIn(.2).play():o.fadeOut(.2))}),()=>{c&&Object.values(c).forEach(o=>{if(o&&typeof o.stop=="function")try{o.stop()}catch(f){console.warn("Error stopping cat animation:",f)}})}},[a,s]),y.jsx(vr,{position:[2.8,-.9,3.2],rotation:[0,-Math.PI/2,0],scale:.08,children:y.jsx("group",{ref:l,children:y.jsx("primitive",{object:r})})})});Mt.propTypes={isCatHovered:Q.bool};const St=p.memo(({isSignHovered:a})=>{const{scene:r,animations:n}=Ye("/models/sign.glb"),l=p.useRef(),{actions:s}=Tr(n,l);return p.useEffect(()=>{const c=s;return c&&Object.values(c).forEach(o=>{o&&typeof o.reset=="function"&&(a?o.reset().fadeIn(.2).play():o.fadeOut(.2))}),()=>{c&&Object.values(c).forEach(o=>{if(o&&typeof o.stop=="function")try{o.stop()}catch(f){console.warn("Error stopping sign animation:",f)}})}},[a,s]),y.jsx(vr,{position:[2.9,2.8,0],rotation:[0,Math.PI/3,0],scale:.8,children:y.jsx("group",{ref:l,children:y.jsx("primitive",{object:r})})})});St.propTypes={isSignHovered:Q.bool};const Ct=p.memo(({isBirdHovered:a,isCatHovered:r,isSignHovered:n})=>y.jsxs("group",{children:[y.jsx(Et,{isBirdHovered:a}),y.jsx(Mt,{isCatHovered:r}),y.jsx(St,{isSignHovered:n})]}));Ct.propTypes={isBirdHovered:Q.bool,isCatHovered:Q.bool,isSignHovered:Q.bool};const _n=()=>y.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900",children:y.jsxs("div",{className:"flex flex-col items-center",children:[y.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),y.jsx("h2",{className:"text-xl text-white font-light",children:"Loading Neuro Experience"}),y.jsx("p",{className:"text-gray-400 mt-2",children:"Please wait while we tune your neural interface..."})]})}),xn=()=>{var D;const[a,r]=p.useState({x:0,y:0}),[n,l]=p.useState(!1),[s,c]=p.useState(!1),[o,f]=p.useState(!1),[g,v]=p.useState(!0),[R,x]=p.useState(null),F=p.useCallback((O,Z)=>{Z?x(O):R===O&&x(null)},[R]);return p.useEffect(()=>{const O=setTimeout(()=>{v(!1)},2e3);return()=>clearTimeout(O)},[]),g?y.jsx(_n,{}):y.jsxs("div",{className:"h-full grid grid-rows-[1fr,auto]",children:[y.jsxs("div",{className:"relative w-full h-full",children:[y.jsx(Ia,{shadows:!0,dpr:[1,2],camera:{position:[10,2,10],fov:60},children:y.jsx(xt,{isBirdHovered:n,isCatHovered:s,isSignHovered:o})}),R&&y.jsxs("div",{className:"absolute top-12 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-full text-sm font-medium flex items-center space-x-2 animate-[fadeIn_0.5s_ease-in-out]",children:[y.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full animate-[pulse_1.5s_infinite_ease-in-out]"}),y.jsxs("span",{children:["Focusing on: ",R]})]}),"        ",y.jsx(bt,{activeAudioSource:R,audioRefs:(D=window.audioRefs)==null?void 0:D.current})]}),"      ",y.jsx("div",{className:"h-[25vh] min-h-[200px] max-h-[250px] bg-gradient-to-b from-gray-900 to-gray-800 backdrop-blur-md",children:y.jsx(_t,{ref:O=>{O&&(window.audioRefs=O)},onPositionChange:r,onBirdHover:O=>{l(O),F("birds",O)},onCatHover:O=>{c(O),F("cat",O)},onSignHover:O=>{f(O),F("sign",O)}})})]})},En=({title:a,sub:r})=>y.jsxs("div",{className:"flex flex-col items-center gap-5",children:[y.jsx("div",{className:"hero-badge",children:y.jsx("p",{children:r})}),y.jsx("div",{children:y.jsx("h1",{className:"font-semibold md:text-5xl text-3xl text-center",children:a})})]}),It=({children:a})=>{const[r,n]=p.useState(!1),[l,s]=p.useState("");p.useEffect(()=>{const o=f=>{var g;console.error("Application Error:",f),!((g=f.message)!=null&&g.includes("AudioContext"))&&(s(f.message||"An unexpected error occurred"),n(!0))};return window.addEventListener("error",o),()=>window.removeEventListener("error",o)},[]);const c=p.useCallback(()=>{if(n(!1),s(""),window.audioContext){try{window.audioContext.close()}catch(o){console.error("Error closing audio context:",o)}delete window.audioContext}},[]);return r?y.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-900",children:y.jsxs("div",{className:"text-center text-white",children:[y.jsx("h2",{className:"text-xl mb-4",children:"Something went wrong"}),y.jsx("p",{className:"text-gray-400 mb-4",children:l}),y.jsx("button",{className:"px-4 py-2 bg-blue-500 rounded hover:bg-blue-600",onClick:c,children:"Try again"})]})}):a};It.propTypes={children:Q.node.isRequired};const Cn=()=>(p.useEffect(()=>(window.scrollTo(0,0),()=>{if(window.audioContext){try{window.audioContext.close()}catch(a){console.error("Error closing audio context:",a)}delete window.audioContext}}),[]),y.jsx(It,{children:y.jsxs("section",{className:"h-screen overflow-hidden bg-gradient-to-b from-gray-900 to-gray-800",children:[y.jsx("div",{className:"absolute top-12 left-4 z-10",children:y.jsxs(Na,{to:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900/50 backdrop-blur-sm rounded-lg text-white hover:bg-gray-800 transition-all",children:[y.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",children:y.jsx("path",{d:"M15 10H5M5 10L10 15M5 10L10 5"})}),"Home"]})}),y.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 text-center z-10",children:y.jsx(En,{})}),y.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-center text-sm text-gray-400 z-10",children:"Move cursor to focus on sound of interest"}),y.jsx("div",{className:"h-full",role:"main","aria-label":"3D Audio Experience",children:y.jsx(xn,{})})]})}));export{Cn as default};
