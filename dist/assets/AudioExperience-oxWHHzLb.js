import{r as y,F as Qe,G as tn,H as zr,_ as dt,I as ht,V as He,J as nn,K as mt,O as Zr,N as Wr,Q as an,S as $r,T as gt,U as pt,W as Te,X as ze,Y as rr,Z as Ue,$ as gr,a0 as on,a1 as it,a2 as sn,a3 as Ye,a4 as ft,a5 as vt,a6 as _t,a7 as Rr,a8 as ln,a9 as cn,aa as Gr,ab as tr,ac as un,ad as dn,ae as hn,af as mn,ag as gn,ah as Lr,ai as Cr,aj as pn,ak as fn,al as ot,am as vn,an as _n,ao as Or,ap as yn,aq as xn,ar as wn,as as En,at as bn,au as Sn,av as st,j as o,aw as We,P as Ze,R as Mn,ax as In,ay as Cn,az as Rn,aA as On,aB as An,L as Tn}from"./index-Do21gDj1.js";const fr=new He,Xr=new He,jn=new He,lt=new nn;function Fn(a,r,n){const s=fr.setFromMatrixPosition(a.matrixWorld);s.project(r);const c=n.width/2,u=n.height/2;return[s.x*c+c,-(s.y*u)+u]}function kn(a,r){const n=fr.setFromMatrixPosition(a.matrixWorld),s=Xr.setFromMatrixPosition(r.matrixWorld),c=n.sub(s),u=r.getWorldDirection(jn);return c.angleTo(u)>Math.PI/2}function Pn(a,r,n,s){const c=fr.setFromMatrixPosition(a.matrixWorld),u=c.clone();u.project(r),lt.set(u.x,u.y),n.setFromCamera(lt,r);const l=n.intersectObjects(s,!0);if(l.length){const p=l[0].distance;return c.distanceTo(n.ray.origin)<p}return!0}function Nn(a,r){if(r instanceof Zr)return r.zoom;if(r instanceof mt){const n=fr.setFromMatrixPosition(a.matrixWorld),s=Xr.setFromMatrixPosition(r.matrixWorld),c=r.fov*Math.PI/180,u=n.distanceTo(s);return 1/(2*Math.tan(c/2)*u)}else return 1}function Un(a,r,n){if(r instanceof mt||r instanceof Zr){const s=fr.setFromMatrixPosition(a.matrixWorld),c=Xr.setFromMatrixPosition(r.matrixWorld),u=s.distanceTo(c),l=(n[1]-n[0])/(r.far-r.near),p=n[1]-l*r.far;return Math.round(l*u+p)}}const Dr=a=>Math.abs(a)<1e-10?0:a;function yt(a,r,n=""){let s="matrix3d(";for(let c=0;c!==16;c++)s+=Dr(r[c]*a.elements[c])+(c!==15?",":")");return n+s}const Gn=(a=>r=>yt(r,a))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Ln=(a=>(r,n)=>yt(r,a(n),"translate(-50%,-50%)"))(a=>[1/a,1/a,1/a,1,-1/a,-1/a,-1/a,-1,1/a,1/a,1/a,1,1,1,1,1]);function Dn(a){return a&&typeof a=="object"&&"current"in a}const Bn=y.forwardRef(({children:a,eps:r=.001,style:n,className:s,prepend:c,center:u,fullscreen:l,portal:p,distanceFactor:g,sprite:v=!1,transform:x=!1,occlude:C,onOcclude:O,castShadow:L,receiveShadow:B,material:me,geometry:H,zIndexRange:Y=[16777271,0],calculatePosition:Q=Fn,as:le="div",wrapperClass:de,pointerEvents:W="auto",...F},ee)=>{const{gl:I,camera:M,scene:z,size:k,raycaster:Z,events:$,viewport:j}=Qe(),[U]=y.useState(()=>document.createElement(le)),N=y.useRef(null),ce=y.useRef(null),ke=y.useRef(0),fe=y.useRef([0,0]),X=y.useRef(null),Me=y.useRef(null),V=(p==null?void 0:p.current)||$.connected||I.domElement.parentNode,ne=y.useRef(null),xe=y.useRef(!1),Pe=y.useMemo(()=>C&&C!=="blending"||Array.isArray(C)&&C.length&&Dn(C[0]),[C]);y.useLayoutEffect(()=>{const we=I.domElement;C&&C==="blending"?(we.style.zIndex=`${Math.floor(Y[0]/2)}`,we.style.position="absolute",we.style.pointerEvents="none"):(we.style.zIndex=null,we.style.position=null,we.style.pointerEvents=null)},[C]),y.useLayoutEffect(()=>{if(ce.current){const we=N.current=tn.createRoot(U);if(z.updateMatrixWorld(),x)U.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const K=Q(ce.current,M,k);U.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${K[0]}px,${K[1]}px,0);transform-origin:0 0;`}return V&&(c?V.prepend(U):V.appendChild(U)),()=>{V&&V.removeChild(U),we.unmount()}}},[V,x]),y.useLayoutEffect(()=>{de&&(U.className=de)},[de]);const q=y.useMemo(()=>x?{position:"absolute",top:0,left:0,width:k.width,height:k.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...l&&{top:-k.height/2,left:-k.width/2,width:k.width,height:k.height},...n},[n,u,l,k,x]),je=y.useMemo(()=>({position:"absolute",pointerEvents:W}),[W]);y.useLayoutEffect(()=>{if(xe.current=!1,x){var we;(we=N.current)==null||we.render(y.createElement("div",{ref:X,style:q},y.createElement("div",{ref:Me,style:je},y.createElement("div",{ref:ee,className:s,style:n,children:a}))))}else{var K;(K=N.current)==null||K.render(y.createElement("div",{ref:ee,style:q,className:s,children:a}))}});const ve=y.useRef(!0);zr(we=>{if(ce.current){M.updateMatrixWorld(),ce.current.updateWorldMatrix(!0,!1);const K=x?fe.current:Q(ce.current,M,k);if(x||Math.abs(ke.current-M.zoom)>r||Math.abs(fe.current[0]-K[0])>r||Math.abs(fe.current[1]-K[1])>r){const Ge=kn(ce.current,M);let Ie=!1;Pe&&(Array.isArray(C)?Ie=C.map(Le=>Le.current):C!=="blending"&&(Ie=[z]));const $e=ve.current;if(Ie){const Le=Pn(ce.current,M,Z,Ie);ve.current=Le&&!Ge}else ve.current=!Ge;$e!==ve.current&&(O?O(!ve.current):U.style.display=ve.current?"block":"none");const Je=Math.floor(Y[0]/2),Tr=C?Pe?[Y[0],Je]:[Je-1,0]:Y;if(U.style.zIndex=`${Un(ce.current,M,Tr)}`,x){const[Le,yr]=[k.width/2,k.height/2],ar=M.projectionMatrix.elements[5]*yr,{isOrthographicCamera:xr,top:jr,left:Fr,bottom:wr,right:kr}=M,ir=Gn(M.matrixWorldInverse),Pr=xr?`scale(${ar})translate(${Dr(-(kr+Fr)/2)}px,${Dr((jr+wr)/2)}px)`:`translateZ(${ar}px)`;let De=ce.current.matrixWorld;v&&(De=M.matrixWorldInverse.clone().transpose().copyPosition(De).scale(ce.current.scale),De.elements[3]=De.elements[7]=De.elements[11]=0,De.elements[15]=1),U.style.width=k.width+"px",U.style.height=k.height+"px",U.style.perspective=xr?"":`${ar}px`,X.current&&Me.current&&(X.current.style.transform=`${Pr}${ir}translate(${Le}px,${yr}px)`,Me.current.style.transform=Ln(De,1/((g||10)/400)))}else{const Le=g===void 0?1:Nn(ce.current,M)*g;U.style.transform=`translate3d(${K[0]}px,${K[1]}px,0) scale(${Le})`}fe.current=K,ke.current=M.zoom}}if(!Pe&&ne.current&&!xe.current)if(x){if(X.current){const K=X.current.children[0];if(K!=null&&K.clientWidth&&K!=null&&K.clientHeight){const{isOrthographicCamera:Ge}=M;if(Ge||H)F.scale&&(Array.isArray(F.scale)?F.scale instanceof He?ne.current.scale.copy(F.scale.clone().divideScalar(1)):ne.current.scale.set(1/F.scale[0],1/F.scale[1],1/F.scale[2]):ne.current.scale.setScalar(1/F.scale));else{const Ie=(g||10)/400,$e=K.clientWidth*Ie,Je=K.clientHeight*Ie;ne.current.scale.set($e,Je,1)}xe.current=!0}}}else{const K=U.children[0];if(K!=null&&K.clientWidth&&K!=null&&K.clientHeight){const Ge=1/j.factor,Ie=K.clientWidth*Ge,$e=K.clientHeight*Ge;ne.current.scale.set(Ie,$e,1),xe.current=!0}ne.current.lookAt(we.camera.position)}});const _r=y.useMemo(()=>({vertexShader:x?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[x]);return y.createElement("group",dt({},F,{ref:ce}),C&&!Pe&&y.createElement("mesh",{castShadow:L,receiveShadow:B,ref:ne},H||y.createElement("planeGeometry",null),me||y.createElement("shaderMaterial",{side:ht,vertexShader:_r.vertexShader,fragmentShader:_r.fragmentShader})))});var Ae=Uint8Array,qe=Uint16Array,Br=Uint32Array,xt=new Ae([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wt=new Ae([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hn=new Ae([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Et=function(a,r){for(var n=new qe(31),s=0;s<31;++s)n[s]=r+=1<<a[s-1];for(var c=new Br(n[30]),s=1;s<30;++s)for(var u=n[s];u<n[s+1];++u)c[u]=u-n[s]<<5|s;return[n,c]},bt=Et(xt,2),St=bt[0],zn=bt[1];St[28]=258,zn[258]=28;var Zn=Et(wt,0),Wn=Zn[0],Hr=new qe(32768);for(var se=0;se<32768;++se){var Ve=(se&43690)>>>1|(se&21845)<<1;Ve=(Ve&52428)>>>2|(Ve&13107)<<2,Ve=(Ve&61680)>>>4|(Ve&3855)<<4,Hr[se]=((Ve&65280)>>>8|(Ve&255)<<8)>>>1}var mr=function(a,r,n){for(var s=a.length,c=0,u=new qe(r);c<s;++c)++u[a[c]-1];var l=new qe(r);for(c=0;c<r;++c)l[c]=l[c-1]+u[c-1]<<1;var p;if(n){p=new qe(1<<r);var g=15-r;for(c=0;c<s;++c)if(a[c])for(var v=c<<4|a[c],x=r-a[c],C=l[a[c]-1]++<<x,O=C|(1<<x)-1;C<=O;++C)p[Hr[C]>>>g]=v}else for(p=new qe(s),c=0;c<s;++c)a[c]&&(p[c]=Hr[l[a[c]-1]++]>>>15-a[c]);return p},vr=new Ae(288);for(var se=0;se<144;++se)vr[se]=8;for(var se=144;se<256;++se)vr[se]=9;for(var se=256;se<280;++se)vr[se]=7;for(var se=280;se<288;++se)vr[se]=8;var Mt=new Ae(32);for(var se=0;se<32;++se)Mt[se]=5;var $n=mr(vr,9,1),Xn=mr(Mt,5,1),Nr=function(a){for(var r=a[0],n=1;n<a.length;++n)a[n]>r&&(r=a[n]);return r},Fe=function(a,r,n){var s=r/8|0;return(a[s]|a[s+1]<<8)>>(r&7)&n},Ur=function(a,r){var n=r/8|0;return(a[n]|a[n+1]<<8|a[n+2]<<16)>>(r&7)},Vn=function(a){return(a/8|0)+(a&7&&1)},Yn=function(a,r,n){(n==null||n>a.length)&&(n=a.length);var s=new(a instanceof qe?qe:a instanceof Br?Br:Ae)(n-r);return s.set(a.subarray(r,n)),s},qn=function(a,r,n){var s=a.length;if(!s||n&&!n.l&&s<5)return r||new Ae(0);var c=!r||n,u=!n||n.i;n||(n={}),r||(r=new Ae(s*3));var l=function(q){var je=r.length;if(q>je){var ve=new Ae(Math.max(je*2,q));ve.set(r),r=ve}},p=n.f||0,g=n.p||0,v=n.b||0,x=n.l,C=n.d,O=n.m,L=n.n,B=s*8;do{if(!x){n.f=p=Fe(a,g,1);var me=Fe(a,g+1,3);if(g+=3,me)if(me==1)x=$n,C=Xn,O=9,L=5;else if(me==2){var le=Fe(a,g,31)+257,de=Fe(a,g+10,15)+4,W=le+Fe(a,g+5,31)+1;g+=14;for(var F=new Ae(W),ee=new Ae(19),I=0;I<de;++I)ee[Hn[I]]=Fe(a,g+I*3,7);g+=de*3;for(var M=Nr(ee),z=(1<<M)-1,k=mr(ee,M,1),I=0;I<W;){var Z=k[Fe(a,g,z)];g+=Z&15;var H=Z>>>4;if(H<16)F[I++]=H;else{var $=0,j=0;for(H==16?(j=3+Fe(a,g,3),g+=2,$=F[I-1]):H==17?(j=3+Fe(a,g,7),g+=3):H==18&&(j=11+Fe(a,g,127),g+=7);j--;)F[I++]=$}}var U=F.subarray(0,le),N=F.subarray(le);O=Nr(U),L=Nr(N),x=mr(U,O,1),C=mr(N,L,1)}else throw"invalid block type";else{var H=Vn(g)+4,Y=a[H-4]|a[H-3]<<8,Q=H+Y;if(Q>s){if(u)throw"unexpected EOF";break}c&&l(v+Y),r.set(a.subarray(H,Q),v),n.b=v+=Y,n.p=g=Q*8;continue}if(g>B){if(u)throw"unexpected EOF";break}}c&&l(v+131072);for(var ce=(1<<O)-1,ke=(1<<L)-1,fe=g;;fe=g){var $=x[Ur(a,g)&ce],X=$>>>4;if(g+=$&15,g>B){if(u)throw"unexpected EOF";break}if(!$)throw"invalid length/literal";if(X<256)r[v++]=X;else if(X==256){fe=g,x=null;break}else{var Me=X-254;if(X>264){var I=X-257,V=xt[I];Me=Fe(a,g,(1<<V)-1)+St[I],g+=V}var ne=C[Ur(a,g)&ke],xe=ne>>>4;if(!ne)throw"invalid distance";g+=ne&15;var N=Wn[xe];if(xe>3){var V=wt[xe];N+=Ur(a,g)&(1<<V)-1,g+=V}if(g>B){if(u)throw"unexpected EOF";break}c&&l(v+131072);for(var Pe=v+Me;v<Pe;v+=4)r[v]=r[v-N],r[v+1]=r[v+1-N],r[v+2]=r[v+2-N],r[v+3]=r[v+3-N];v=Pe}}n.l=x,n.p=fe,n.b=v,x&&(p=1,n.m=O,n.d=C,n.n=L)}while(!p);return v==r.length?r:Yn(r,0,v)},Jn=new Ae(0),Kn=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Sr(a,r){return qn((Kn(a),a.subarray(2,-4)),r)}var Qn=typeof TextDecoder<"u"&&new TextDecoder,ea=0;try{Qn.decode(Jn,{stream:!0}),ea=1}catch{}const ra=a=>a&&a.isCubeTexture;class ta extends Wr{constructor(r,n){var s,c;const u=ra(r),p=((c=u?(s=r.image[0])==null?void 0:s.width:r.image.width)!=null?c:1024)/4,g=Math.floor(Math.log2(p)),v=Math.pow(2,g),x=3*Math.max(v,16*7),C=4*v,O=[u?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/x}`,`#define CUBEUV_TEXEL_HEIGHT ${1/C}`,`#define CUBEUV_MAX_MIP ${g}.0`],L=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,B=O.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${gt>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,me={map:{value:r},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},H=new an(1,16),Y=new $r({uniforms:me,fragmentShader:B,vertexShader:L,side:ht});super(H,Y)}set radius(r){this.material.uniforms.radius.value=r}get radius(){return this.material.uniforms.radius.value}set height(r){this.material.uniforms.height.value=r}get height(){return this.material.uniforms.height.value}}class na extends pt{constructor(r){super(r),this.type=Te}parse(r){const l=function(I,M){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(M||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(M||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(M||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(M||""))}},x=`
`,C=function(I,M,z){M=M||1024;let Z=I.pos,$=-1,j=0,U="",N=String.fromCharCode.apply(null,new Uint16Array(I.subarray(Z,Z+128)));for(;0>($=N.indexOf(x))&&j<M&&Z<I.byteLength;)U+=N,j+=N.length,Z+=128,N+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(Z,Z+128)));return-1<$?(I.pos+=j+$+1,U+N.slice(0,$)):!1},O=function(I){const M=/^#\?(\S+)/,z=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,k=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,$=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let U,N;for((I.pos>=I.byteLength||!(U=C(I)))&&l(1,"no header found"),(N=U.match(M))||l(3,"bad initial token"),j.valid|=1,j.programtype=N[1],j.string+=U+`
`;U=C(I),U!==!1;){if(j.string+=U+`
`,U.charAt(0)==="#"){j.comments+=U+`
`;continue}if((N=U.match(z))&&(j.gamma=parseFloat(N[1])),(N=U.match(k))&&(j.exposure=parseFloat(N[1])),(N=U.match(Z))&&(j.valid|=2,j.format=N[1]),(N=U.match($))&&(j.valid|=4,j.height=parseInt(N[1],10),j.width=parseInt(N[2],10)),j.valid&2&&j.valid&4)break}return j.valid&2||l(3,"missing format specifier"),j.valid&4||l(3,"missing image size specifier"),j},L=function(I,M,z){const k=M;if(k<8||k>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);k!==(I[2]<<8|I[3])&&l(3,"wrong scanline width");const Z=new Uint8Array(4*M*z);Z.length||l(4,"unable to allocate buffer space");let $=0,j=0;const U=4*k,N=new Uint8Array(4),ce=new Uint8Array(U);let ke=z;for(;ke>0&&j<I.byteLength;){j+4>I.byteLength&&l(1),N[0]=I[j++],N[1]=I[j++],N[2]=I[j++],N[3]=I[j++],(N[0]!=2||N[1]!=2||(N[2]<<8|N[3])!=k)&&l(3,"bad rgbe scanline format");let fe=0,X;for(;fe<U&&j<I.byteLength;){X=I[j++];const V=X>128;if(V&&(X-=128),(X===0||fe+X>U)&&l(3,"bad scanline data"),V){const ne=I[j++];for(let xe=0;xe<X;xe++)ce[fe++]=ne}else ce.set(I.subarray(j,j+X),fe),fe+=X,j+=X}const Me=k;for(let V=0;V<Me;V++){let ne=0;Z[$]=ce[V+ne],ne+=k,Z[$+1]=ce[V+ne],ne+=k,Z[$+2]=ce[V+ne],ne+=k,Z[$+3]=ce[V+ne],$+=4}ke--}return Z},B=function(I,M,z,k){const Z=I[M+3],$=Math.pow(2,Z-128)/255;z[k+0]=I[M+0]*$,z[k+1]=I[M+1]*$,z[k+2]=I[M+2]*$,z[k+3]=1},me=function(I,M,z,k){const Z=I[M+3],$=Math.pow(2,Z-128)/255;z[k+0]=rr.toHalfFloat(Math.min(I[M+0]*$,65504)),z[k+1]=rr.toHalfFloat(Math.min(I[M+1]*$,65504)),z[k+2]=rr.toHalfFloat(Math.min(I[M+2]*$,65504)),z[k+3]=rr.toHalfFloat(1)},H=new Uint8Array(r);H.pos=0;const Y=O(H),Q=Y.width,le=Y.height,de=L(H.subarray(H.pos),Q,le);let W,F,ee;switch(this.type){case ze:ee=de.length/4;const I=new Float32Array(ee*4);for(let z=0;z<ee;z++)B(de,z*4,I,z*4);W=I,F=ze;break;case Te:ee=de.length/4;const M=new Uint16Array(ee*4);for(let z=0;z<ee;z++)me(de,z*4,M,z*4);W=M,F=Te;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:Q,height:le,data:W,header:Y.string,gamma:Y.gamma,exposure:Y.exposure,type:F}}setDataType(r){return this.type=r,this}load(r,n,s,c){function u(l,p){switch(l.type){case ze:case Te:"colorSpace"in l?l.colorSpace="srgb-linear":l.encoding=3e3,l.minFilter=Ue,l.magFilter=Ue,l.generateMipmaps=!1,l.flipY=!0;break}n&&n(l,p)}return super.load(r,u,s,c)}}const dr=gt>=152;class aa extends pt{constructor(r){super(r),this.type=Te}parse(r){const M=Math.pow(2.7182818,2.2);function z(e,t){for(var i=0,d=0;d<65536;++d)(d==0||e[d>>3]&1<<(d&7))&&(t[i++]=d);for(var h=i-1;i<65536;)t[i++]=0;return h}function k(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const Z={l:0,c:0,lc:0};function $(e,t,i,d,h){for(;i<e;)t=t<<8|nt(d,h),i+=8;i-=e,Z.l=t>>i&(1<<e)-1,Z.c=t,Z.lc=i}const j=new Array(59);function U(e){for(var t=0;t<=58;++t)j[t]=0;for(var t=0;t<65537;++t)j[e[t]]+=1;for(var i=0,t=58;t>0;--t){var d=i+j[t]>>1;j[t]=i,i=d}for(var t=0;t<65537;++t){var h=e[t];h>0&&(e[t]=h|j[h]++<<6)}}function N(e,t,i,d,h,m,_){for(var f=i,b=0,E=0;h<=m;h++){if(f.value-i.value>d)return!1;$(6,b,E,e,f);var S=Z.l;if(b=Z.c,E=Z.lc,_[h]=S,S==63){if(f.value-i.value>d)throw"Something wrong with hufUnpackEncTable";$(8,b,E,e,f);var w=Z.l+6;if(b=Z.c,E=Z.lc,h+w>m+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)_[h++]=0;h--}else if(S>=59){var w=S-59+2;if(h+w>m+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)_[h++]=0;h--}}U(_)}function ce(e){return e&63}function ke(e){return e>>6}function fe(e,t,i,d){for(;t<=i;t++){var h=ke(e[t]),m=ce(e[t]);if(h>>m)throw"Invalid table entry";if(m>14){var _=d[h>>m-14];if(_.len)throw"Invalid table entry";if(_.lit++,_.p){var f=_.p;_.p=new Array(_.lit);for(var b=0;b<_.lit-1;++b)_.p[b]=f[b]}else _.p=new Array(1);_.p[_.lit-1]=t}else if(m)for(var E=0,b=1<<14-m;b>0;b--){var _=d[(h<<14-m)+E];if(_.len||_.p)throw"Invalid table entry";_.len=m,_.lit=t,E++}}return!0}const X={c:0,lc:0};function Me(e,t,i,d){e=e<<8|nt(i,d),t+=8,X.c=e,X.lc=t}const V={c:0,lc:0};function ne(e,t,i,d,h,m,_,f,b,E){if(e==t){d<8&&(Me(i,d,h,_),i=X.c,d=X.lc),d-=8;var S=i>>d,S=new Uint8Array([S])[0];if(b.value+S>E)return!1;for(var w=f[b.value-1];S-- >0;)f[b.value++]=w}else if(b.value<E)f[b.value++]=e;else return!1;V.c=i,V.lc=d}function xe(e){return e&65535}function Pe(e){var t=xe(e);return t>32767?t-65536:t}const q={a:0,b:0};function je(e,t){var i=Pe(e),d=Pe(t),h=d,m=i+(h&1)+(h>>1),_=m,f=m-h;q.a=_,q.b=f}function ve(e,t){var i=xe(e),d=xe(t),h=i-(d>>1)&65535,m=d+h-32768&65535;q.a=m,q.b=h}function _r(e,t,i,d,h,m,_){for(var f=_<16384,b=i>h?h:i,E=1,S;E<=b;)E<<=1;for(E>>=1,S=E,E>>=1;E>=1;){for(var w=0,he=w+m*(h-S),A=m*E,T=m*S,P=d*E,G=d*S,re,ae,ge,Ee;w<=he;w+=T){for(var ie=w,Ne=w+d*(i-S);ie<=Ne;ie+=G){var oe=ie+P,pe=ie+A,Be=pe+P;f?(je(e[ie+t],e[pe+t]),re=q.a,ge=q.b,je(e[oe+t],e[Be+t]),ae=q.a,Ee=q.b,je(re,ae),e[ie+t]=q.a,e[oe+t]=q.b,je(ge,Ee),e[pe+t]=q.a,e[Be+t]=q.b):(ve(e[ie+t],e[pe+t]),re=q.a,ge=q.b,ve(e[oe+t],e[Be+t]),ae=q.a,Ee=q.b,ve(re,ae),e[ie+t]=q.a,e[oe+t]=q.b,ve(ge,Ee),e[pe+t]=q.a,e[Be+t]=q.b)}if(i&E){var pe=ie+A;f?je(e[ie+t],e[pe+t]):ve(e[ie+t],e[pe+t]),re=q.a,e[pe+t]=q.b,e[ie+t]=re}}if(h&E)for(var ie=w,Ne=w+d*(i-S);ie<=Ne;ie+=G){var oe=ie+P;f?je(e[ie+t],e[oe+t]):ve(e[ie+t],e[oe+t]),re=q.a,e[oe+t]=q.b,e[ie+t]=re}S=E,E>>=1}return w}function we(e,t,i,d,h,m,_,f,b,E){for(var S=0,w=0,he=f,A=Math.trunc(h.value+(m+7)/8);h.value<A;)for(Me(S,w,i,h),S=X.c,w=X.lc;w>=14;){var T=S>>w-14&16383,P=t[T];if(P.len)w-=P.len,ne(P.lit,_,S,w,i,d,h,b,E,he),S=V.c,w=V.lc;else{if(!P.p)throw"hufDecode issues";var G;for(G=0;G<P.lit;G++){for(var re=ce(e[P.p[G]]);w<re&&h.value<A;)Me(S,w,i,h),S=X.c,w=X.lc;if(w>=re&&ke(e[P.p[G]])==(S>>w-re&(1<<re)-1)){w-=re,ne(P.p[G],_,S,w,i,d,h,b,E,he),S=V.c,w=V.lc;break}}if(G==P.lit)throw"hufDecode issues"}}var ae=8-m&7;for(S>>=ae,w-=ae;w>0;){var P=t[S<<14-w&16383];if(P.len)w-=P.len,ne(P.lit,_,S,w,i,d,h,b,E,he),S=V.c,w=V.lc;else throw"hufDecode issues"}return!0}function K(e,t,i,d,h,m){var _={value:0},f=i.value,b=be(t,i),E=be(t,i);i.value+=4;var S=be(t,i);if(i.value+=4,b<0||b>=65537||E<0||E>=65537)throw"Something wrong with HUF_ENCSIZE";var w=new Array(65537),he=new Array(16384);k(he);var A=d-(i.value-f);if(N(e,t,i,A,b,E,w),S>8*(d-(i.value-f)))throw"Something wrong with hufUncompress";fe(w,b,E,he),we(w,he,e,t,i,S,E,m,h,_)}function Ge(e,t,i){for(var d=0;d<i;++d)t[d]=e[t[d]]}function Ie(e){for(var t=1;t<e.length;t++){var i=e[t-1]+e[t]-128;e[t]=i}}function $e(e,t){for(var i=0,d=Math.floor((e.length+1)/2),h=0,m=e.length-1;!(h>m||(t[h++]=e[i++],h>m));)t[h++]=e[d++]}function Je(e){for(var t=e.byteLength,i=new Array,d=0,h=new DataView(e);t>0;){var m=h.getInt8(d++);if(m<0){var _=-m;t-=_+1;for(var f=0;f<_;f++)i.push(h.getUint8(d++))}else{var _=m;t-=2;for(var b=h.getUint8(d++),f=0;f<_+1;f++)i.push(b)}}return i}function Tr(e,t,i,d,h,m){var oe=new DataView(m.buffer),_=i[e.idx[0]].width,f=i[e.idx[0]].height,b=3,E=Math.floor(_/8),S=Math.ceil(_/8),w=Math.ceil(f/8),he=_-(S-1)*8,A=f-(w-1)*8,T={value:0},P=new Array(b),G=new Array(b),re=new Array(b),ae=new Array(b),ge=new Array(b);for(let te=0;te<b;++te)ge[te]=t[e.idx[te]],P[te]=te<1?0:P[te-1]+S*w,G[te]=new Float32Array(64),re[te]=new Uint16Array(64),ae[te]=new Uint16Array(S*64);for(let te=0;te<w;++te){var Ee=8;te==w-1&&(Ee=A);var ie=8;for(let ue=0;ue<S;++ue){ue==S-1&&(ie=he);for(let J=0;J<b;++J)re[J].fill(0),re[J][0]=h[P[J]++],Le(T,d,re[J]),yr(re[J],G[J]),ar(G[J]);xr(G);for(let J=0;J<b;++J)jr(G[J],ae[J],ue*64)}let ye=0;for(let ue=0;ue<b;++ue){const J=i[e.idx[ue]].type;for(let Oe=8*te;Oe<8*te+Ee;++Oe){ye=ge[ue][Oe];for(let Ke=0;Ke<E;++Ke){const Se=Ke*64+(Oe&7)*8;oe.setUint16(ye+0*2*J,ae[ue][Se+0],!0),oe.setUint16(ye+1*2*J,ae[ue][Se+1],!0),oe.setUint16(ye+2*2*J,ae[ue][Se+2],!0),oe.setUint16(ye+3*2*J,ae[ue][Se+3],!0),oe.setUint16(ye+4*2*J,ae[ue][Se+4],!0),oe.setUint16(ye+5*2*J,ae[ue][Se+5],!0),oe.setUint16(ye+6*2*J,ae[ue][Se+6],!0),oe.setUint16(ye+7*2*J,ae[ue][Se+7],!0),ye+=8*2*J}}if(E!=S)for(let Oe=8*te;Oe<8*te+Ee;++Oe){const Ke=ge[ue][Oe]+8*E*2*J,Se=E*64+(Oe&7)*8;for(let Xe=0;Xe<ie;++Xe)oe.setUint16(Ke+Xe*2*J,ae[ue][Se+Xe],!0)}}}for(var Ne=new Uint16Array(_),oe=new DataView(m.buffer),pe=0;pe<b;++pe){i[e.idx[pe]].decoded=!0;var Be=i[e.idx[pe]].type;if(i[pe].type==2)for(var ur=0;ur<f;++ur){const te=ge[pe][ur];for(var Re=0;Re<_;++Re)Ne[Re]=oe.getUint16(te+Re*2*Be,!0);for(var Re=0;Re<_;++Re)oe.setFloat32(te+Re*2*Be,R(Ne[Re]),!0)}}}function Le(e,t,i){for(var d,h=1;h<64;)d=t[e.value],d==65280?h=64:d>>8==255?h+=d&255:(i[h]=d,h++),e.value++}function yr(e,t){t[0]=R(e[0]),t[1]=R(e[1]),t[2]=R(e[5]),t[3]=R(e[6]),t[4]=R(e[14]),t[5]=R(e[15]),t[6]=R(e[27]),t[7]=R(e[28]),t[8]=R(e[2]),t[9]=R(e[4]),t[10]=R(e[7]),t[11]=R(e[13]),t[12]=R(e[16]),t[13]=R(e[26]),t[14]=R(e[29]),t[15]=R(e[42]),t[16]=R(e[3]),t[17]=R(e[8]),t[18]=R(e[12]),t[19]=R(e[17]),t[20]=R(e[25]),t[21]=R(e[30]),t[22]=R(e[41]),t[23]=R(e[43]),t[24]=R(e[9]),t[25]=R(e[11]),t[26]=R(e[18]),t[27]=R(e[24]),t[28]=R(e[31]),t[29]=R(e[40]),t[30]=R(e[44]),t[31]=R(e[53]),t[32]=R(e[10]),t[33]=R(e[19]),t[34]=R(e[23]),t[35]=R(e[32]),t[36]=R(e[39]),t[37]=R(e[45]),t[38]=R(e[52]),t[39]=R(e[54]),t[40]=R(e[20]),t[41]=R(e[22]),t[42]=R(e[33]),t[43]=R(e[38]),t[44]=R(e[46]),t[45]=R(e[51]),t[46]=R(e[55]),t[47]=R(e[60]),t[48]=R(e[21]),t[49]=R(e[34]),t[50]=R(e[37]),t[51]=R(e[47]),t[52]=R(e[50]),t[53]=R(e[56]),t[54]=R(e[59]),t[55]=R(e[61]),t[56]=R(e[35]),t[57]=R(e[36]),t[58]=R(e[48]),t[59]=R(e[49]),t[60]=R(e[57]),t[61]=R(e[58]),t[62]=R(e[62]),t[63]=R(e[63])}function ar(e){const t=.5*Math.cos(.7853975),i=.5*Math.cos(3.14159/16),d=.5*Math.cos(3.14159/8),h=.5*Math.cos(3*3.14159/16),m=.5*Math.cos(5*3.14159/16),_=.5*Math.cos(3*3.14159/8),f=.5*Math.cos(7*3.14159/16);for(var b=new Array(4),E=new Array(4),S=new Array(4),w=new Array(4),he=0;he<8;++he){var A=he*8;b[0]=d*e[A+2],b[1]=_*e[A+2],b[2]=d*e[A+6],b[3]=_*e[A+6],E[0]=i*e[A+1]+h*e[A+3]+m*e[A+5]+f*e[A+7],E[1]=h*e[A+1]-f*e[A+3]-i*e[A+5]-m*e[A+7],E[2]=m*e[A+1]-i*e[A+3]+f*e[A+5]+h*e[A+7],E[3]=f*e[A+1]-m*e[A+3]+h*e[A+5]-i*e[A+7],S[0]=t*(e[A+0]+e[A+4]),S[3]=t*(e[A+0]-e[A+4]),S[1]=b[0]+b[3],S[2]=b[1]-b[2],w[0]=S[0]+S[1],w[1]=S[3]+S[2],w[2]=S[3]-S[2],w[3]=S[0]-S[1],e[A+0]=w[0]+E[0],e[A+1]=w[1]+E[1],e[A+2]=w[2]+E[2],e[A+3]=w[3]+E[3],e[A+4]=w[3]-E[3],e[A+5]=w[2]-E[2],e[A+6]=w[1]-E[1],e[A+7]=w[0]-E[0]}for(var T=0;T<8;++T)b[0]=d*e[16+T],b[1]=_*e[16+T],b[2]=d*e[48+T],b[3]=_*e[48+T],E[0]=i*e[8+T]+h*e[24+T]+m*e[40+T]+f*e[56+T],E[1]=h*e[8+T]-f*e[24+T]-i*e[40+T]-m*e[56+T],E[2]=m*e[8+T]-i*e[24+T]+f*e[40+T]+h*e[56+T],E[3]=f*e[8+T]-m*e[24+T]+h*e[40+T]-i*e[56+T],S[0]=t*(e[T]+e[32+T]),S[3]=t*(e[T]-e[32+T]),S[1]=b[0]+b[3],S[2]=b[1]-b[2],w[0]=S[0]+S[1],w[1]=S[3]+S[2],w[2]=S[3]-S[2],w[3]=S[0]-S[1],e[0+T]=w[0]+E[0],e[8+T]=w[1]+E[1],e[16+T]=w[2]+E[2],e[24+T]=w[3]+E[3],e[32+T]=w[3]-E[3],e[40+T]=w[2]-E[2],e[48+T]=w[1]-E[1],e[56+T]=w[0]-E[0]}function xr(e){for(var t=0;t<64;++t){var i=e[0][t],d=e[1][t],h=e[2][t];e[0][t]=i+1.5747*h,e[1][t]=i-.1873*d-.4682*h,e[2][t]=i+1.8556*d}}function jr(e,t,i){for(var d=0;d<64;++d)t[i+d]=rr.toHalfFloat(Fr(e[d]))}function Fr(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(M,Math.abs(e)-1)}function wr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function kr(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),i=new Uint8Array(Je(t)),d=new Uint8Array(i.length);return Ie(i),$e(i,d),new DataView(d.buffer)}function ir(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),i=Sr(t),d=new Uint8Array(i.length);return Ie(i),$e(i,d),new DataView(d.buffer)}function Pr(e){for(var t=e.viewer,i={value:e.offset.value},d=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),h=new Uint8Array(8192),m=0,_=new Array(e.channels),f=0;f<e.channels;f++)_[f]={},_[f].start=m,_[f].end=_[f].start,_[f].nx=e.width,_[f].ny=e.lines,_[f].size=e.type,m+=_[f].nx*_[f].ny*_[f].size;var b=sr(t,i),E=sr(t,i);if(E>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(b<=E)for(var f=0;f<E-b+1;f++)h[f+b]=er(t,i);var S=new Uint16Array(65536),w=z(h,S),he=be(t,i);K(e.array,t,i,he,d,m);for(var f=0;f<e.channels;++f)for(var A=_[f],T=0;T<_[f].size;++T)_r(d,A.start+T,A.nx,A.size,A.ny,A.nx*A.size,w);Ge(S,d,m);for(var P=0,G=new Uint8Array(d.buffer.byteLength),re=0;re<e.lines;re++)for(var ae=0;ae<e.channels;ae++){var A=_[ae],ge=A.nx*A.size,Ee=new Uint8Array(d.buffer,A.end*2,ge*2);G.set(Ee,P),P+=ge*2,A.end+=ge}return new DataView(G.buffer)}function De(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),i=Sr(t);const d=e.lines*e.channels*e.width,h=e.type==1?new Uint16Array(d):new Uint32Array(d);let m=0,_=0;const f=new Array(4);for(let b=0;b<e.lines;b++)for(let E=0;E<e.channels;E++){let S=0;switch(e.type){case 1:f[0]=m,f[1]=f[0]+e.width,m=f[1]+e.width;for(let w=0;w<e.width;++w){const he=i[f[0]++]<<8|i[f[1]++];S+=he,h[_]=S,_++}break;case 2:f[0]=m,f[1]=f[0]+e.width,f[2]=f[1]+e.width,m=f[2]+e.width;for(let w=0;w<e.width;++w){const he=i[f[0]++]<<24|i[f[1]++]<<16|i[f[2]++]<<8;S+=he,h[_]=S,_++}break}}return new DataView(h.buffer)}function tt(e){var t=e.viewer,i={value:e.offset.value},d=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),h={version:Ce(t,i),unknownUncompressedSize:Ce(t,i),unknownCompressedSize:Ce(t,i),acCompressedSize:Ce(t,i),dcCompressedSize:Ce(t,i),rleCompressedSize:Ce(t,i),rleUncompressedSize:Ce(t,i),rleRawSize:Ce(t,i),totalAcUncompressedCount:Ce(t,i),totalDcUncompressedCount:Ce(t,i),acCompression:Ce(t,i)};if(h.version<2)throw"EXRLoader.parse: "+cr.compression+" version "+h.version+" is unsupported";for(var m=new Array,_=sr(t,i)-2;_>0;){var f=Er(t.buffer,i),b=er(t,i),E=b>>2&3,S=(b>>4)-1,w=new Int8Array([S])[0],he=er(t,i);m.push({name:f,index:w,type:he,compression:E}),_-=f.length+3}for(var A=cr.channels,T=new Array(e.channels),P=0;P<e.channels;++P){var G=T[P]={},re=A[P];G.name=re.name,G.compression=0,G.decoded=!1,G.type=re.pixelType,G.pLinear=re.pLinear,G.width=e.width,G.height=e.lines}for(var ae={idx:new Array(3)},ge=0;ge<e.channels;++ge)for(var G=T[ge],P=0;P<m.length;++P){var Ee=m[P];G.name==Ee.name&&(G.compression=Ee.compression,Ee.index>=0&&(ae.idx[Ee.index]=ge),G.offset=ge)}if(h.acCompressedSize>0)switch(h.acCompression){case 0:var oe=new Uint16Array(h.totalAcUncompressedCount);K(e.array,t,i,h.acCompressedSize,oe,h.totalAcUncompressedCount);break;case 1:var ie=e.array.slice(i.value,i.value+h.totalAcUncompressedCount),Ne=Sr(ie),oe=new Uint16Array(Ne.buffer);i.value+=h.totalAcUncompressedCount;break}if(h.dcCompressedSize>0){var pe={array:e.array,offset:i,size:h.dcCompressedSize},Be=new Uint16Array(ir(pe).buffer);i.value+=h.dcCompressedSize}if(h.rleRawSize>0){var ie=e.array.slice(i.value,i.value+h.rleCompressedSize),Ne=Sr(ie),ur=Je(Ne.buffer);i.value+=h.rleCompressedSize}for(var Re=0,te=new Array(T.length),P=0;P<te.length;++P)te[P]=new Array;for(var ye=0;ye<e.lines;++ye)for(var ue=0;ue<T.length;++ue)te[ue].push(Re),Re+=T[ue].width*e.type*2;Tr(ae,te,T,oe,Be,d);for(var P=0;P<T.length;++P){var G=T[P];if(!G.decoded)switch(G.compression){case 2:for(var J=0,Oe=0,ye=0;ye<e.lines;++ye){for(var Ke=te[P][J],Se=0;Se<G.width;++Se){for(var Xe=0;Xe<2*G.type;++Xe)d[Ke++]=ur[Oe+Xe*G.width*G.height];Oe++}J++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(d.buffer)}function Er(e,t){for(var i=new Uint8Array(e),d=0;i[t.value+d]!=0;)d+=1;var h=new TextDecoder().decode(i.slice(t.value,t.value+d));return t.value=t.value+d+1,h}function Lt(e,t,i){var d=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+i));return t.value=t.value+i,d}function Dt(e,t){var i=or(e,t),d=be(e,t);return[i,d]}function Bt(e,t){var i=be(e,t),d=be(e,t);return[i,d]}function or(e,t){var i=e.getInt32(t.value,!0);return t.value=t.value+4,i}function be(e,t){var i=e.getUint32(t.value,!0);return t.value=t.value+4,i}function nt(e,t){var i=e[t.value];return t.value=t.value+1,i}function er(e,t){var i=e.getUint8(t.value);return t.value=t.value+1,i}const Ce=function(e,t){let i;return"getBigInt64"in DataView.prototype?i=Number(e.getBigInt64(t.value,!0)):i=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,i};function _e(e,t){var i=e.getFloat32(t.value,!0);return t.value+=4,i}function Ht(e,t){return rr.toHalfFloat(_e(e,t))}function R(e){var t=(e&31744)>>10,i=e&1023;return(e>>15?-1:1)*(t?t===31?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):6103515625e-14*(i/1024))}function sr(e,t){var i=e.getUint16(t.value,!0);return t.value+=2,i}function zt(e,t){return R(sr(e,t))}function Zt(e,t,i,d){for(var h=i.value,m=[];i.value<h+d-1;){var _=Er(t,i),f=or(e,i),b=er(e,i);i.value+=3;var E=or(e,i),S=or(e,i);m.push({name:_,pixelType:f,pLinear:b,xSampling:E,ySampling:S})}return i.value+=1,m}function Wt(e,t){var i=_e(e,t),d=_e(e,t),h=_e(e,t),m=_e(e,t),_=_e(e,t),f=_e(e,t),b=_e(e,t),E=_e(e,t);return{redX:i,redY:d,greenX:h,greenY:m,blueX:_,blueY:f,whiteX:b,whiteY:E}}function $t(e,t){var i=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],d=er(e,t);return i[d]}function Xt(e,t){var i=be(e,t),d=be(e,t),h=be(e,t),m=be(e,t);return{xMin:i,yMin:d,xMax:h,yMax:m}}function Vt(e,t){var i=["INCREASING_Y"],d=er(e,t);return i[d]}function Yt(e,t){var i=_e(e,t),d=_e(e,t);return[i,d]}function qt(e,t){var i=_e(e,t),d=_e(e,t),h=_e(e,t);return[i,d,h]}function Jt(e,t,i,d,h){if(d==="string"||d==="stringvector"||d==="iccProfile")return Lt(t,i,h);if(d==="chlist")return Zt(e,t,i,h);if(d==="chromaticities")return Wt(e,i);if(d==="compression")return $t(e,i);if(d==="box2i")return Xt(e,i);if(d==="lineOrder")return Vt(e,i);if(d==="float")return _e(e,i);if(d==="v2f")return Yt(e,i);if(d==="v3f")return qt(e,i);if(d==="int")return or(e,i);if(d==="rational")return Dt(e,i);if(d==="timecode")return Bt(e,i);if(d==="preview")return i.value+=h,"skipped";i.value+=h}function Kt(e,t,i){const d={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";d.version=e.getUint8(4);const h=e.getUint8(5);d.spec={singleTile:!!(h&2),longName:!!(h&4),deepFormat:!!(h&8),multiPart:!!(h&16)},i.value=8;for(var m=!0;m;){var _=Er(t,i);if(_==0)m=!1;else{var f=Er(t,i),b=be(e,i),E=Jt(e,t,i,f,b);E===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${f}'.`):d[_]=E}}if((h&-5)!=0)throw console.error("EXRHeader:",d),"THREE.EXRLoader: provided file is currently unsupported.";return d}function Qt(e,t,i,d,h){const m={size:0,viewer:t,array:i,offset:d,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[dr?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":m.lines=1,m.uncompress=wr;break;case"RLE_COMPRESSION":m.lines=1,m.uncompress=kr;break;case"ZIPS_COMPRESSION":m.lines=1,m.uncompress=ir;break;case"ZIP_COMPRESSION":m.lines=16,m.uncompress=ir;break;case"PIZ_COMPRESSION":m.lines=32,m.uncompress=Pr;break;case"PXR24_COMPRESSION":m.lines=16,m.uncompress=De;break;case"DWAA_COMPRESSION":m.lines=32,m.uncompress=tt;break;case"DWAB_COMPRESSION":m.lines=256,m.uncompress=tt;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(m.scanlineBlockSize=m.lines,m.type==1)switch(h){case ze:m.getter=zt,m.inputSize=2;break;case Te:m.getter=sr,m.inputSize=2;break}else if(m.type==2)switch(h){case ze:m.getter=_e,m.inputSize=4;break;case Te:m.getter=Ht,m.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+m.type+" for "+e.compression+".";m.blockCount=(e.dataWindow.yMax+1)/m.scanlineBlockSize;for(var _=0;_<m.blockCount;_++)Ce(t,d);m.outputChannels=m.channels==3?4:m.channels;const f=m.width*m.height*m.outputChannels;switch(h){case ze:m.byteArray=new Float32Array(f),m.channels<m.outputChannels&&m.byteArray.fill(1,0,f);break;case Te:m.byteArray=new Uint16Array(f),m.channels<m.outputChannels&&m.byteArray.fill(15360,0,f);break;default:console.error("THREE.EXRLoader: unsupported type: ",h);break}return m.bytesPerLine=m.width*m.inputSize*m.channels,m.outputChannels==4?m.format=gr:m.format=on,dr?m.colorSpace="srgb-linear":m.encoding=3e3,m}const br=new DataView(r),en=new Uint8Array(r),lr={value:0},cr=Kt(br,r,lr),D=Qt(cr,br,en,lr,this.type),at={value:0},rn={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<D.height/D.scanlineBlockSize;e++){const t=be(br,lr);D.size=be(br,lr),D.lines=t+D.scanlineBlockSize>D.height?D.height-t:D.scanlineBlockSize;const d=D.size<D.lines*D.bytesPerLine?D.uncompress(D):wr(D);lr.value+=D.size;for(let h=0;h<D.scanlineBlockSize;h++){const m=h+e*D.scanlineBlockSize;if(m>=D.height)break;for(let _=0;_<D.channels;_++){const f=rn[cr.channels[_].name];for(let b=0;b<D.width;b++){at.value=(h*(D.channels*D.width)+_*D.width+b)*D.inputSize;const E=(D.height-1-m)*(D.width*D.outputChannels)+b*D.outputChannels+f;D.byteArray[E]=D.getter(d,at)}}}}return{header:cr,width:D.width,height:D.height,data:D.byteArray,format:D.format,[dr?"colorSpace":"encoding"]:D[dr?"colorSpace":"encoding"],type:this.type}}setDataType(r){return this.type=r,this}load(r,n,s,c){function u(l,p){dr?l.colorSpace=p.colorSpace:l.encoding=p.encoding,l.minFilter=Ue,l.magFilter=Ue,l.generateMipmaps=!1,l.flipY=!1,n&&n(l,p)}return super.load(r,u,s,c)}}function Vr(a,r){const n=y.useRef(null),[s]=y.useState(()=>r?r instanceof it?{current:r}:r:n),[c]=y.useState(()=>new sn(void 0));y.useLayoutEffect(()=>{r&&(s.current=r instanceof it?r:r.current),c._root=s.current});const u=y.useRef({}),l=y.useMemo(()=>{const p={};return a.forEach(g=>Object.defineProperty(p,g.name,{enumerable:!0,get(){if(s.current)return u.current[g.name]||(u.current[g.name]=c.clipAction(g,s.current))},configurable:!0})),{ref:s,clips:a,actions:p,names:a.map(g=>g.name),mixer:c}},[a]);return zr((p,g)=>c.update(g)),y.useEffect(()=>{const p=s.current;return()=>{u.current={},c.stopAllAction(),Object.values(l.actions).forEach(g=>{p&&c.uncacheAction(g,p)})}},[a]),l}const It=(a,r,n)=>{let s;switch(a){case Lr:s=new Uint8ClampedArray(r*n*4);break;case Te:s=new Uint16Array(r*n*4);break;case gn:s=new Uint32Array(r*n*4);break;case mn:s=new Int8Array(r*n*4);break;case hn:s=new Int16Array(r*n*4);break;case dn:s=new Int32Array(r*n*4);break;case ze:s=new Float32Array(r*n*4);break;default:throw new Error("Unsupported data type")}return s};let Mr;const ia=(a,r,n,s)=>{if(Mr!==void 0)return Mr;const c=new _t(1,1,s);r.setRenderTarget(c);const u=new Wr(new vt,new un({color:16777215}));r.render(u,n),r.setRenderTarget(null);const l=It(a,c.width,c.height);return r.readRenderTargetPixels(c,0,0,c.width,c.height,l),c.dispose(),u.geometry.dispose(),u.material.dispose(),Mr=l[0]!==0,Mr};class Yr{constructor(r){var n,s,c,u,l,p,g,v,x,C,O,L,B,me,H,Y;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(le){throw this._renderer.setRenderTarget(null),le}this._renderer.setRenderTarget(null)},this._width=r.width,this._height=r.height,this._type=r.type,this._colorSpace=r.colorSpace;const Q={format:gr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=r.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(s=r.renderTargetOptions)===null||s===void 0?void 0:s.anisotropy:1,generateMipmaps:((c=r.renderTargetOptions)===null||c===void 0?void 0:c.generateMipmaps)!==void 0?(u=r.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps:!1,magFilter:((l=r.renderTargetOptions)===null||l===void 0?void 0:l.magFilter)!==void 0?(p=r.renderTargetOptions)===null||p===void 0?void 0:p.magFilter:Ue,minFilter:((g=r.renderTargetOptions)===null||g===void 0?void 0:g.minFilter)!==void 0?(v=r.renderTargetOptions)===null||v===void 0?void 0:v.minFilter:Ue,samples:((x=r.renderTargetOptions)===null||x===void 0?void 0:x.samples)!==void 0?(C=r.renderTargetOptions)===null||C===void 0?void 0:C.samples:void 0,wrapS:((O=r.renderTargetOptions)===null||O===void 0?void 0:O.wrapS)!==void 0?(L=r.renderTargetOptions)===null||L===void 0?void 0:L.wrapS:Ye,wrapT:((B=r.renderTargetOptions)===null||B===void 0?void 0:B.wrapT)!==void 0?(me=r.renderTargetOptions)===null||me===void 0?void 0:me.wrapT:Ye};if(this._material=r.material,r.renderer?this._renderer=r.renderer:(this._renderer=Yr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new ft,this._camera=new Zr,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!ia(this._type,this._renderer,this._camera,Q)){let le;switch(this._type){case Te:le=this._renderer.extensions.has("EXT_color_buffer_float")?ze:void 0;break}le!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${ze}`),this._type=le):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Wr(new vt,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new _t(this.width,this.height,Q),this._renderTarget.texture.mapping=((H=r.renderTargetOptions)===null||H===void 0?void 0:H.mapping)!==void 0?(Y=r.renderTargetOptions)===null||Y===void 0?void 0:Y.mapping:Rr}static instantiateRenderer(){const r=new ln;return r.setSize(128,128),r}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const r=It(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,r),r}toDataTexture(r){const n=new cn(this.toArray(),this.width,this.height,gr,this._type,(r==null?void 0:r.mapping)||Rr,(r==null?void 0:r.wrapS)||Ye,(r==null?void 0:r.wrapT)||Ye,(r==null?void 0:r.magFilter)||Ue,(r==null?void 0:r.minFilter)||Ue,(r==null?void 0:r.anisotropy)||1,Gr);return n.generateMipmaps=(r==null?void 0:r.generateMipmaps)!==void 0?r==null?void 0:r.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(r){this.disposeOnDemandRenderer(),r&&this.renderTarget.dispose(),this.material instanceof $r&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof tr&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof tr&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(r){this._width=r,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(r){this._height=r,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(r){this._renderTarget=r,this._width=r.width,this._height=r.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const oa=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,sa=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class la extends $r{constructor({gamma:r,offsetHdr:n,offsetSdr:s,gainMapMin:c,gainMapMax:u,maxDisplayBoost:l,hdrCapacityMin:p,hdrCapacityMax:g,sdr:v,gainMap:x}){super({name:"GainMapDecoderMaterial",vertexShader:oa,fragmentShader:sa,uniforms:{sdr:{value:v},gainMap:{value:x},gamma:{value:new He(1/r[0],1/r[1],1/r[2])},offsetHdr:{value:new He().fromArray(n)},offsetSdr:{value:new He().fromArray(s)},gainMapMin:{value:new He().fromArray(c)},gainMapMax:{value:new He().fromArray(u)},weightFactor:{value:(Math.log2(l)-p)/(g-p)}},blending:_n,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=l,this._hdrCapacityMin=p,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(r){this.uniforms.sdr.value=r}get gainMap(){return this.uniforms.gainMap.value}set gainMap(r){this.uniforms.gainMap.value=r}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(r){this.uniforms.offsetHdr.value.fromArray(r)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(r){this.uniforms.offsetSdr.value.fromArray(r)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(r){this.uniforms.gainMapMin.value.fromArray(r)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(r){this.uniforms.gainMapMax.value.fromArray(r)}get gamma(){const r=this.uniforms.gamma.value;return[1/r.x,1/r.y,1/r.z]}set gamma(r){const n=this.uniforms.gamma.value;n.x=1/r[0],n.y=1/r[1],n.z=1/r[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(r){this._hdrCapacityMin=r,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(r){this._hdrCapacityMax=r,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(r){this._maxDisplayBoost=Math.max(1,Math.min(65504,r)),this.calculateWeight()}calculateWeight(){const r=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,r))}}class Ct extends Error{}class Rt extends Error{}const hr=(a,r,n)=>{const s=new RegExp(`${r}="([^"]*)"`,"i").exec(a);if(s)return s[1];const c=new RegExp(`<${r}[^>]*>([\\s\\S]*?)</${r}>`,"i").exec(a);if(c){const u=c[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return u&&u.length===3?u.map(l=>l.replace(/<\/?rdf:li>/g,"")):c[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${r} in gainmap metadata`)},ca=a=>{let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(a):r=a.toString();let n=r.indexOf("<x:xmpmeta");for(;n!==-1;){const s=r.indexOf("x:xmpmeta>",n),c=r.slice(n,s+10);try{const u=hr(c,"hdrgm:GainMapMin","0"),l=hr(c,"hdrgm:GainMapMax"),p=hr(c,"hdrgm:Gamma","1"),g=hr(c,"hdrgm:OffsetSDR","0.015625"),v=hr(c,"hdrgm:OffsetHDR","0.015625"),x=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(c),C=x?x[1]:"0",O=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(c);if(!O)throw new Error("Incomplete gainmap metadata");const L=O[1];return{gainMapMin:Array.isArray(u)?u.map(B=>parseFloat(B)):[parseFloat(u),parseFloat(u),parseFloat(u)],gainMapMax:Array.isArray(l)?l.map(B=>parseFloat(B)):[parseFloat(l),parseFloat(l),parseFloat(l)],gamma:Array.isArray(p)?p.map(B=>parseFloat(B)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetSdr:Array.isArray(g)?g.map(B=>parseFloat(B)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetHdr:Array.isArray(v)?v.map(B=>parseFloat(B)):[parseFloat(v),parseFloat(v),parseFloat(v)],hdrCapacityMin:parseFloat(C),hdrCapacityMax:parseFloat(L)}}catch{}n=r.indexOf("<x:xmpmeta",s)}};class ua{constructor(r){this.options={debug:r&&r.debug!==void 0?r.debug:!1,extractFII:r&&r.extractFII!==void 0?r.extractFII:!0,extractNonFII:r&&r.extractNonFII!==void 0?r.extractNonFII:!0}}extract(r){return new Promise((n,s)=>{const c=this.options.debug,u=new DataView(r.buffer);if(u.getUint16(0)!==65496){s(new Error("Not a valid jpeg"));return}const l=u.byteLength;let p=2,g=0,v;for(;p<l;){if(++g>250){s(new Error(`Found no marker after ${g} loops 😵`));return}if(u.getUint8(p)!==255){s(new Error(`Not a valid marker at offset 0x${p.toString(16)}, found: 0x${u.getUint8(p).toString(16)}`));return}if(v=u.getUint8(p+1),c&&console.log(`Marker: ${v.toString(16)}`),v===226){c&&console.log("Found APP2 marker (0xffe2)");const x=p+4;if(u.getUint32(x)===1297106432){const C=x+4;let O;if(u.getUint16(C)===18761)O=!1;else if(u.getUint16(C)===19789)O=!0;else{s(new Error("No valid endianness marker found in TIFF header"));return}if(u.getUint16(C+2,!O)!==42){s(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const L=u.getUint32(C+4,!O);if(L<8){s(new Error("Not valid TIFF data! (First offset less than 8)"));return}const B=C+L,me=u.getUint16(B,!O),H=B+2;let Y=0;for(let W=H;W<H+12*me;W+=12)u.getUint16(W,!O)===45057&&(Y=u.getUint32(W+8,!O));const le=B+2+me*12+4,de=[];for(let W=le;W<le+Y*16;W+=16){const F={MPType:u.getUint32(W,!O),size:u.getUint32(W+4,!O),dataOffset:u.getUint32(W+8,!O),dependantImages:u.getUint32(W+12,!O),start:-1,end:-1,isFII:!1};F.dataOffset?(F.start=C+F.dataOffset,F.isFII=!1):(F.start=0,F.isFII=!0),F.end=F.start+F.size,de.push(F)}if(this.options.extractNonFII&&de.length){const W=new Blob([u]),F=[];for(const ee of de){if(ee.isFII&&!this.options.extractFII)continue;const I=W.slice(ee.start,ee.end+1,"image/jpeg");F.push(I)}n(F)}}}p+=2+u.getUint16(p+2)}})}}const da=async a=>{const r=ca(a);if(!r)throw new Rt("Gain map XMP metadata not found");const s=await new ua({extractFII:!0,extractNonFII:!0}).extract(a);if(s.length!==2)throw new Ct("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:r}},ct=a=>new Promise((r,n)=>{const s=document.createElement("img");s.onload=()=>{r(s)},s.onerror=c=>{n(c)},s.src=URL.createObjectURL(a)});class Ot extends pn{constructor(r,n){super(n),r&&(this._renderer=r),this._internalLoadingManager=new fn}setRenderer(r){return this._renderer=r,this}setRenderTargetOptions(r){return this._renderTargetOptions=r,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const r=new la({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new tr,sdr:new tr});return new Yr({width:16,height:16,type:Te,colorSpace:Gr,material:r,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(r,n,s,c){const u=c?new Blob([c],{type:"image/jpeg"}):void 0,l=new Blob([s],{type:"image/jpeg"});let p,g,v=!1;if(typeof createImageBitmap>"u"){const O=await Promise.all([u?ct(u):Promise.resolve(void 0),ct(l)]);g=O[0],p=O[1],v=!0}else{const O=await Promise.all([u?createImageBitmap(u,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);g=O[0],p=O[1]}const x=new tr(g||new ImageData(2,2),Rr,Ye,Ye,Ue,ot,gr,Lr,1,Gr);x.flipY=v,x.needsUpdate=!0;const C=new tr(p,Rr,Ye,Ye,Ue,ot,gr,Lr,1,vn);C.flipY=v,C.needsUpdate=!0,r.width=p.width,r.height=p.height,r.material.gainMap=x,r.material.sdr=C,r.material.gainMapMin=n.gainMapMin,r.material.gainMapMax=n.gainMapMax,r.material.offsetHdr=n.offsetHdr,r.material.offsetSdr=n.offsetSdr,r.material.gamma=n.gamma,r.material.hdrCapacityMin=n.hdrCapacityMin,r.material.hdrCapacityMax=n.hdrCapacityMax,r.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),r.material.needsUpdate=!0,r.render()}}class ha extends Ot{load([r,n,s],c,u,l){const p=this.prepareQuadRenderer();let g,v,x;const C=async()=>{if(g&&v&&x){try{await this.render(p,x,g,v)}catch(M){this.manager.itemError(r),this.manager.itemError(n),this.manager.itemError(s),typeof l=="function"&&l(M),p.disposeOnDemandRenderer();return}typeof c=="function"&&c(p),this.manager.itemEnd(r),this.manager.itemEnd(n),this.manager.itemEnd(s),p.disposeOnDemandRenderer()}};let O=!0,L=0,B=0,me=!0,H=0,Y=0,Q=!0,le=0,de=0;const W=()=>{if(typeof u=="function"){const M=L+H+le,z=B+Y+de,k=O&&me&&Q;u(new ProgressEvent("progress",{lengthComputable:k,loaded:z,total:M}))}};this.manager.itemStart(r),this.manager.itemStart(n),this.manager.itemStart(s);const F=new Cr(this._internalLoadingManager);F.setResponseType("arraybuffer"),F.setRequestHeader(this.requestHeader),F.setPath(this.path),F.setWithCredentials(this.withCredentials),F.load(r,async M=>{if(typeof M=="string")throw new Error("Invalid sdr buffer");g=M,await C()},M=>{O=M.lengthComputable,B=M.loaded,L=M.total,W()},M=>{this.manager.itemError(r),typeof l=="function"&&l(M)});const ee=new Cr(this._internalLoadingManager);ee.setResponseType("arraybuffer"),ee.setRequestHeader(this.requestHeader),ee.setPath(this.path),ee.setWithCredentials(this.withCredentials),ee.load(n,async M=>{if(typeof M=="string")throw new Error("Invalid gainmap buffer");v=M,await C()},M=>{me=M.lengthComputable,Y=M.loaded,H=M.total,W()},M=>{this.manager.itemError(n),typeof l=="function"&&l(M)});const I=new Cr(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(s,async M=>{if(typeof M!="string")throw new Error("Invalid metadata string");x=JSON.parse(M),await C()},M=>{Q=M.lengthComputable,de=M.loaded,le=M.total,W()},M=>{this.manager.itemError(s),typeof l=="function"&&l(M)}),p}}class ma extends Ot{load(r,n,s,c){const u=this.prepareQuadRenderer(),l=new Cr(this._internalLoadingManager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(this.withCredentials),this.manager.itemStart(r),l.load(r,async p=>{if(typeof p=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(p);let v,x,C;try{const O=await da(g);v=O.sdr,x=O.gainMap,C=O.metadata}catch(O){if(O instanceof Rt||O instanceof Ct)console.warn(`Failure to reconstruct an HDR image from ${r}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),C={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},v=g;else throw O}try{await this.render(u,C,v,x)}catch(O){this.manager.itemError(r),typeof c=="function"&&c(O),u.disposeOnDemandRenderer();return}typeof n=="function"&&n(u),this.manager.itemEnd(r),u.disposeOnDemandRenderer()},s,p=>{this.manager.itemError(r),typeof c=="function"&&c(p)}),u}}const pr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},At="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",nr=a=>Array.isArray(a),qr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Ar({files:a=qr,path:r="",preset:n=void 0,colorSpace:s=void 0,extensions:c}={}){n&&(Jr(n),a=pr[n],r=At);const u=nr(a),{extension:l,isCubemap:p}=Kr(a),g=Qr(l);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+a);const v=Qe(L=>L.gl);y.useLayoutEffect(()=>{if(l!=="webp"&&l!=="jpg"&&l!=="jpeg")return;function L(){Or.clear(g,u?[a]:a)}v.domElement.addEventListener("webglcontextlost",L,{once:!0})},[a,v.domElement]);const x=Or(g,u?[a]:a,L=>{(l==="webp"||l==="jpg"||l==="jpeg")&&L.setRenderer(v),L.setPath==null||L.setPath(r),c&&c(L)});let C=u?x[0]:x;if(l==="jpg"||l==="jpeg"||l==="webp"){var O;C=(O=C.renderTarget)==null?void 0:O.texture}return C.mapping=p?yn:xn,C.colorSpace=s??(p?"srgb":"srgb-linear"),C}const ga={files:qr,path:"",preset:void 0,extensions:void 0};Ar.preload=a=>{const r={...ga,...a};let{files:n,path:s=""}=r;const{preset:c,extensions:u}=r;c&&(Jr(c),n=pr[c],s=At);const{extension:l}=Kr(n);if(l==="webp"||l==="jpg"||l==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const p=Qr(l);if(!p)throw new Error("useEnvironment: Unrecognized file extension: "+n);Or.preload(p,nr(n)?[n]:n,g=>{g.setPath==null||g.setPath(s),u&&u(g)})};const pa={files:qr,preset:void 0};Ar.clear=a=>{const r={...pa,...a};let{files:n}=r;const{preset:s}=r;s&&(Jr(s),n=pr[s]);const{extension:c}=Kr(n),u=Qr(c);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+n);Or.clear(u,nr(n)?[n]:n)};function Jr(a){if(!(a in pr))throw new Error("Preset must be one of: "+Object.keys(pr).join(", "))}function Kr(a){var r;const n=nr(a)&&a.length===6,s=nr(a)&&a.length===3&&a.some(l=>l.endsWith("json")),c=nr(a)?a[0]:a;return{extension:n?"cube":s?"webp":c.startsWith("data:application/exr")?"exr":c.startsWith("data:application/hdr")?"hdr":c.startsWith("data:image/jpeg")?"jpg":(r=c.split(".").pop())==null||(r=r.split("?"))==null||(r=r.shift())==null?void 0:r.toLowerCase(),isCubemap:n,isGainmap:s}}function Qr(a){return a==="cube"?wn:a==="hdr"?na:a==="exr"?aa:a==="jpg"||a==="jpeg"?ma:a==="webp"?ha:null}const fa=a=>a.current&&a.current.isScene,va=a=>fa(a)?a.current:a;function et(a,r,n,s,c={}){var u,l,p,g;c={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...c};const v=va(r||n),x=v.background,C=v.environment,O={backgroundBlurriness:v.backgroundBlurriness,backgroundIntensity:v.backgroundIntensity,backgroundRotation:(u=(l=v.backgroundRotation)==null||l.clone==null?void 0:l.clone())!==null&&u!==void 0?u:[0,0,0],environmentIntensity:v.environmentIntensity,environmentRotation:(p=(g=v.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&p!==void 0?p:[0,0,0]};return a!=="only"&&(v.environment=s),a&&(v.background=s),st(v,c),()=>{a!=="only"&&(v.environment=C),a&&(v.background=x),st(v,O)}}function rt({scene:a,background:r=!1,map:n,...s}){const c=Qe(u=>u.scene);return y.useLayoutEffect(()=>{if(n)return et(r,a,c,n,s)}),null}function Tt({background:a=!1,scene:r,blur:n,backgroundBlurriness:s,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:l,environmentRotation:p,...g}){const v=Ar(g),x=Qe(C=>C.scene);return y.useLayoutEffect(()=>et(a,r,x,v,{backgroundBlurriness:n??s,backgroundIntensity:c,backgroundRotation:u,environmentIntensity:l,environmentRotation:p})),y.useEffect(()=>()=>{v.dispose()},[v]),null}function _a({children:a,near:r=.1,far:n=1e3,resolution:s=256,frames:c=1,map:u,background:l=!1,blur:p,backgroundBlurriness:g,backgroundIntensity:v,backgroundRotation:x,environmentIntensity:C,environmentRotation:O,scene:L,files:B,path:me,preset:H=void 0,extensions:Y}){const Q=Qe(I=>I.gl),le=Qe(I=>I.scene),de=y.useRef(null),[W]=y.useState(()=>new ft),F=y.useMemo(()=>{const I=new bn(s);return I.texture.type=Te,I},[s]);y.useEffect(()=>()=>{F.dispose()},[F]),y.useLayoutEffect(()=>{if(c===1){const I=Q.autoClear;Q.autoClear=!0,de.current.update(Q,W),Q.autoClear=I}return et(l,L,le,F.texture,{backgroundBlurriness:p??g,backgroundIntensity:v,backgroundRotation:x,environmentIntensity:C,environmentRotation:O})},[a,W,F.texture,L,le,l,c,Q]);let ee=1;return zr(()=>{if(c===1/0||ee<c){const I=Q.autoClear;Q.autoClear=!0,de.current.update(Q,W),Q.autoClear=I,ee++}}),y.createElement(y.Fragment,null,Sn(y.createElement(y.Fragment,null,a,y.createElement("cubeCamera",{ref:de,args:[r,n,F]}),B||H?y.createElement(Tt,{background:!0,files:B,preset:H,path:me,extensions:Y}):u?y.createElement(rt,{background:!0,map:u,extensions:Y}):null),W))}function ya(a){var r,n,s,c;const u=Ar(a),l=a.map||u;y.useMemo(()=>En({GroundProjectedEnvImpl:ta}),[]),y.useEffect(()=>()=>{u.dispose()},[u]);const p=y.useMemo(()=>[l],[l]),g=(r=a.ground)==null?void 0:r.height,v=(n=a.ground)==null?void 0:n.radius,x=(s=(c=a.ground)==null?void 0:c.scale)!==null&&s!==void 0?s:1e3;return y.createElement(y.Fragment,null,y.createElement(rt,dt({},a,{map:l})),y.createElement("groundProjectedEnvImpl",{args:p,scale:x,height:g,radius:v}))}function xa(a){return a.ground?y.createElement(ya,a):a.map?y.createElement(rt,a):a.children?y.createElement(_a,a):y.createElement(Tt,a)}const wa=({title:a,sub:r})=>o.jsx("div",{className:"flex flex-col items-center gap-5",children:o.jsx("div",{children:o.jsx("h1",{className:"font-semibold md:text-5xl text-3xl text-center",children:a})})});function jt(a){const r=y.useRef(),{nodes:n,materials:s,animations:c}=We("/models/player.glb"),{actions:u}=Vr(c,r);return y.useEffect(()=>{if(a.isActive){const l=Object.keys(u)[0];u[l]&&u[l].reset().fadeIn(.5).play()}else Object.values(u).forEach(l=>{l&&l.isRunning&&l.isRunning()&&l.fadeOut(.5)})},[a.isActive,u]),o.jsx("group",{ref:r,...a,dispose:null,children:o.jsx("group",{name:"Scene",children:o.jsx("group",{name:"Sketchfab_model",rotation:[-Math.PI/2,0,0],children:o.jsx("group",{name:"e405430fbdcc43f79db4240fa1a75914fbx",rotation:[Math.PI/2,0,0],scale:.01,children:o.jsx("group",{name:"Object_2",children:o.jsxs("group",{name:"RootNode",children:[o.jsx("group",{name:"songyMaster_CTRL"}),o.jsxs("group",{name:"songyradio",children:[o.jsx("group",{name:"songyAntenna_GRP",children:o.jsxs("group",{name:"songyAntennabase_GEO",position:[11.681,11.624,-3.969],children:[o.jsxs("group",{name:"songyAntenna1_GEO",position:[.175,.384,0],children:[o.jsx("mesh",{name:"songyAntenna1_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyAntenna1_GEO_songy_material_0.geometry,material:s.songy_material}),o.jsxs("group",{name:"songyAntenna2_GEO",position:[-7.523,0,0],children:[o.jsx("mesh",{name:"songyAntenna2_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyAntenna2_GEO_songy_material_0.geometry,material:s.songy_material}),o.jsx("group",{name:"songyAntenna3_GEO",position:[-4.011,0,0],children:o.jsx("mesh",{name:"songyAntenna3_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyAntenna3_GEO_songy_material_0.geometry,material:s.songy_material})})]})]}),o.jsx("mesh",{name:"songyAntennabase_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyAntennabase_GEO_songy_material_0.geometry,material:s.songy_material})]})}),o.jsxs("group",{name:"songyButtons_GRP",children:[o.jsx("group",{name:"songyFFbutton_GEO",children:o.jsx("mesh",{name:"songyFFbutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyFFbutton_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyPausebutton_GEO",children:o.jsx("mesh",{name:"songyPausebutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyPausebutton_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyPlaybutton_GEO",children:o.jsx("mesh",{name:"songyPlaybutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyPlaybutton_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyRecbutton_GEO",children:o.jsx("mesh",{name:"songyRecbutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyRecbutton_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyRWbutton_GEO",children:o.jsx("mesh",{name:"songyRWbutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyRWbutton_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyStopbutton_GEO",children:o.jsx("mesh",{name:"songyStopbutton_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyStopbutton_GEO_songy_material_0.geometry,material:s.songy_material})})]}),o.jsx("group",{name:"songyCogL_GEO",position:[-6.266,5.19,4.87],children:o.jsx("mesh",{name:"songyCogL_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyCogL_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyCogR_GEO",position:[-2.013,5.19,4.87],children:o.jsx("mesh",{name:"songyCogR_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyCogR_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyDialindicator_GEO",position:[-9.116,12.276,4.864],children:o.jsx("mesh",{name:"songyDialindicator_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyDialindicator_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyDoorold_GRP",position:[-9.863,-.255,6.05],rotation:[.002,0,0],children:o.jsxs("group",{name:"songyDoor_GEO",position:[5.727,2.036,.551],children:[o.jsx("mesh",{name:"songyDoor_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyDoor_GEO_songy_material_0.geometry,material:s.songy_material}),o.jsx("group",{name:"songyInteriorCassette_GRP",position:[8.274,3.632,-12.075],rotation:[Math.PI,0,Math.PI],children:o.jsxs("group",{name:"cassetteInterior_GRP",position:[8.281,.007,-10.856],rotation:[-Math.PI,0,0],children:[o.jsx("group",{name:"cassetteInterior_GEO",position:[0,2.926,-.388],children:o.jsx("mesh",{name:"cassetteInterior_GEO_cassette_material_06_0",castShadow:!0,receiveShadow:!0,geometry:n.cassetteInterior_GEO_cassette_material_06_0.geometry,material:s.cassette_material_06})}),o.jsx("group",{name:"cassetteInteriorCog1_GEO",position:[-2.128,.228,0],children:o.jsx("mesh",{name:"cassetteInteriorCog1_GEO_cassette_material_06_0",castShadow:!0,receiveShadow:!0,geometry:n.cassetteInteriorCog1_GEO_cassette_material_06_0.geometry,material:s.cassette_material_06})}),o.jsx("group",{name:"cassetteInteriorCog2_GEO",position:[2.128,.228,0],children:o.jsx("mesh",{name:"cassetteInteriorCog2_GEO_cassette_material_06_0",castShadow:!0,receiveShadow:!0,geometry:n.cassetteInteriorCog2_GEO_cassette_material_06_0.geometry,material:s.cassette_material_06})})]})})]})}),o.jsx("group",{name:"songyHandle",position:[.114,10.251,1.472],children:o.jsx("mesh",{name:"songyHandle_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyHandle_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyModeswitch_GEO",position:[3.59,12.991,1.56],rotation:[.419,0,0],children:o.jsx("mesh",{name:"songyModeswitch_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyModeswitch_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyRadiobody_GEO1",children:o.jsx("mesh",{name:"songyRadiobody_GEO1_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyRadiobody_GEO1_songy_material_0.geometry,material:n.songyRadiobody_GEO1_songy_material_0.material})}),o.jsx("group",{name:"songyRadioswitch_GEO",position:[5.205,12.991,1.56],rotation:[-.404,0,0],children:o.jsx("mesh",{name:"songyRadioswitch_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyRadioswitch_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyTuner_GEO",position:[12.142,11.679,2.18],children:o.jsx("mesh",{name:"songyTuner_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyTuner_GEO_songy_material_0.geometry,material:s.songy_material})}),o.jsx("group",{name:"songyVolume_GEO",position:[8.458,13.697,1.675],rotation:[-Math.PI,.723,-Math.PI],children:o.jsx("mesh",{name:"songyVolume_GEO_songy_material_0",castShadow:!0,receiveShadow:!0,geometry:n.songyVolume_GEO_songy_material_0.geometry,material:s.songy_material})})]})]})})})})})})}jt.propTypes={isActive:Ze.bool};We.preload("/models/player.glb");function Ft(a){const r=y.useRef(),{nodes:n,materials:s,animations:c}=We("/models/cat.glb"),{actions:u}=Vr(c,r);return y.useEffect(()=>{if(a.isActive){const l=Object.keys(u)[0];u[l]&&u[l].reset().fadeIn(.5).play()}else Object.values(u).forEach(l=>{l&&l.isRunning&&l.isRunning()&&l.fadeOut(.5)})},[a.isActive,u]),o.jsx("group",{ref:r,...a,dispose:null,children:o.jsx("group",{name:"Sketchfab_Scene",children:o.jsx("group",{name:"Sketchfab_model",rotation:[-Math.PI/2,0,0],children:o.jsx("group",{name:"root",children:o.jsx("group",{name:"GLTF_SceneRootNode",rotation:[Math.PI/2,0,0],children:o.jsx("group",{name:"RootNode_(gltf_orientation_matrix)_0",rotation:[-Math.PI/2,0,0],children:o.jsx("group",{name:"RootNode_(model_correction_matrix)_1",children:o.jsx("group",{name:"catfbx_2",rotation:[Math.PI/2,0,0],children:o.jsx("group",{name:"_3",children:o.jsx("group",{name:"RootNode_4",children:o.jsx("group",{name:"_5",children:o.jsxs("group",{name:"GLTF_created_0",children:[o.jsx("primitive",{object:n.GLTF_created_0_rootJoint}),o.jsx("skinnedMesh",{name:"Object_12",geometry:n.Object_12.geometry,material:s.Material_81,skeleton:n.Object_12.skeleton}),o.jsx("skinnedMesh",{name:"Object_14",geometry:n.Object_14.geometry,material:s.Material_105,skeleton:n.Object_14.skeleton}),o.jsx("skinnedMesh",{name:"Object_16",geometry:n.Object_16.geometry,material:s.Material_93,skeleton:n.Object_16.skeleton}),o.jsx("group",{name:"_8"}),o.jsx("group",{name:"_9"}),o.jsx("group",{name:"_10"})]})})})})})})})})})})})})}Ft.propTypes={isActive:Ze.bool};We.preload("/models/cat.glb");function kt(a){const r=y.useRef(),{nodes:n,materials:s,animations:c}=We("/models/bird.glb"),{actions:u}=Vr(c,r);return Mn.useEffect(()=>{if(a.isActive){const l=Object.keys(u)[0];u[l]&&u[l].reset().fadeIn(.5).play()}else Object.values(u).forEach(l=>{l&&l.isRunning&&l.isRunning()&&l.fadeOut(.5)})},[a.isActive,u]),o.jsx("group",{ref:r,...a,dispose:null,children:o.jsx("group",{name:"Sketchfab_Scene",children:o.jsx("group",{name:"Sketchfab_model",rotation:[-Math.PI/2,0,0],scale:1.182,children:o.jsx("group",{name:"Poliko_Robin_sketchfabfbx",rotation:[Math.PI/2,0,0],scale:.01,children:o.jsx("group",{name:"Object_2",children:o.jsxs("group",{name:"RootNode",children:[o.jsxs("group",{name:"Pajaro_Robin",children:[o.jsx("group",{name:"polySurface2",children:o.jsx("group",{name:"transform3"})}),o.jsx("group",{name:"polySurface3",children:o.jsx("group",{name:"transform9"})}),o.jsx("group",{name:"polySurface4",children:o.jsx("group",{name:"transform8"})}),o.jsx("group",{name:"polySurface5",children:o.jsx("group",{name:"transform10"})}),o.jsx("group",{name:"polySurface6",children:o.jsx("group",{name:"transform11"})}),o.jsx("group",{name:"polySurface7",children:o.jsx("group",{name:"transform7"})}),o.jsx("group",{name:"polySurface8",children:o.jsx("group",{name:"transform5"})}),o.jsx("group",{name:"polySurface9",children:o.jsx("group",{name:"transform6"})}),o.jsx("group",{name:"polySurface10",children:o.jsx("group",{name:"transform4"})}),o.jsx("group",{name:"polySurface11",children:o.jsx("group",{name:"transform2"})}),o.jsx("group",{name:"polySurface12",children:o.jsx("group",{name:"transform13"})}),o.jsx("group",{name:"polySurface14",children:o.jsx("group",{name:"transform12"})}),o.jsx("group",{name:"transform1"})]}),o.jsx("group",{name:"Camera",position:[679.481,618.832,663.246],rotation:[-Math.PI,.756,2.68],scale:100,children:o.jsx("group",{name:"Object_31"})}),o.jsx("group",{name:"Robin_pos",children:o.jsxs("group",{name:"Object_33",children:[o.jsx("primitive",{object:n._rootJoint}),o.jsx("skinnedMesh",{name:"Object_58",geometry:n.Object_58.geometry,material:s.Robin_Material,skeleton:n.Object_58.skeleton}),o.jsx("group",{name:"Object_57"})]})}),o.jsx("group",{name:"polySurface9_1",children:o.jsx("group",{name:"transform15"})}),o.jsx("group",{name:"polySurface6_1",children:o.jsx("group",{name:"transform16"})}),o.jsx("group",{name:"polySurface12_1",children:o.jsx("group",{name:"transform14"})}),o.jsx("group",{name:"right1",position:[1000.1,6.923,5.751],rotation:[-Math.PI,0,-Math.PI],children:o.jsx("group",{name:"Object_66"})}),o.jsx("group",{name:"polySurface17"})]})})})})})})}kt.propTypes={isActive:Ze.bool};We.preload("/models/bird.glb");const ut={cat:"/icons/cat.svg",bird:"/icons/bird.svg",player:"/icons/player.svg"},Ir={cat:"/audio/cat.mp3",bird:"/audio/bird.mp3",player:"/audio/player.mp3",traffic:"/audio/traffic.mp3"};function Ea(){const{progress:a}=On();return o.jsx(Bn,{center:!0,children:o.jsxs("div",{className:"loader-container",children:[o.jsx("div",{className:"loader"}),o.jsxs("div",{className:"loading-text",children:[a.toFixed(0),"% loaded"]})]})})}We.preload("/models/player.glb");We.preload("/models/cat.glb");We.preload("/models/bird.glb");function Pt({activeModel:a}){const{camera:r,gl:n,scene:s}=Qe();return y.useEffect(()=>{r.position.set(0,2,8),r.lookAt(0,0,0),n.shadowMap.enabled=!0,n.shadowMap.type=Rn,n.setPixelRatio(Math.min(window.devicePixelRatio,2)),n.setSize(n.domElement.clientWidth,n.domElement.clientHeight);const c=new An,u=()=>{const l=c.getDelta();l<1/60?setTimeout(()=>{requestAnimationFrame(u)},(1/60-l)*1e3):requestAnimationFrame(u)};return u(),()=>{s.traverse(l=>{l.material&&(Array.isArray(l.material)?l.material.forEach(p=>p.dispose()):l.material.dispose()),l.geometry&&l.geometry.dispose(),l.texture&&l.texture.dispose()})}},[r,n,s]),o.jsxs(o.Fragment,{children:[o.jsx(xa,{files:"/assets/env/japan.jpg",background:!0,blur:.03}),o.jsx("ambientLight",{intensity:.5}),o.jsx("directionalLight",{position:[10,10,5],intensity:1}),o.jsxs("group",{children:[o.jsx(jt,{position:[7,-4,-18],rotation:[0,-Math.PI/4,0],scale:10,visible:!0,isActive:a==="player"}),o.jsx(Ft,{position:[-2,-.8,-8],rotation:[0,-Math.PI/12,0],scale:.08,visible:!0,isActive:a==="cat"}),o.jsx(kt,{position:[.7,0,4.2],rotation:[0,-Math.PI/6,0],scale:4,visible:!0,isActive:a==="bird"})]})]})}Pt.propTypes={activeModel:Ze.string};function Nt({activeModel:a,setActiveModel:r}){const n=c=>{r(c)},s=()=>{r(null)};return o.jsx("div",{className:"trackpad",children:Object.keys(ut).map(c=>o.jsx("div",{className:`trackpad-icon ${a===c?"active":""}`,onMouseEnter:()=>n(c),onMouseLeave:s,children:o.jsx("img",{src:ut[c],alt:c})},c))})}Nt.propTypes={activeModel:Ze.string,setActiveModel:Ze.func.isRequired};function Ut({activeModel:a,initializedByUser:r}){const[n,s]=y.useState(!1),[c,u]=y.useState(!1),l=y.useRef({cat:new Audio(Ir.cat),bird:new Audio(Ir.bird),player:new Audio(Ir.player),traffic:new Audio(Ir.traffic)});y.useEffect(()=>{const g=l.current;Object.values(g).forEach(x=>{x.load(),x.loop=!0,x.volume=.1}),g.traffic.volume=.2;const v=setTimeout(()=>{u(!0)},800);return()=>{clearTimeout(v),Object.values(g).forEach(x=>{x.pause(),x.currentTime=0})}},[]);const p=y.useCallback(()=>{if(n)return;const g=l.current;g.traffic.volume=.2;const v=Object.values(g).map(x=>x.play().catch(C=>console.log("Audio playback error:",C)));Promise.all(v).then(()=>s(!0)).catch(x=>console.error("Could not initialize audio:",x))},[n]);return y.useEffect(()=>{r&&!n&&p()},[r,n,p]),y.useEffect(()=>{if(!n)return;const g=l.current,v=[];return Object.keys(g).forEach(x=>{if(x!=="traffic")if(a===x){const C=setInterval(()=>{g[x].volume<1?g[x].volume=Math.min(1,g[x].volume+.05):clearInterval(C)},50);v.push(C)}else{const C=setInterval(()=>{g[x].volume>.1?g[x].volume=Math.max(.1,g[x].volume-.05):clearInterval(C)},50);v.push(C)}}),()=>{v.forEach(x=>clearInterval(x))}},[a,n]),o.jsx(o.Fragment,{children:!n&&o.jsx("div",{className:"audio-init-overlay",onClick:p,children:o.jsxs("button",{className:`audio-init-button ${c?"fade-in":"invisible"}`,disabled:!c,children:["Start",o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o.jsx("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),o.jsx("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),o.jsxs("g",{id:"SVGRepo_iconCarrier",children:[" ",o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM10.6935 15.8458L15.4137 13.059C16.1954 12.5974 16.1954 11.4026 15.4137 10.941L10.6935 8.15419C9.93371 7.70561 9 8.28947 9 9.21316V14.7868C9 15.7105 9.93371 16.2944 10.6935 15.8458Z",fill:"#1C274C"})," "]})]})]})})})}Ut.propTypes={activeModel:Ze.string,initializedByUser:Ze.bool};const ba=()=>{const[a,r]=y.useState(null),[n,s]=y.useState(!1),[c,u]=y.useState(!1),l=()=>{n||s(!0)};return y.useCallback(p=>{console.error("Canvas error:",p),u(!0)},[]),o.jsxs("div",{className:"park-scene-container",onClick:l,children:[o.jsx("h2",{children:"Active Listening"}),o.jsx("p",{children:"Hover over an icon below to enhance - simulating selective listening"}),"      ",o.jsx("div",{className:"canvas-container",children:o.jsx(In,{gl:{antialias:!0,preserveDrawingBuffer:!0,alpha:!0,powerPreference:"high-performance"},camera:{position:[2,2,10],fov:55},dpr:[1,2],style:{background:"transparent"},shadows:!0,onCreated:({gl:p})=>{p.setClearColor(new Cn("#87CEEB"),0),p.domElement&&p.domElement.addEventListener("webglcontextlost",g=>{g.preventDefault(),console.log("WebGL context lost. Trying to restore...")})},children:o.jsx(y.Suspense,{fallback:o.jsx(Ea,{}),children:o.jsx(Pt,{activeModel:a})})})}),o.jsx(Nt,{activeModel:a,setActiveModel:r}),o.jsx(Ut,{activeModel:a,initializedByUser:n}),o.jsx("style",{children:`
        .park-scene-container {
          width: 100%;
          height: 100%;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 2rem;
          color: white;
          text-align: center;
          margin-top: 1.2rem;
        }
        
        h2 {
          margin-bottom: 0.5rem;
          font-size: 2rem;
        }
        
        p {
          margin-bottom: 2rem;
          opacity: 0.8;
        }
        
        .canvas-container {
          width: 100%;
          height: 500px;
          border-radius: 10px;
          overflow: hidden;
          margin-bottom: 2rem;
          position: relative;
        }
        
        .trackpad {
          display: flex;
          gap: 2rem;
          padding: 1.5rem;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 15px;
          backdrop-filter: blur(10px);
        }
        
        .trackpad-icon {
          width: 60px;
          height: 60px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.2);
          cursor: pointer;
          transition: all 0.3s ease;
        }
        
        .trackpad-icon img {
          width: 30px;
          height: 30px;
        }
        
        .trackpad-icon.active {
          background: rgba(255, 255, 255, 0.6);
          transform: scale(1.1);
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .audio-init-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(0, 0, 0, 0.6);
          z-index: 10;
          cursor: pointer;
        }
        
        .audio-init-button {
          padding: 1rem 2rem;
          background: #4a88ff;
          color: white;
          border: none;
          border-radius: 8px;
          font-size: 1.2rem;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .audio-init-button.invisible {
          opacity: 0;
        }

        .audio-init-button.fade-in {
          opacity: 1;
          animation: fadeIn 0.8s ease-in-out;
        }

        .audio-init-button:disabled {
          cursor: default;
        }

        .audio-init-button svg {
          width: 20px;
          height: 20px;
        }
          
        .audio-init-button:hover:not(:disabled) {
          background: #3a78ff;
          transform: scale(1.05);
        }
        
        .loader-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
        }
        
        .loader {
          border: 5px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          border-top: 5px solid #4a88ff;
          width: 50px;
          height: 50px;
          animation: spin 1s linear infinite;
          margin-bottom: 10px;
        }
        
        .loading-text {
          color: white;
          font-size: 16px;
          text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
          0% { opacity: 0; transform: scale(0.95); }
          100% { opacity: 1; transform: scale(1); }
        }
      `})]})},Gt=({children:a})=>{const[r,n]=y.useState(!1),[s,c]=y.useState("");y.useEffect(()=>{const l=p=>{var g;console.error("Application Error:",p),!((g=p.message)!=null&&g.includes("AudioContext"))&&(c(p.message||"An unexpected error occurred"),n(!0))};return window.addEventListener("error",l),()=>window.removeEventListener("error",l)},[]);const u=y.useCallback(()=>{if(n(!1),c(""),window.audioContext){try{window.audioContext.close()}catch(l){console.error("Error closing audio context:",l)}delete window.audioContext}},[]);return r?o.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-900",children:o.jsxs("div",{className:"text-center text-white",children:[o.jsx("h2",{className:"text-xl mb-4",children:"Something went wrong"}),o.jsx("p",{className:"text-gray-400 mb-4",children:s}),o.jsx("button",{className:"px-4 py-2 bg-blue-500 rounded hover:bg-blue-600",onClick:u,children:"Try again"})]})}):a};Gt.propTypes={children:Ze.node.isRequired};const Ma=()=>(y.useEffect(()=>(window.scrollTo(0,0),()=>{if(window.audioContext){try{window.audioContext.close()}catch(a){console.error("Error closing audio context:",a)}delete window.audioContext}}),[]),o.jsx(Gt,{children:o.jsxs("section",{className:"h-screen overflow-hidden bg-gradient-to-b from-gray-900 to-gray-800",children:[o.jsx("div",{className:"absolute top-16 left-4 z-10",children:o.jsxs(Tn,{to:"/",className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-900/50 backdrop-blur-sm rounded-lg text-white hover:bg-gray-800 transition-all",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"flex-shrink-0",children:o.jsx("path",{d:"M15 10H5M5 10L10 15M5 10L10 5"})}),o.jsx("span",{className:"hidden sm:inline",children:"Home"})]})}),o.jsx("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 text-center z-10",children:o.jsx(wa,{})}),o.jsx("div",{className:"h-full",role:"main","aria-label":"3D Audio Experience",children:o.jsx(ba,{})})]})}));export{Ma as default};
